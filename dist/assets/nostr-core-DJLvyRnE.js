var Ls=Object.defineProperty;var Ms=(t,e,n)=>e in t?Ls(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var b=(t,e,n)=>Ms(t,typeof e!="symbol"?e+"":e,n);import{j,I as fr,Z as dr,S as hr,W as Bs,L as Ps,T as Us,C as Ds,a as Fs}from"./ui-components-7vdcyMHN.js";import{r as q}from"./react-vendor-D8JZSk8j.js";let Hs={data:""},js=t=>typeof window=="object"?((t?t.querySelector("#_goober"):window._goober)||Object.assign((t||document.head).appendChild(document.createElement("style")),{innerHTML:" ",id:"_goober"})).firstChild:t||Hs,qs=/(?:([\u0080-\uFFFF\w-%@]+) *:? *([^{;]+?);|([^;}{]*?) *{)|(}\s*)/g,Ws=/\/\*[^]*?\*\/|  +/g,gr=/\n+/g,Be=(t,e)=>{let n="",r="",o="";for(let s in t){let i=t[s];s[0]=="@"?s[1]=="i"?n=s+" "+i+";":r+=s[1]=="f"?Be(i,s):s+"{"+Be(i,s[1]=="k"?"":e)+"}":typeof i=="object"?r+=Be(i,e?e.replace(/([^,])+/g,a=>s.replace(/([^,]*:\S+\([^)]*\))|([^,])+/g,c=>/&/.test(c)?c.replace(/&/g,a):a?a+" "+c:c)):s):i!=null&&(s=/^--/.test(s)?s:s.replace(/[A-Z]/g,"-$&").toLowerCase(),o+=Be.p?Be.p(s,i):s+":"+i+";")}return n+(e&&o?e+"{"+o+"}":o)+r},Se={},Pr=t=>{if(typeof t=="object"){let e="";for(let n in t)e+=n+Pr(t[n]);return e}return t},Ks=(t,e,n,r,o)=>{let s=Pr(t),i=Se[s]||(Se[s]=(c=>{let l=0,f=11;for(;l<c.length;)f=101*f+c.charCodeAt(l++)>>>0;return"go"+f})(s));if(!Se[i]){let c=s!==t?t:(l=>{let f,u,h=[{}];for(;f=qs.exec(l.replace(Ws,""));)f[4]?h.shift():f[3]?(u=f[3].replace(gr," ").trim(),h.unshift(h[0][u]=h[0][u]||{})):h[0][f[1]]=f[2].replace(gr," ").trim();return h[0]})(t);Se[i]=Be(o?{["@keyframes "+i]:c}:c,n?"":"."+i)}let a=n&&Se.g?Se.g:null;return n&&(Se.g=Se[i]),((c,l,f,u)=>{u?l.data=l.data.replace(u,c):l.data.indexOf(c)===-1&&(l.data=f?c+l.data:l.data+c)})(Se[i],e,r,a),i},zs=(t,e,n)=>t.reduce((r,o,s)=>{let i=e[s];if(i&&i.call){let a=i(n),c=a&&a.props&&a.props.className||/^go/.test(a)&&a;i=c?"."+c:a&&typeof a=="object"?a.props?"":Be(a,""):a===!1?"":a}return r+o+(i??"")},"");function Ot(t){let e=this||{},n=t.call?t(e.p):t;return Ks(n.unshift?n.raw?zs(n,[].slice.call(arguments,1),e.p):n.reduce((r,o)=>Object.assign(r,o&&o.call?o(e.p):o),{}):n,js(e.target),e.g,e.o,e.k)}let Ur,ln,un;Ot.bind({g:1});let _e=Ot.bind({k:1});function Vs(t,e,n,r){Be.p=e,Ur=t,ln=n,un=r}function He(t,e){let n=this||{};return function(){let r=arguments;function o(s,i){let a=Object.assign({},s),c=a.className||o.className;n.p=Object.assign({theme:ln&&ln()},a),n.o=/ *go\d+/.test(c),a.className=Ot.apply(n,r)+(c?" "+c:"");let l=t;return t[0]&&(l=a.as||t,delete a.as),un&&l[0]&&un(a),Ur(l,a)}return o}}var Gs=t=>typeof t=="function",Ct=(t,e)=>Gs(t)?t(e):t,Js=(()=>{let t=0;return()=>(++t).toString()})(),Dr=(()=>{let t;return()=>{if(t===void 0&&typeof window<"u"){let e=matchMedia("(prefers-reduced-motion: reduce)");t=!e||e.matches}return t}})(),Zs=20,Fr=(t,e)=>{switch(e.type){case 0:return{...t,toasts:[e.toast,...t.toasts].slice(0,Zs)};case 1:return{...t,toasts:t.toasts.map(s=>s.id===e.toast.id?{...s,...e.toast}:s)};case 2:let{toast:n}=e;return Fr(t,{type:t.toasts.find(s=>s.id===n.id)?1:0,toast:n});case 3:let{toastId:r}=e;return{...t,toasts:t.toasts.map(s=>s.id===r||r===void 0?{...s,dismissed:!0,visible:!1}:s)};case 4:return e.toastId===void 0?{...t,toasts:[]}:{...t,toasts:t.toasts.filter(s=>s.id!==e.toastId)};case 5:return{...t,pausedAt:e.time};case 6:let o=e.time-(t.pausedAt||0);return{...t,pausedAt:void 0,toasts:t.toasts.map(s=>({...s,pauseDuration:s.pauseDuration+o}))}}},xt=[],ze={toasts:[],pausedAt:void 0},Je=t=>{ze=Fr(ze,t),xt.forEach(e=>{e(ze)})},Ys={blank:4e3,error:4e3,success:2e3,loading:1/0,custom:4e3},Qs=(t={})=>{let[e,n]=q.useState(ze),r=q.useRef(ze);q.useEffect(()=>(r.current!==ze&&n(ze),xt.push(n),()=>{let s=xt.indexOf(n);s>-1&&xt.splice(s,1)}),[]);let o=e.toasts.map(s=>{var i,a,c;return{...t,...t[s.type],...s,removeDelay:s.removeDelay||((i=t[s.type])==null?void 0:i.removeDelay)||(t==null?void 0:t.removeDelay),duration:s.duration||((a=t[s.type])==null?void 0:a.duration)||(t==null?void 0:t.duration)||Ys[s.type],style:{...t.style,...(c=t[s.type])==null?void 0:c.style,...s.style}}});return{...e,toasts:o}},Xs=(t,e="blank",n)=>({createdAt:Date.now(),visible:!0,dismissed:!1,type:e,ariaProps:{role:"status","aria-live":"polite"},message:t,pauseDuration:0,...n,id:(n==null?void 0:n.id)||Js()}),mt=t=>(e,n)=>{let r=Xs(e,t,n);return Je({type:2,toast:r}),r.id},re=(t,e)=>mt("blank")(t,e);re.error=mt("error");re.success=mt("success");re.loading=mt("loading");re.custom=mt("custom");re.dismiss=t=>{Je({type:3,toastId:t})};re.remove=t=>Je({type:4,toastId:t});re.promise=(t,e,n)=>{let r=re.loading(e.loading,{...n,...n==null?void 0:n.loading});return typeof t=="function"&&(t=t()),t.then(o=>{let s=e.success?Ct(e.success,o):void 0;return s?re.success(s,{id:r,...n,...n==null?void 0:n.success}):re.dismiss(r),o}).catch(o=>{let s=e.error?Ct(e.error,o):void 0;s?re.error(s,{id:r,...n,...n==null?void 0:n.error}):re.dismiss(r)}),t};var ei=(t,e)=>{Je({type:1,toast:{id:t,height:e}})},ti=()=>{Je({type:5,time:Date.now()})},ht=new Map,ni=1e3,ri=(t,e=ni)=>{if(ht.has(t))return;let n=setTimeout(()=>{ht.delete(t),Je({type:4,toastId:t})},e);ht.set(t,n)},oi=t=>{let{toasts:e,pausedAt:n}=Qs(t);q.useEffect(()=>{if(n)return;let s=Date.now(),i=e.map(a=>{if(a.duration===1/0)return;let c=(a.duration||0)+a.pauseDuration-(s-a.createdAt);if(c<0){a.visible&&re.dismiss(a.id);return}return setTimeout(()=>re.dismiss(a.id),c)});return()=>{i.forEach(a=>a&&clearTimeout(a))}},[e,n]);let r=q.useCallback(()=>{n&&Je({type:6,time:Date.now()})},[n]),o=q.useCallback((s,i)=>{let{reverseOrder:a=!1,gutter:c=8,defaultPosition:l}=i||{},f=e.filter(p=>(p.position||l)===(s.position||l)&&p.height),u=f.findIndex(p=>p.id===s.id),h=f.filter((p,y)=>y<u&&p.visible).length;return f.filter(p=>p.visible).slice(...a?[h+1]:[0,h]).reduce((p,y)=>p+(y.height||0)+c,0)},[e]);return q.useEffect(()=>{e.forEach(s=>{if(s.dismissed)ri(s.id,s.removeDelay);else{let i=ht.get(s.id);i&&(clearTimeout(i),ht.delete(s.id))}})},[e]),{toasts:e,handlers:{updateHeight:ei,startPause:ti,endPause:r,calculateOffset:o}}},si=_e`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
 transform: scale(1) rotate(45deg);
  opacity: 1;
}`,ii=_e`
from {
  transform: scale(0);
  opacity: 0;
}
to {
  transform: scale(1);
  opacity: 1;
}`,ai=_e`
from {
  transform: scale(0) rotate(90deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(90deg);
	opacity: 1;
}`,ci=He("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#ff4b4b"};
  position: relative;
  transform: rotate(45deg);

  animation: ${si} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;

  &:after,
  &:before {
    content: '';
    animation: ${ii} 0.15s ease-out forwards;
    animation-delay: 150ms;
    position: absolute;
    border-radius: 3px;
    opacity: 0;
    background: ${t=>t.secondary||"#fff"};
    bottom: 9px;
    left: 4px;
    height: 2px;
    width: 12px;
  }

  &:before {
    animation: ${ai} 0.15s ease-out forwards;
    animation-delay: 180ms;
    transform: rotate(90deg);
  }
`,li=_e`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
`,ui=He("div")`
  width: 12px;
  height: 12px;
  box-sizing: border-box;
  border: 2px solid;
  border-radius: 100%;
  border-color: ${t=>t.secondary||"#e0e0e0"};
  border-right-color: ${t=>t.primary||"#616161"};
  animation: ${li} 1s linear infinite;
`,fi=_e`
from {
  transform: scale(0) rotate(45deg);
	opacity: 0;
}
to {
  transform: scale(1) rotate(45deg);
	opacity: 1;
}`,di=_e`
0% {
	height: 0;
	width: 0;
	opacity: 0;
}
40% {
  height: 0;
	width: 6px;
	opacity: 1;
}
100% {
  opacity: 1;
  height: 10px;
}`,hi=He("div")`
  width: 20px;
  opacity: 0;
  height: 20px;
  border-radius: 10px;
  background: ${t=>t.primary||"#61d345"};
  position: relative;
  transform: rotate(45deg);

  animation: ${fi} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
  animation-delay: 100ms;
  &:after {
    content: '';
    box-sizing: border-box;
    animation: ${di} 0.2s ease-out forwards;
    opacity: 0;
    animation-delay: 200ms;
    position: absolute;
    border-right: 2px solid;
    border-bottom: 2px solid;
    border-color: ${t=>t.secondary||"#fff"};
    bottom: 6px;
    left: 6px;
    height: 10px;
    width: 6px;
  }
`,gi=He("div")`
  position: absolute;
`,pi=He("div")`
  position: relative;
  display: flex;
  justify-content: center;
  align-items: center;
  min-width: 20px;
  min-height: 20px;
`,yi=_e`
from {
  transform: scale(0.6);
  opacity: 0.4;
}
to {
  transform: scale(1);
  opacity: 1;
}`,wi=He("div")`
  position: relative;
  transform: scale(0.6);
  opacity: 0.4;
  min-width: 20px;
  animation: ${yi} 0.3s 0.12s cubic-bezier(0.175, 0.885, 0.32, 1.275)
    forwards;
`,mi=({toast:t})=>{let{icon:e,type:n,iconTheme:r}=t;return e!==void 0?typeof e=="string"?q.createElement(wi,null,e):e:n==="blank"?null:q.createElement(pi,null,q.createElement(ui,{...r}),n!=="loading"&&q.createElement(gi,null,n==="error"?q.createElement(ci,{...r}):q.createElement(hi,{...r})))},bi=t=>`
0% {transform: translate3d(0,${t*-200}%,0) scale(.6); opacity:.5;}
100% {transform: translate3d(0,0,0) scale(1); opacity:1;}
`,Ei=t=>`
0% {transform: translate3d(0,0,-1px) scale(1); opacity:1;}
100% {transform: translate3d(0,${t*-150}%,-1px) scale(.6); opacity:0;}
`,vi="0%{opacity:0;} 100%{opacity:1;}",xi="0%{opacity:1;} 100%{opacity:0;}",Si=He("div")`
  display: flex;
  align-items: center;
  background: #fff;
  color: #363636;
  line-height: 1.3;
  will-change: transform;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1), 0 3px 3px rgba(0, 0, 0, 0.05);
  max-width: 350px;
  pointer-events: auto;
  padding: 8px 10px;
  border-radius: 8px;
`,Ci=He("div")`
  display: flex;
  justify-content: center;
  margin: 4px 10px;
  color: inherit;
  flex: 1 1 auto;
  white-space: pre-line;
`,Ni=(t,e)=>{let n=t.includes("top")?1:-1,[r,o]=Dr()?[vi,xi]:[bi(n),Ei(n)];return{animation:e?`${_e(r)} 0.35s cubic-bezier(.21,1.02,.73,1) forwards`:`${_e(o)} 0.4s forwards cubic-bezier(.06,.71,.55,1)`}},Ti=q.memo(({toast:t,position:e,style:n,children:r})=>{let o=t.height?Ni(t.position||e||"top-center",t.visible):{opacity:0},s=q.createElement(mi,{toast:t}),i=q.createElement(Ci,{...t.ariaProps},Ct(t.message,t));return q.createElement(Si,{className:t.className,style:{...o,...n,...t.style}},typeof r=="function"?r({icon:s,message:i}):q.createElement(q.Fragment,null,s,i))});Vs(q.createElement);var _i=({id:t,className:e,style:n,onHeightUpdate:r,children:o})=>{let s=q.useCallback(i=>{if(i){let a=()=>{let c=i.getBoundingClientRect().height;r(t,c)};a(),new MutationObserver(a).observe(i,{subtree:!0,childList:!0,characterData:!0})}},[t,r]);return q.createElement("div",{ref:s,className:e,style:n},o)},Ai=(t,e)=>{let n=t.includes("top"),r=n?{top:0}:{bottom:0},o=t.includes("center")?{justifyContent:"center"}:t.includes("right")?{justifyContent:"flex-end"}:{};return{left:0,right:0,display:"flex",position:"absolute",transition:Dr()?void 0:"all 230ms cubic-bezier(.21,1.02,.73,1)",transform:`translateY(${e*(n?1:-1)}px)`,...r,...o}},Ri=Ot`
  z-index: 9999;
  > * {
    pointer-events: auto;
  }
`,Et=16,jf=({reverseOrder:t,position:e="top-center",toastOptions:n,gutter:r,children:o,containerStyle:s,containerClassName:i})=>{let{toasts:a,handlers:c}=oi(n);return q.createElement("div",{id:"_rht_toaster",style:{position:"fixed",zIndex:9999,top:Et,left:Et,right:Et,bottom:Et,pointerEvents:"none",...s},className:i,onMouseEnter:c.startPause,onMouseLeave:c.endPause},a.map(l=>{let f=l.position||e,u=c.calculateOffset(l,{reverseOrder:t,gutter:r,defaultPosition:e}),h=Ai(f,u);return q.createElement(_i,{id:l.id,key:l.id,onHeightUpdate:c.updateHeight,className:l.visible?Ri:"",style:h},l.type==="custom"?Ct(l.message,l):o?o(l):q.createElement(Ti,{toast:l,position:f}))}))},K=re;const Ii=t=>{switch(t){case"success":return Fs;case"error":return Ds;case"warning":return Us;case"info":return fr;case"loading":return Ps;case"nostr":return hr;case"crypto":return dr;case"relay":return Bs;case"auth":return hr;case"zap":return dr;default:return fr}},$i=t=>{switch(t){case"success":return{bg:"bg-emerald-500/10 dark:bg-emerald-400/10",border:"border-emerald-500/20 dark:border-emerald-400/20",icon:"text-emerald-600 dark:text-emerald-400",text:"text-emerald-900 dark:text-emerald-100"};case"error":return{bg:"bg-red-500/10 dark:bg-red-400/10",border:"border-red-500/20 dark:border-red-400/20",icon:"text-red-600 dark:text-red-400",text:"text-red-900 dark:text-red-100"};case"warning":return{bg:"bg-amber-500/10 dark:bg-amber-400/10",border:"border-amber-500/20 dark:border-amber-400/20",icon:"text-amber-600 dark:text-amber-400",text:"text-amber-900 dark:text-amber-100"};case"info":return{bg:"bg-blue-500/10 dark:bg-blue-400/10",border:"border-blue-500/20 dark:border-blue-400/20",icon:"text-blue-600 dark:text-blue-400",text:"text-blue-900 dark:text-blue-100"};case"loading":return{bg:"bg-slate-500/10 dark:bg-slate-400/10",border:"border-slate-500/20 dark:border-slate-400/20",icon:"text-slate-600 dark:text-slate-400",text:"text-slate-900 dark:text-slate-100"};case"nostr":return{bg:"bg-purple-500/10 dark:bg-purple-400/10",border:"border-purple-500/20 dark:border-purple-400/20",icon:"text-purple-600 dark:text-purple-400",text:"text-purple-900 dark:text-purple-100"};case"crypto":return{bg:"bg-orange-500/10 dark:bg-orange-400/10",border:"border-orange-500/20 dark:border-orange-400/20",icon:"text-orange-600 dark:text-orange-400",text:"text-orange-900 dark:text-orange-100"};case"relay":return{bg:"bg-cyan-500/10 dark:bg-cyan-400/10",border:"border-cyan-500/20 dark:border-cyan-400/20",icon:"text-cyan-600 dark:text-cyan-400",text:"text-cyan-900 dark:text-cyan-100"};case"auth":return{bg:"bg-indigo-500/10 dark:bg-indigo-400/10",border:"border-indigo-500/20 dark:border-indigo-400/20",icon:"text-indigo-600 dark:text-indigo-400",text:"text-indigo-900 dark:text-indigo-100"};case"zap":return{bg:"bg-yellow-500/10 dark:bg-yellow-400/10",border:"border-yellow-500/20 dark:border-yellow-400/20",icon:"text-yellow-600 dark:text-yellow-400",text:"text-yellow-900 dark:text-yellow-100"};default:return{bg:"bg-slate-500/10 dark:bg-slate-400/10",border:"border-slate-500/20 dark:border-slate-400/20",icon:"text-slate-600 dark:text-slate-400",text:"text-slate-900 dark:text-slate-100"}}},we=({message:t,description:e,type:n,onClose:r})=>{const o=Ii(n),s=$i(n);return j.jsxs("div",{className:`
      flex items-start gap-3 p-4 rounded-lg border backdrop-blur-sm
      ${s.bg} ${s.border}
      shadow-lg max-w-md w-full
      transform transition-all duration-300
    `,children:[j.jsx("div",{className:`flex-shrink-0 mt-0.5 ${s.icon}`,children:j.jsx(o,{className:`h-4 w-4 ${n==="loading"?"animate-spin":""}`})}),j.jsxs("div",{className:"flex-1 min-w-0",children:[j.jsx("div",{className:`text-sm font-medium ${s.text}`,children:t}),e&&j.jsx("div",{className:`text-xs mt-1 opacity-75 ${s.text}`,children:e})]}),j.jsx("button",{onClick:r,className:`flex-shrink-0 text-xs opacity-50 hover:opacity-100 transition-opacity ${s.text}`,children:"Ã—"})]})},Jt={success:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"success",onClose:()=>K.dismiss(r.id)}),{duration:4e3})},error:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"error",onClose:()=>K.dismiss(r.id)}),{duration:6e3})},warning:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"warning",onClose:()=>K.dismiss(r.id)}),{duration:5e3})},info:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"info",onClose:()=>K.dismiss(r.id)}),{duration:4e3})},loading:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"loading",onClose:()=>K.dismiss(r.id)}),{duration:1/0})},nostr:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"nostr",onClose:()=>K.dismiss(r.id)}),{duration:4e3})},crypto:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"crypto",onClose:()=>K.dismiss(r.id)}),{duration:4e3})},relay:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"relay",onClose:()=>K.dismiss(r.id)}),{duration:4e3})},auth:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"auth",onClose:()=>K.dismiss(r.id)}),{duration:4e3})},zap:(t,e)=>{const n=typeof e=="string"?e:e==null?void 0:e.description;return K.custom(r=>j.jsx(we,{message:t,description:n,type:"zap",onClose:()=>K.dismiss(r.id)}),{duration:4e3})},promise:(t,{loading:e,success:n,error:r})=>K.promise(t,{loading:e,success:n,error:r}),dismiss:t=>{K.dismiss(t)},remove:t=>{K.remove(t)}};function pr(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function Hr(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Oi(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");pr(t.outputLen),pr(t.blockLen)}function Nt(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function ki(t,e){Hr(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const Zt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const jr=t=>t instanceof Uint8Array,Yt=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),me=(t,e)=>t<<32-e|t>>>e,Li=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Li)throw new Error("Non little-endian hardware is not supported");function Mi(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Cn(t){if(typeof t=="string"&&(t=Mi(t)),!jr(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Bi(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!jr(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}let qr=class{clone(){return this._cloneInto()}};function Pi(t){const e=r=>t().update(Cn(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function Wr(t=32){if(Zt&&typeof Zt.getRandomValues=="function")return Zt.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function Ui(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}let Di=class extends qr{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Yt(this.buffer)}update(e){Nt(this);const{view:n,buffer:r,blockLen:o}=this;e=Cn(e);const s=e.length;for(let i=0;i<s;){const a=Math.min(o-this.pos,s-i);if(a===o){const c=Yt(e);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Nt(this),ki(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;Ui(r,o-8,BigInt(this.length*8),s),this.process(r,0);const a=Yt(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return e.length=o,e.pos=a,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}};const Fi=(t,e,n)=>t&e^~t&n,Hi=(t,e,n)=>t&e^t&n^e&n,ji=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Oe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ke=new Uint32Array(64);let qi=class extends Di{constructor(){super(64,32,8,!1),this.A=Oe[0]|0,this.B=Oe[1]|0,this.C=Oe[2]|0,this.D=Oe[3]|0,this.E=Oe[4]|0,this.F=Oe[5]|0,this.G=Oe[6]|0,this.H=Oe[7]|0}get(){const{A:e,B:n,C:r,D:o,E:s,F:i,G:a,H:c}=this;return[e,n,r,o,s,i,a,c]}set(e,n,r,o,s,i,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(e,n){for(let u=0;u<16;u++,n+=4)ke[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){const h=ke[u-15],p=ke[u-2],y=me(h,7)^me(h,18)^h>>>3,d=me(p,17)^me(p,19)^p>>>10;ke[u]=d+ke[u-7]+y+ke[u-16]|0}let{A:r,B:o,C:s,D:i,E:a,F:c,G:l,H:f}=this;for(let u=0;u<64;u++){const h=me(a,6)^me(a,11)^me(a,25),p=f+h+Fi(a,c,l)+ji[u]+ke[u]|0,d=(me(r,2)^me(r,13)^me(r,22))+Hi(r,o,s)|0;f=l,l=c,c=a,a=i+p|0,i=s,s=o,o=r,r=p+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,o,s,i,a,c,l,f)}roundClean(){ke.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const fn=Pi(()=>new qi);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Kr=BigInt(0),kt=BigInt(1),Wi=BigInt(2),Lt=t=>t instanceof Uint8Array,Ki=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function tt(t){if(!Lt(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Ki[t[n]];return e}function zr(t){const e=t.toString(16);return e.length&1?`0${e}`:e}function Nn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return BigInt(t===""?"0":`0x${t}`)}function nt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function ie(t){return Nn(tt(t))}function Tn(t){if(!Lt(t))throw new Error("Uint8Array expected");return Nn(tt(Uint8Array.from(t).reverse()))}function De(t,e){return nt(t.toString(16).padStart(e*2,"0"))}function _n(t,e){return De(t,e).reverse()}function zi(t){return nt(zr(t))}function X(t,e,n){let r;if(typeof e=="string")try{r=nt(e)}catch(s){throw new Error(`${t} must be valid hex string, got "${e}". Cause: ${s}`)}else if(Lt(e))r=Uint8Array.from(e);else throw new Error(`${t} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${t} expected ${n} bytes, got ${o}`);return r}function Ge(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!Lt(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}function Vi(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function Gi(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Ji(t){let e;for(e=0;t>Kr;t>>=kt,e+=1);return e}function Zi(t,e){return t>>BigInt(e)&kt}const Yi=(t,e,n)=>t|(n?kt:Kr)<<BigInt(e),An=t=>(Wi<<BigInt(t-1))-kt,Qt=t=>new Uint8Array(t),yr=t=>Uint8Array.from(t);function Vr(t,e,n){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Qt(t),o=Qt(t),s=0;const i=()=>{r.fill(1),o.fill(0),s=0},a=(...u)=>n(o,r,...u),c=(u=Qt())=>{o=a(yr([0]),u),r=a(),u.length!==0&&(o=a(yr([1]),u),r=a())},l=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let u=0;const h=[];for(;u<e;){r=a();const p=r.slice();h.push(p),u+=r.length}return Ge(...h)};return(u,h)=>{i(),c(u);let p;for(;!(p=h(l()));)c();return i(),p}}const Qi={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||t instanceof Uint8Array,isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function bt(t,e,n={}){const r=(o,s,i)=>{const a=Qi[s];if(typeof a!="function")throw new Error(`Invalid validator "${s}", expected function`);const c=t[o];if(!(i&&c===void 0)&&!a(c,t))throw new Error(`Invalid param ${String(o)}=${c} (${typeof c}), expected ${s}`)};for(const[o,s]of Object.entries(e))r(o,s,!1);for(const[o,s]of Object.entries(n))r(o,s,!0);return t}const Xi=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Zi,bitLen:Ji,bitMask:An,bitSet:Yi,bytesToHex:tt,bytesToNumberBE:ie,bytesToNumberLE:Tn,concatBytes:Ge,createHmacDrbg:Vr,ensureBytes:X,equalBytes:Vi,hexToBytes:nt,hexToNumber:Nn,numberToBytesBE:De,numberToBytesLE:_n,numberToHexUnpadded:zr,numberToVarBytesBE:zi,utf8ToBytes:Gi,validateObject:bt},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const J=BigInt(0),z=BigInt(1),We=BigInt(2),ea=BigInt(3),dn=BigInt(4),wr=BigInt(5),mr=BigInt(8);BigInt(9);BigInt(16);function Y(t,e){const n=t%e;return n>=J?n:e+n}function ta(t,e,n){if(n<=J||e<J)throw new Error("Expected power/modulo > 0");if(n===z)return J;let r=z;for(;e>J;)e&z&&(r=r*t%n),t=t*t%n,e>>=z;return r}function le(t,e,n){let r=t;for(;e-- >J;)r*=r,r%=n;return r}function hn(t,e){if(t===J||e<=J)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=Y(t,e),r=e,o=J,s=z;for(;n!==J;){const a=r/n,c=r%n,l=o-s*a;r=n,n=c,o=s,s=l}if(r!==z)throw new Error("invert: does not exist");return Y(o,e)}function na(t){const e=(t-z)/We;let n,r,o;for(n=t-z,r=0;n%We===J;n/=We,r++);for(o=We;o<t&&ta(o,e,t)!==t-z;o++);if(r===1){const i=(t+z)/dn;return function(c,l){const f=c.pow(l,i);if(!c.eql(c.sqr(f),l))throw new Error("Cannot find square root");return f}}const s=(n+z)/We;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=r,f=a.pow(a.mul(a.ONE,o),n),u=a.pow(c,s),h=a.pow(c,n);for(;!a.eql(h,a.ONE);){if(a.eql(h,a.ZERO))return a.ZERO;let p=1;for(let d=a.sqr(h);p<l&&!a.eql(d,a.ONE);p++)d=a.sqr(d);const y=a.pow(f,z<<BigInt(l-p-1));f=a.sqr(y),u=a.mul(u,y),h=a.mul(h,f),l=p}return u}}function ra(t){if(t%dn===ea){const e=(t+z)/dn;return function(r,o){const s=r.pow(o,e);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(t%mr===wr){const e=(t-wr)/mr;return function(r,o){const s=r.mul(o,We),i=r.pow(s,e),a=r.mul(o,i),c=r.mul(r.mul(a,We),i),l=r.mul(a,r.sub(c,r.ONE));if(!r.eql(r.sqr(l),o))throw new Error("Cannot find square root");return l}}return na(t)}const oa=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sa(t){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=oa.reduce((r,o)=>(r[o]="function",r),e);return bt(t,n)}function ia(t,e,n){if(n<J)throw new Error("Expected power > 0");if(n===J)return t.ONE;if(n===z)return e;let r=t.ONE,o=e;for(;n>J;)n&z&&(r=t.mul(r,o)),o=t.sqr(o),n>>=z;return r}function aa(t,e){const n=new Array(e.length),r=e.reduce((s,i,a)=>t.is0(i)?s:(n[a]=s,t.mul(s,i)),t.ONE),o=t.inv(r);return e.reduceRight((s,i,a)=>t.is0(i)?s:(n[a]=t.mul(s,n[a]),t.mul(s,i)),o),n}function Gr(t,e){const n=e!==void 0?e:t.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function ca(t,e,n=!1,r={}){if(t<=J)throw new Error(`Expected Field ORDER > 0, got ${t}`);const{nBitLength:o,nByteLength:s}=Gr(t,e);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=ra(t),a=Object.freeze({ORDER:t,BITS:o,BYTES:s,MASK:An(o),ZERO:J,ONE:z,create:c=>Y(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return J<=c&&c<t},is0:c=>c===J,isOdd:c=>(c&z)===z,neg:c=>Y(-c,t),eql:(c,l)=>c===l,sqr:c=>Y(c*c,t),add:(c,l)=>Y(c+l,t),sub:(c,l)=>Y(c-l,t),mul:(c,l)=>Y(c*l,t),pow:(c,l)=>ia(a,c,l),div:(c,l)=>Y(c*hn(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>hn(c,t),sqrt:r.sqrt||(c=>i(a,c)),invertBatch:c=>aa(a,c),cmov:(c,l,f)=>f?l:c,toBytes:c=>n?_n(c,s):De(c,s),fromBytes:c=>{if(c.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${c.length}`);return n?Tn(c):ie(c)}});return Object.freeze(a)}function Jr(t){if(typeof t!="bigint")throw new Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function Zr(t){const e=Jr(t);return e+Math.ceil(e/2)}function la(t,e,n=!1){const r=t.length,o=Jr(e),s=Zr(e);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const i=n?ie(t):Tn(t),a=Y(i,e-z)+z;return n?_n(a,o):De(a,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ua=BigInt(0),Xt=BigInt(1);function fa(t,e){const n=(o,s)=>{const i=s.negate();return o?i:s},r=o=>{const s=Math.ceil(e/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=t.ZERO,a=o;for(;s>ua;)s&Xt&&(i=i.add(a)),a=a.double(),s>>=Xt;return i},precomputeWindow(o,s){const{windows:i,windowSize:a}=r(s),c=[];let l=o,f=l;for(let u=0;u<i;u++){f=l,c.push(f);for(let h=1;h<a;h++)f=f.add(l),c.push(f);l=f.double()}return c},wNAF(o,s,i){const{windows:a,windowSize:c}=r(o);let l=t.ZERO,f=t.BASE;const u=BigInt(2**o-1),h=2**o,p=BigInt(o);for(let y=0;y<a;y++){const d=y*c;let g=Number(i&u);i>>=p,g>c&&(g-=h,i+=Xt);const w=d,E=d+Math.abs(g)-1,v=y%2!==0,A=g<0;g===0?f=f.add(n(v,s[w])):l=l.add(n(A,s[E]))}return{p:l,f}},wNAFCached(o,s,i,a){const c=o._WINDOW_SIZE||1;let l=s.get(o);return l||(l=this.precomputeWindow(o,c),c!==1&&s.set(o,a(l))),this.wNAF(c,l,i)}}}function Yr(t){return sa(t.Fp),bt(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Gr(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function da(t){const e=Yr(t);bt(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=e;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:ha,hexToBytes:ga}=Xi,Ve={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(t){const{Err:e}=Ve;if(t.length<2||t[0]!==2)throw new e("Invalid signature integer tag");const n=t[1],r=t.subarray(2,n+2);if(!n||r.length!==n)throw new e("Invalid signature integer: wrong length");if(r[0]&128)throw new e("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:ha(r),l:t.subarray(n+2)}},toSig(t){const{Err:e}=Ve,n=typeof t=="string"?ga(t):t;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new e("Invalid signature tag");if(n[1]!==r-2)throw new e("Invalid signature: incorrect length");const{d:o,l:s}=Ve._parseInt(n.subarray(2)),{d:i,l:a}=Ve._parseInt(s);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(t){const e=l=>Number.parseInt(l[0],16)&8?"00"+l:l,n=l=>{const f=l.toString(16);return f.length&1?`0${f}`:f},r=e(n(t.s)),o=e(n(t.r)),s=r.length/2,i=o.length/2,a=n(s),c=n(i);return`30${n(i+s+4)}02${c}${o}02${a}${r}`}},Ne=BigInt(0),ue=BigInt(1);BigInt(2);const br=BigInt(3);BigInt(4);function pa(t){const e=da(t),{Fp:n}=e,r=e.toBytes||((y,d,g)=>{const w=d.toAffine();return Ge(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),o=e.fromBytes||(y=>{const d=y.subarray(1),g=n.fromBytes(d.subarray(0,n.BYTES)),w=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:g,y:w}});function s(y){const{a:d,b:g}=e,w=n.sqr(y),E=n.mul(w,y);return n.add(n.add(E,n.mul(y,d)),g)}if(!n.eql(n.sqr(e.Gy),s(e.Gx)))throw new Error("bad generator point: equation left != right");function i(y){return typeof y=="bigint"&&Ne<y&&y<e.n}function a(y){if(!i(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(y){const{allowedPrivateKeyLengths:d,nByteLength:g,wrapPrivateKey:w,n:E}=e;if(d&&typeof y!="bigint"){if(y instanceof Uint8Array&&(y=tt(y)),typeof y!="string"||!d.includes(y.length))throw new Error("Invalid key");y=y.padStart(g*2,"0")}let v;try{v=typeof y=="bigint"?y:ie(X("private key",y,g))}catch{throw new Error(`private key must be ${g} bytes, hex or bigint, not ${typeof y}`)}return w&&(v=Y(v,E)),a(v),v}const l=new Map;function f(y){if(!(y instanceof u))throw new Error("ProjectivePoint expected")}class u{constructor(d,g,w){if(this.px=d,this.py=g,this.pz=w,d==null||!n.isValid(d))throw new Error("x required");if(g==null||!n.isValid(g))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(d){const{x:g,y:w}=d||{};if(!d||!n.isValid(g)||!n.isValid(w))throw new Error("invalid affine point");if(d instanceof u)throw new Error("projective point not allowed");const E=v=>n.eql(v,n.ZERO);return E(g)&&E(w)?u.ZERO:new u(g,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const g=n.invertBatch(d.map(w=>w.pz));return d.map((w,E)=>w.toAffine(g[E])).map(u.fromAffine)}static fromHex(d){const g=u.fromAffine(o(X("pointHex",d)));return g.assertValidity(),g}static fromPrivateKey(d){return u.BASE.multiply(c(d))}_setWindowSize(d){this._WINDOW_SIZE=d,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:g}=this.toAffine();if(!n.isValid(d)||!n.isValid(g))throw new Error("bad point: x or y not FE");const w=n.sqr(g),E=s(d);if(!n.eql(w,E))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){f(d);const{px:g,py:w,pz:E}=this,{px:v,py:A,pz:R}=d,C=n.eql(n.mul(g,R),n.mul(v,E)),T=n.eql(n.mul(w,R),n.mul(A,E));return C&&T}negate(){return new u(this.px,n.neg(this.py),this.pz)}double(){const{a:d,b:g}=e,w=n.mul(g,br),{px:E,py:v,pz:A}=this;let R=n.ZERO,C=n.ZERO,T=n.ZERO,N=n.mul(E,E),L=n.mul(v,v),O=n.mul(A,A),I=n.mul(E,v);return I=n.add(I,I),T=n.mul(E,A),T=n.add(T,T),R=n.mul(d,T),C=n.mul(w,O),C=n.add(R,C),R=n.sub(L,C),C=n.add(L,C),C=n.mul(R,C),R=n.mul(I,R),T=n.mul(w,T),O=n.mul(d,O),I=n.sub(N,O),I=n.mul(d,I),I=n.add(I,T),T=n.add(N,N),N=n.add(T,N),N=n.add(N,O),N=n.mul(N,I),C=n.add(C,N),O=n.mul(v,A),O=n.add(O,O),N=n.mul(O,I),R=n.sub(R,N),T=n.mul(O,L),T=n.add(T,T),T=n.add(T,T),new u(R,C,T)}add(d){f(d);const{px:g,py:w,pz:E}=this,{px:v,py:A,pz:R}=d;let C=n.ZERO,T=n.ZERO,N=n.ZERO;const L=e.a,O=n.mul(e.b,br);let I=n.mul(g,v),B=n.mul(w,A),P=n.mul(E,R),F=n.add(g,w),m=n.add(v,A);F=n.mul(F,m),m=n.add(I,B),F=n.sub(F,m),m=n.add(g,E);let x=n.add(v,R);return m=n.mul(m,x),x=n.add(I,P),m=n.sub(m,x),x=n.add(w,E),C=n.add(A,R),x=n.mul(x,C),C=n.add(B,P),x=n.sub(x,C),N=n.mul(L,m),C=n.mul(O,P),N=n.add(C,N),C=n.sub(B,N),N=n.add(B,N),T=n.mul(C,N),B=n.add(I,I),B=n.add(B,I),P=n.mul(L,P),m=n.mul(O,m),B=n.add(B,P),P=n.sub(I,P),P=n.mul(L,P),m=n.add(m,P),I=n.mul(B,m),T=n.add(T,I),I=n.mul(x,m),C=n.mul(F,C),C=n.sub(C,I),I=n.mul(F,B),N=n.mul(x,N),N=n.add(N,I),new u(C,T,N)}subtract(d){return this.add(d.negate())}is0(){return this.equals(u.ZERO)}wNAF(d){return p.wNAFCached(this,l,d,g=>{const w=n.invertBatch(g.map(E=>E.pz));return g.map((E,v)=>E.toAffine(w[v])).map(u.fromAffine)})}multiplyUnsafe(d){const g=u.ZERO;if(d===Ne)return g;if(a(d),d===ue)return this;const{endo:w}=e;if(!w)return p.unsafeLadder(this,d);let{k1neg:E,k1:v,k2neg:A,k2:R}=w.splitScalar(d),C=g,T=g,N=this;for(;v>Ne||R>Ne;)v&ue&&(C=C.add(N)),R&ue&&(T=T.add(N)),N=N.double(),v>>=ue,R>>=ue;return E&&(C=C.negate()),A&&(T=T.negate()),T=new u(n.mul(T.px,w.beta),T.py,T.pz),C.add(T)}multiply(d){a(d);let g=d,w,E;const{endo:v}=e;if(v){const{k1neg:A,k1:R,k2neg:C,k2:T}=v.splitScalar(g);let{p:N,f:L}=this.wNAF(R),{p:O,f:I}=this.wNAF(T);N=p.constTimeNegate(A,N),O=p.constTimeNegate(C,O),O=new u(n.mul(O.px,v.beta),O.py,O.pz),w=N.add(O),E=L.add(I)}else{const{p:A,f:R}=this.wNAF(g);w=A,E=R}return u.normalizeZ([w,E])[0]}multiplyAndAddUnsafe(d,g,w){const E=u.BASE,v=(R,C)=>C===Ne||C===ue||!R.equals(E)?R.multiplyUnsafe(C):R.multiply(C),A=v(this,g).add(v(d,w));return A.is0()?void 0:A}toAffine(d){const{px:g,py:w,pz:E}=this,v=this.is0();d==null&&(d=v?n.ONE:n.inv(E));const A=n.mul(g,d),R=n.mul(w,d),C=n.mul(E,d);if(v)return{x:n.ZERO,y:n.ZERO};if(!n.eql(C,n.ONE))throw new Error("invZ was invalid");return{x:A,y:R}}isTorsionFree(){const{h:d,isTorsionFree:g}=e;if(d===ue)return!0;if(g)return g(u,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:g}=e;return d===ue?this:g?g(u,this):this.multiplyUnsafe(e.h)}toRawBytes(d=!0){return this.assertValidity(),r(u,this,d)}toHex(d=!0){return tt(this.toRawBytes(d))}}u.BASE=new u(e.Gx,e.Gy,n.ONE),u.ZERO=new u(n.ZERO,n.ONE,n.ZERO);const h=e.nBitLength,p=fa(u,e.endo?Math.ceil(h/2):h);return{CURVE:e,ProjectivePoint:u,normPrivateKeyToScalar:c,weierstrassEquation:s,isWithinCurveOrder:i}}function ya(t){const e=Yr(t);return bt(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function wa(t){const e=ya(t),{Fp:n,n:r}=e,o=n.BYTES+1,s=2*n.BYTES+1;function i(m){return Ne<m&&m<n.ORDER}function a(m){return Y(m,r)}function c(m){return hn(m,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:f,weierstrassEquation:u,isWithinCurveOrder:h}=pa({...e,toBytes(m,x,_){const $=x.toAffine(),S=n.toBytes($.x),k=Ge;return _?k(Uint8Array.from([x.hasEvenY()?2:3]),S):k(Uint8Array.from([4]),S,n.toBytes($.y))},fromBytes(m){const x=m.length,_=m[0],$=m.subarray(1);if(x===o&&(_===2||_===3)){const S=ie($);if(!i(S))throw new Error("Point is not on curve");const k=u(S);let D=n.sqrt(k);const U=(D&ue)===ue;return(_&1)===1!==U&&(D=n.neg(D)),{x:S,y:D}}else if(x===s&&_===4){const S=n.fromBytes($.subarray(0,n.BYTES)),k=n.fromBytes($.subarray(n.BYTES,2*n.BYTES));return{x:S,y:k}}else throw new Error(`Point of length ${x} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),p=m=>tt(De(m,e.nByteLength));function y(m){const x=r>>ue;return m>x}function d(m){return y(m)?a(-m):m}const g=(m,x,_)=>ie(m.slice(x,_));class w{constructor(x,_,$){this.r=x,this.s=_,this.recovery=$,this.assertValidity()}static fromCompact(x){const _=e.nByteLength;return x=X("compactSignature",x,_*2),new w(g(x,0,_),g(x,_,2*_))}static fromDER(x){const{r:_,s:$}=Ve.toSig(X("DER",x));return new w(_,$)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(x){return new w(this.r,this.s,x)}recoverPublicKey(x){const{r:_,s:$,recovery:S}=this,k=T(X("msgHash",x));if(S==null||![0,1,2,3].includes(S))throw new Error("recovery id invalid");const D=S===2||S===3?_+e.n:_;if(D>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const U=S&1?"03":"02",G=l.fromHex(U+p(D)),ee=c(D),ae=a(-k*ee),ce=a($*ee),te=l.BASE.multiplyAndAddUnsafe(G,ae,ce);if(!te)throw new Error("point at infinify");return te.assertValidity(),te}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return nt(this.toDERHex())}toDERHex(){return Ve.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return nt(this.toCompactHex())}toCompactHex(){return p(this.r)+p(this.s)}}const E={isValidPrivateKey(m){try{return f(m),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const m=Zr(e.n);return la(e.randomBytes(m),e.n)},precompute(m=8,x=l.BASE){return x._setWindowSize(m),x.multiply(BigInt(3)),x}};function v(m,x=!0){return l.fromPrivateKey(m).toRawBytes(x)}function A(m){const x=m instanceof Uint8Array,_=typeof m=="string",$=(x||_)&&m.length;return x?$===o||$===s:_?$===2*o||$===2*s:m instanceof l}function R(m,x,_=!0){if(A(m))throw new Error("first arg must be private key");if(!A(x))throw new Error("second arg must be public key");return l.fromHex(x).multiply(f(m)).toRawBytes(_)}const C=e.bits2int||function(m){const x=ie(m),_=m.length*8-e.nBitLength;return _>0?x>>BigInt(_):x},T=e.bits2int_modN||function(m){return a(C(m))},N=An(e.nBitLength);function L(m){if(typeof m!="bigint")throw new Error("bigint expected");if(!(Ne<=m&&m<N))throw new Error(`bigint expected < 2^${e.nBitLength}`);return De(m,e.nByteLength)}function O(m,x,_=I){if(["recovered","canonical"].some(oe=>oe in _))throw new Error("sign() legacy options not supported");const{hash:$,randomBytes:S}=e;let{lowS:k,prehash:D,extraEntropy:U}=_;k==null&&(k=!0),m=X("msgHash",m),D&&(m=X("prehashed msgHash",$(m)));const G=T(m),ee=f(x),ae=[L(ee),L(G)];if(U!=null){const oe=U===!0?S(n.BYTES):U;ae.push(X("extraEntropy",oe))}const ce=Ge(...ae),te=G;function ye(oe){const Ze=C(oe);if(!h(Ze))return;const cr=c(Ze),Ye=l.BASE.multiply(Ze).toAffine(),he=a(Ye.x);if(he===Ne)return;const Qe=a(cr*a(te+he*ee));if(Qe===Ne)return;let lr=(Ye.x===he?0:2)|Number(Ye.y&ue),ur=Qe;return k&&y(Qe)&&(ur=d(Qe),lr^=1),new w(he,ur,lr)}return{seed:ce,k2sig:ye}}const I={lowS:e.lowS,prehash:!1},B={lowS:e.lowS,prehash:!1};function P(m,x,_=I){const{seed:$,k2sig:S}=O(m,x,_),k=e;return Vr(k.hash.outputLen,k.nByteLength,k.hmac)($,S)}l.BASE._setWindowSize(8);function F(m,x,_,$=B){var Ye;const S=m;if(x=X("msgHash",x),_=X("publicKey",_),"strict"in $)throw new Error("options.strict was renamed to lowS");const{lowS:k,prehash:D}=$;let U,G;try{if(typeof S=="string"||S instanceof Uint8Array)try{U=w.fromDER(S)}catch(he){if(!(he instanceof Ve.Err))throw he;U=w.fromCompact(S)}else if(typeof S=="object"&&typeof S.r=="bigint"&&typeof S.s=="bigint"){const{r:he,s:Qe}=S;U=new w(he,Qe)}else throw new Error("PARSE");G=l.fromHex(_)}catch(he){if(he.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(k&&U.hasHighS())return!1;D&&(x=e.hash(x));const{r:ee,s:ae}=U,ce=T(x),te=c(ae),ye=a(ce*te),oe=a(ee*te),Ze=(Ye=l.BASE.multiplyAndAddUnsafe(G,ye,oe))==null?void 0:Ye.toAffine();return Ze?a(Ze.x)===ee:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:R,sign:P,verify:F,ProjectivePoint:l,Signature:w,utils:E}}let Qr=class extends qr{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,Oi(e);const r=Cn(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return Nt(this),this.iHash.update(e),this}digestInto(e){Nt(this),Hr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Xr=(t,e,n)=>new Qr(t,e).update(n).digest();Xr.create=(t,e)=>new Qr(t,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ma(t){return{hash:t,hmac:(e,...n)=>Xr(t,e,Bi(...n)),randomBytes:Wr}}function ba(t,e){const n=r=>wa({...t,...ma(r)});return Object.freeze({...n(e),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Mt=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Tt=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),eo=BigInt(1),_t=BigInt(2),Er=(t,e)=>(t+e/_t)/e;function to(t){const e=Mt,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,f=l*l*t%e,u=le(f,n,e)*f%e,h=le(u,n,e)*f%e,p=le(h,_t,e)*l%e,y=le(p,o,e)*p%e,d=le(y,s,e)*y%e,g=le(d,a,e)*d%e,w=le(g,c,e)*g%e,E=le(w,a,e)*d%e,v=le(E,n,e)*f%e,A=le(v,i,e)*y%e,R=le(A,r,e)*l%e,C=le(R,_t,e);if(!gn.eql(gn.sqr(C),t))throw new Error("Cannot find square root");return C}const gn=ca(Mt,void 0,void 0,{sqrt:to}),it=ba({a:BigInt(0),b:BigInt(7),Fp:gn,n:Tt,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{const e=Tt,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-eo*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),a=Er(s*t,e),c=Er(-r*t,e);let l=Y(t-a*n-c*o,e),f=Y(-a*r-c*s,e);const u=l>i,h=f>i;if(u&&(l=e-l),h&&(f=e-f),l>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:u,k1:l,k2neg:h,k2:f}}}},fn),Bt=BigInt(0),no=t=>typeof t=="bigint"&&Bt<t&&t<Mt,Ea=t=>typeof t=="bigint"&&Bt<t&&t<Tt,vr={};function At(t,...e){let n=vr[t];if(n===void 0){const r=fn(Uint8Array.from(t,o=>o.charCodeAt(0)));n=Ge(r,r),vr[t]=n}return fn(Ge(n,...e))}const Rn=t=>t.toRawBytes(!0).slice(1),pn=t=>De(t,32),en=t=>Y(t,Mt),yt=t=>Y(t,Tt),In=it.ProjectivePoint,va=(t,e,n)=>In.BASE.multiplyAndAddUnsafe(t,e,n);function yn(t){let e=it.utils.normPrivateKeyToScalar(t),n=In.fromPrivateKey(e);return{scalar:n.hasEvenY()?e:yt(-e),bytes:Rn(n)}}function ro(t){if(!no(t))throw new Error("bad x: need 0 < x < p");const e=en(t*t),n=en(e*t+BigInt(7));let r=to(n);r%_t!==Bt&&(r=en(-r));const o=new In(t,r,eo);return o.assertValidity(),o}function oo(...t){return yt(ie(At("BIP0340/challenge",...t)))}function xa(t){return yn(t).bytes}function Sa(t,e,n=Wr(32)){const r=X("message",t),{bytes:o,scalar:s}=yn(e),i=X("auxRand",n,32),a=pn(s^ie(At("BIP0340/aux",i))),c=At("BIP0340/nonce",a,o,r),l=yt(ie(c));if(l===Bt)throw new Error("sign failed: k is zero");const{bytes:f,scalar:u}=yn(l),h=oo(f,o,r),p=new Uint8Array(64);if(p.set(f,0),p.set(pn(yt(u+h*s)),32),!so(p,r,o))throw new Error("sign: Invalid signature produced");return p}function so(t,e,n){const r=X("signature",t,64),o=X("message",e),s=X("publicKey",n,32);try{const i=ro(ie(s)),a=ie(r.subarray(0,32));if(!no(a))return!1;const c=ie(r.subarray(32,64));if(!Ea(c))return!1;const l=oo(pn(a),Rn(i),o),f=va(i,c,yt(-l));return!(!f||!f.hasEvenY()||f.toAffine().x!==a)}catch{return!1}}const lt={getPublicKey:xa,sign:Sa,verify:so,utils:{randomPrivateKey:it.utils.randomPrivateKey,lift_x:ro,pointToBytes:Rn,numberToBytesBE:De,bytesToNumberBE:ie,taggedHash:At,mod:Y}},tn=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const $n=t=>t instanceof Uint8Array,nn=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),be=(t,e)=>t<<32-e|t>>>e,Ca=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ca)throw new Error("Non little-endian hardware is not supported");const Na=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function ne(t){if(!$n(t))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Na[t[n]];return e}function rt(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);const e=t.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(e/2);for(let r=0;r<n.length;r++){const o=r*2,s=t.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function Ta(t){if(typeof t!="string")throw new Error(`utf8ToBytes expected string, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function wt(t){if(typeof t=="string"&&(t=Ta(t)),!$n(t))throw new Error(`expected Uint8Array, got ${typeof t}`);return t}function Pt(...t){const e=new Uint8Array(t.reduce((r,o)=>r+o.length,0));let n=0;return t.forEach(r=>{if(!$n(r))throw new Error("Uint8Array expected");e.set(r,n),n+=r.length}),e}class io{clone(){return this._cloneInto()}}function ao(t){const e=r=>t().update(wt(r)).digest(),n=t();return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=()=>t(),e}function co(t=32){if(tn&&typeof tn.getRandomValues=="function")return tn.getRandomValues(new Uint8Array(t));throw new Error("crypto.getRandomValues must be defined")}function wn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`Wrong positive integer: ${t}`)}function _a(t){if(typeof t!="boolean")throw new Error(`Expected boolean, not ${t}`)}function lo(t,...e){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(t.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${t.length}`)}function Aa(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");wn(t.outputLen),wn(t.blockLen)}function Ra(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Ia(t,e){lo(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ve={number:wn,bool:_a,bytes:lo,hash:Aa,exists:Ra,output:Ia};function $a(t,e,n,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),a=Number(n&s),c=r?4:0,l=r?0:4;t.setUint32(e+c,i,r),t.setUint32(e+l,a,r)}class Oa extends io{constructor(e,n,r,o){super(),this.blockLen=e,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=nn(this.buffer)}update(e){ve.exists(this);const{view:n,buffer:r,blockLen:o}=this;e=wt(e);const s=e.length;for(let i=0;i<s;){const a=Math.min(o-this.pos,s-i);if(a===o){const c=nn(e);for(;o<=s-i;i+=o)this.process(c,i);continue}r.set(e.subarray(i,i+a),this.pos),this.pos+=a,i+=a,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ve.exists(this),ve.output(e,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let u=i;u<o;u++)n[u]=0;$a(r,o-8,BigInt(this.length*8),s),this.process(r,0);const a=nn(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,f=this.get();if(l>f.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)a.setUint32(4*u,f[u],s)}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:a}=this;return e.length=o,e.pos=a,e.finished=s,e.destroyed=i,o%n&&e.buffer.set(r),e}}const ka=(t,e,n)=>t&e^~t&n,La=(t,e,n)=>t&e^t&n^e&n,Ma=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Le=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Me=new Uint32Array(64);class uo extends Oa{constructor(){super(64,32,8,!1),this.A=Le[0]|0,this.B=Le[1]|0,this.C=Le[2]|0,this.D=Le[3]|0,this.E=Le[4]|0,this.F=Le[5]|0,this.G=Le[6]|0,this.H=Le[7]|0}get(){const{A:e,B:n,C:r,D:o,E:s,F:i,G:a,H:c}=this;return[e,n,r,o,s,i,a,c]}set(e,n,r,o,s,i,a,c){this.A=e|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=a|0,this.H=c|0}process(e,n){for(let u=0;u<16;u++,n+=4)Me[u]=e.getUint32(n,!1);for(let u=16;u<64;u++){const h=Me[u-15],p=Me[u-2],y=be(h,7)^be(h,18)^h>>>3,d=be(p,17)^be(p,19)^p>>>10;Me[u]=d+Me[u-7]+y+Me[u-16]|0}let{A:r,B:o,C:s,D:i,E:a,F:c,G:l,H:f}=this;for(let u=0;u<64;u++){const h=be(a,6)^be(a,11)^be(a,25),p=f+h+ka(a,c,l)+Ma[u]+Me[u]|0,d=(be(r,2)^be(r,13)^be(r,22))+La(r,o,s)|0;f=l,l=c,c=a,a=i+p|0,i=s,s=o,o=r,r=p+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,f=f+this.H|0,this.set(r,o,s,i,a,c,l,f)}roundClean(){Me.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class Ba extends uo{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const at=ao(()=>new uo);ao(()=>new Ba);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ct(t){if(!Number.isSafeInteger(t))throw new Error(`Wrong integer: ${t}`)}function Re(...t){const e=(o,s)=>i=>o(s(i)),n=Array.from(t).reverse().reduce((o,s)=>o?e(o,s.encode):s.encode,void 0),r=t.reduce((o,s)=>o?e(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function Ie(t){return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return e.map(n=>{if(ct(n),n<0||n>=t.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${t.length})`);return t[n]})},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("alphabet.decode input should be array of strings");return e.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=t.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${t}`);return r})}}}function $e(t=""){if(typeof t!="string")throw new Error("join separator should be string");return{encode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of e)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return e.join(t)},decode:e=>{if(typeof e!="string")throw new Error("join.decode input should be string");return e.split(t)}}}function Ut(t,e="="){if(ct(t),typeof e!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*t%8;)n.push(e);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*t%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===e;r--)if(!((r-1)*t%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function fo(t){if(typeof t!="function")throw new Error("normalize fn should be function");return{encode:e=>e,decode:e=>t(e)}}function xr(t,e,n){if(e<2)throw new Error(`convertRadix: wrong from=${e}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(t))throw new Error("convertRadix: data should be array");if(!t.length)return[];let r=0;const o=[],s=Array.from(t);for(s.forEach(i=>{if(ct(i),i<0||i>=e)throw new Error(`Wrong integer: ${i}`)});;){let i=0,a=!0;for(let c=r;c<s.length;c++){const l=s[c],f=e*i+l;if(!Number.isSafeInteger(f)||e*i/e!==i||f-l!==e*i)throw new Error("convertRadix: carry overflow");if(i=f%n,s[c]=Math.floor(f/n),!Number.isSafeInteger(s[c])||s[c]*n+i!==f)throw new Error("convertRadix: carry overflow");if(a)s[c]?a=!1:r=c;else continue}if(o.push(i),a)break}for(let i=0;i<t.length-1&&t[i]===0;i++)o.push(0);return o.reverse()}const ho=(t,e)=>e?ho(e,t%e):t,Rt=(t,e)=>t+(e-ho(t,e));function mn(t,e,n,r){if(!Array.isArray(t))throw new Error("convertRadix2: data should be array");if(e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Rt(e,n)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${n} carryBits=${Rt(e,n)}`);let o=0,s=0;const i=2**n-1,a=[];for(const c of t){if(ct(c),c>=2**e)throw new Error(`convertRadix2: invalid data word=${c} from=${e}`);if(o=o<<e|c,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=n;s-=n)a.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=e)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&a.push(o>>>0),a}function Pa(t){return ct(t),{encode:e=>{if(!(e instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return xr(Array.from(e),2**8,t)},decode:e=>{if(!Array.isArray(e)||e.length&&typeof e[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from(xr(e,t,2**8))}}}function je(t,e=!1){if(ct(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(Rt(8,t)>32||Rt(t,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return mn(Array.from(n),8,t,!e)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(mn(n,t,8,e))}}}function Sr(t){if(typeof t!="function")throw new Error("unsafeWrapper fn should be function");return function(...e){try{return t.apply(null,e)}catch{}}}const Ua=Re(je(4),Ie("0123456789ABCDEF"),$e("")),Da=Re(je(5),Ie("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),Ut(5),$e(""));Re(je(5),Ie("0123456789ABCDEFGHIJKLMNOPQRSTUV"),Ut(5),$e(""));Re(je(5),Ie("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),$e(""),fo(t=>t.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const Ae=Re(je(6),Ie("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),Ut(6),$e("")),Fa=Re(je(6),Ie("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),Ut(6),$e("")),On=t=>Re(Pa(58),Ie(t),$e("")),bn=On("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");On("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");On("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Cr=[0,2,3,5,6,7,9,10,11],Ha={encode(t){let e="";for(let n=0;n<t.length;n+=8){const r=t.subarray(n,n+8);e+=bn.encode(r).padStart(Cr[r.length],"1")}return e},decode(t){let e=[];for(let n=0;n<t.length;n+=11){const r=t.slice(n,n+11),o=Cr.indexOf(r.length),s=bn.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");e=e.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(e)}},En=Re(Ie("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),$e("")),Nr=[996825010,642813549,513874426,1027748829,705979059];function ut(t){const e=t>>25;let n=(t&33554431)<<5;for(let r=0;r<Nr.length;r++)(e>>r&1)===1&&(n^=Nr[r]);return n}function Tr(t,e,n=1){const r=t.length;let o=1;for(let s=0;s<r;s++){const i=t.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${t})`);o=ut(o)^i>>5}o=ut(o);for(let s=0;s<r;s++)o=ut(o)^t.charCodeAt(s)&31;for(let s of e)o=ut(o)^s;for(let s=0;s<6;s++)o=ut(o);return o^=n,En.encode(mn([o%2**30],30,5,!1))}function go(t){const e=t==="bech32"?1:734539939,n=je(5),r=n.decode,o=n.encode,s=Sr(r);function i(f,u,h=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(u)||u.length&&typeof u[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof u}`);const p=f.length+7+u.length;if(h!==!1&&p>h)throw new TypeError(`Length ${p} exceeds limit ${h}`);return f=f.toLowerCase(),`${f}1${En.encode(u)}${Tr(f,u,e)}`}function a(f,u=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||u!==!1&&f.length>u)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${u})`);const h=f.toLowerCase();if(f!==h&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=h;const p=f.lastIndexOf("1");if(p===0||p===-1)throw new Error('Letter "1" must be present between prefix and data only');const y=f.slice(0,p),d=f.slice(p+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");const g=En.decode(d).slice(0,-6),w=Tr(y,g,e);if(!d.endsWith(w))throw new Error(`Invalid checksum in ${f}: expected "${w}"`);return{prefix:y,words:g}}const c=Sr(a);function l(f){const{prefix:u,words:h}=a(f,!1);return{prefix:u,words:h,bytes:r(h)}}return{encode:i,decode:a,decodeToBytes:l,decodeUnsafe:c,fromWords:r,fromWordsUnsafe:s,toWords:o}}const ot=go("bech32");go("bech32m");const ja={encode:t=>new TextDecoder().decode(t),decode:t=>new TextEncoder().encode(t)},qa=Re(je(4),Ie("0123456789abcdef"),$e(""),fo(t=>{if(typeof t!="string"||t.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof t} with length ${t.length}`);return t.toLowerCase()})),Wa={utf8:ja,hex:qa,base16:Ua,base32:Da,base64:Ae,base64url:Fa,base58:bn,base58xmr:Ha};`${Object.keys(Wa).join(", ")}`;function rn(t){if(!Number.isSafeInteger(t)||t<0)throw new Error(`positive integer expected, not ${t}`)}function _r(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function po(t){return t instanceof Uint8Array||t!=null&&typeof t=="object"&&t.constructor.name==="Uint8Array"}function de(t,...e){if(!po(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${t.length}`)}function st(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function kn(t,e){de(t);const n=e.outputLen;if(t.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const V=t=>new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4)),Ka=t=>new DataView(t.buffer,t.byteOffset,t.byteLength),za=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!za)throw new Error("Non little-endian hardware is not supported");function Ln(t){if(typeof t!="string")throw new Error(`string expected, got ${typeof t}`);return new Uint8Array(new TextEncoder().encode(t))}function Fe(t){if(typeof t=="string")t=Ln(t);else if(po(t))t=t.slice();else throw new Error(`Uint8Array expected, got ${typeof t}`);return t}function Va(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function Ga(t,e){if(t.length!==e.length)return!1;let n=0;for(let r=0;r<t.length;r++)n|=t[r]^e[r];return n===0}const Ja=(t,e)=>(Object.assign(e,t),e),Ce=16,Mn=new Uint8Array(16),Ee=V(Mn),Za=225,Ya=(t,e,n,r)=>{const o=r&1;return{s3:n<<31|r>>>1,s2:e<<31|n>>>1,s1:t<<31|e>>>1,s0:t>>>1^Za<<24&-(o&1)}},fe=t=>(t>>>0&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255|0;function Qa(t){t.reverse();const e=t[15]&1;let n=0;for(let r=0;r<t.length;r++){const o=t[r];t[r]=o>>>1|n,n=(o&1)<<7}return t[0]^=-e&225,t}const Xa=t=>t>64*1024?8:t>1024?4:2;class yo{constructor(e,n){this.blockLen=Ce,this.outputLen=Ce,this.s0=0,this.s1=0,this.s2=0,this.s3=0,this.finished=!1,e=Fe(e),de(e,16);const r=Ka(e);let o=r.getUint32(0,!1),s=r.getUint32(4,!1),i=r.getUint32(8,!1),a=r.getUint32(12,!1);const c=[];for(let y=0;y<128;y++)c.push({s0:fe(o),s1:fe(s),s2:fe(i),s3:fe(a)}),{s0:o,s1:s,s2:i,s3:a}=Ya(o,s,i,a);const l=Xa(n||1024);if(![1,2,4,8].includes(l))throw new Error(`ghash: wrong window size=${l}, should be 2, 4 or 8`);this.W=l;const u=128/l,h=this.windowSize=2**l,p=[];for(let y=0;y<u;y++)for(let d=0;d<h;d++){let g=0,w=0,E=0,v=0;for(let A=0;A<l;A++){if(!(d>>>l-A-1&1))continue;const{s0:C,s1:T,s2:N,s3:L}=c[l*y+A];g^=C,w^=T,E^=N,v^=L}p.push({s0:g,s1:w,s2:E,s3:v})}this.t=p}_updateBlock(e,n,r,o){e^=this.s0,n^=this.s1,r^=this.s2,o^=this.s3;const{W:s,t:i,windowSize:a}=this;let c=0,l=0,f=0,u=0;const h=(1<<s)-1;let p=0;for(const y of[e,n,r,o])for(let d=0;d<4;d++){const g=y>>>8*d&255;for(let w=8/s-1;w>=0;w--){const E=g>>>s*w&h,{s0:v,s1:A,s2:R,s3:C}=i[p*a+E];c^=v,l^=A,f^=R,u^=C,p+=1}}this.s0=c,this.s1=l,this.s2=f,this.s3=u}update(e){e=Fe(e),st(this);const n=V(e),r=Math.floor(e.length/Ce),o=e.length%Ce;for(let s=0;s<r;s++)this._updateBlock(n[s*4+0],n[s*4+1],n[s*4+2],n[s*4+3]);return o&&(Mn.set(e.subarray(r*Ce)),this._updateBlock(Ee[0],Ee[1],Ee[2],Ee[3]),Ee.fill(0)),this}destroy(){const{t:e}=this;for(const n of e)n.s0=0,n.s1=0,n.s2=0,n.s3=0}digestInto(e){st(this),kn(e,this),this.finished=!0;const{s0:n,s1:r,s2:o,s3:s}=this,i=V(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e}digest(){const e=new Uint8Array(Ce);return this.digestInto(e),this.destroy(),e}}class ec extends yo{constructor(e,n){e=Fe(e);const r=Qa(e.slice());super(r,n),r.fill(0)}update(e){e=Fe(e),st(this);const n=V(e),r=e.length%Ce,o=Math.floor(e.length/Ce);for(let s=0;s<o;s++)this._updateBlock(fe(n[s*4+3]),fe(n[s*4+2]),fe(n[s*4+1]),fe(n[s*4+0]));return r&&(Mn.set(e.subarray(o*Ce)),this._updateBlock(fe(Ee[3]),fe(Ee[2]),fe(Ee[1]),fe(Ee[0])),Ee.fill(0)),this}digestInto(e){st(this),kn(e,this),this.finished=!0;const{s0:n,s1:r,s2:o,s3:s}=this,i=V(e);return i[0]=n,i[1]=r,i[2]=o,i[3]=s,e.reverse()}}function wo(t){const e=(r,o)=>t(o,r.length).update(Fe(r)).digest(),n=t(new Uint8Array(16),0);return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=(r,o)=>t(r,o),e}wo((t,e)=>new yo(t,e));wo((t,e)=>new ec(t,e));const Ue=16,tc=283;function Bn(t){return t<<1^tc&-(t>>7)}function Xe(t,e){let n=0;for(;e>0;e>>=1)n^=t&-(e&1),t=Bn(t);return n}const vn=(()=>{let t=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=Bn(r))t[n]=r;const e=new Uint8Array(256);e[0]=99;for(let n=0;n<255;n++){let r=t[255-n];r|=r<<8,e[t[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return e})(),nc=vn.map((t,e)=>vn.indexOf(e)),rc=t=>t<<24|t>>>8,on=t=>t<<8|t>>>24;function mo(t,e){if(t.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((l,f)=>e(t[f])),r=n.map(on),o=r.map(on),s=o.map(on),i=new Uint32Array(256*256),a=new Uint32Array(256*256),c=new Uint16Array(256*256);for(let l=0;l<256;l++)for(let f=0;f<256;f++){const u=l*256+f;i[u]=n[l]^r[f],a[u]=o[l]^s[f],c[u]=t[l]<<8|t[f]}return{sbox:t,sbox2:c,T0:n,T1:r,T2:o,T3:s,T01:i,T23:a}}const Pn=mo(vn,t=>Xe(t,3)<<24|t<<16|t<<8|Xe(t,2)),bo=mo(nc,t=>Xe(t,11)<<24|Xe(t,13)<<16|Xe(t,9)<<8|Xe(t,14)),oc=(()=>{const t=new Uint8Array(16);for(let e=0,n=1;e<16;e++,n=Bn(n))t[e]=n;return t})();function Eo(t){de(t);const e=t.length;if(![16,24,32].includes(e))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${e}`);const{sbox2:n}=Pn,r=V(t),o=r.length,s=a=>xe(n,a,a,a,a),i=new Uint32Array(e+28);i.set(r);for(let a=o;a<i.length;a++){let c=i[a-1];a%o===0?c=s(rc(c))^oc[a/o-1]:o>6&&a%o===4&&(c=s(c)),i[a]=i[a-o]^c}return i}function sc(t){const e=Eo(t),n=e.slice(),r=e.length,{sbox2:o}=Pn,{T0:s,T1:i,T2:a,T3:c}=bo;for(let l=0;l<r;l+=4)for(let f=0;f<4;f++)n[l+f]=e[r-l-4+f];e.fill(0);for(let l=4;l<r-4;l++){const f=n[l],u=xe(o,f,f,f,f);n[l]=s[u&255]^i[u>>>8&255]^a[u>>>16&255]^c[u>>>24]}return n}function Pe(t,e,n,r,o,s){return t[n<<8&65280|r>>>8&255]^e[o>>>8&65280|s>>>24&255]}function xe(t,e,n,r,o){return t[e&255|n&65280]|t[r>>>16&255|o>>>16&65280]<<16}function Ar(t,e,n,r,o){const{sbox2:s,T01:i,T23:a}=Pn;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],o^=t[c++];const l=t.length/4-2;for(let y=0;y<l;y++){const d=t[c++]^Pe(i,a,e,n,r,o),g=t[c++]^Pe(i,a,n,r,o,e),w=t[c++]^Pe(i,a,r,o,e,n),E=t[c++]^Pe(i,a,o,e,n,r);e=d,n=g,r=w,o=E}const f=t[c++]^xe(s,e,n,r,o),u=t[c++]^xe(s,n,r,o,e),h=t[c++]^xe(s,r,o,e,n),p=t[c++]^xe(s,o,e,n,r);return{s0:f,s1:u,s2:h,s3:p}}function ic(t,e,n,r,o){const{sbox2:s,T01:i,T23:a}=bo;let c=0;e^=t[c++],n^=t[c++],r^=t[c++],o^=t[c++];const l=t.length/4-2;for(let y=0;y<l;y++){const d=t[c++]^Pe(i,a,e,o,r,n),g=t[c++]^Pe(i,a,n,e,o,r),w=t[c++]^Pe(i,a,r,n,e,o),E=t[c++]^Pe(i,a,o,r,n,e);e=d,n=g,r=w,o=E}const f=t[c++]^xe(s,e,o,r,n),u=t[c++]^xe(s,n,e,o,r),h=t[c++]^xe(s,r,n,e,o),p=t[c++]^xe(s,o,r,n,e);return{s0:f,s1:u,s2:h,s3:p}}function vo(t,e){if(!e)return new Uint8Array(t);if(de(e),e.length<t)throw new Error(`aes: wrong destination length, expected at least ${t}, got: ${e.length}`);return e}function ac(t){if(de(t),t.length%Ue!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Ue}`)}function cc(t,e,n){let r=t.length;const o=r%Ue;if(!e&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=V(t);if(e){let c=Ue-o;c||(c=Ue),r=r+c}const i=vo(r,n),a=V(i);return{b:s,o:a,out:i}}function lc(t,e){if(!e)return t;const n=t.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=t[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const o=t.subarray(0,-r);for(let s=0;s<r;s++)if(t[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function uc(t){const e=new Uint8Array(16),n=V(e);e.set(t);const r=Ue-t.length;for(let o=Ue-r;o<Ue;o++)e[o]=r;return n}const xo=Ja({blockSize:16,nonceLength:16},function(e,n,r={}){de(e),de(n,16);const o=!r.disablePadding;return{encrypt:(s,i)=>{const a=Eo(e),{b:c,o:l,out:f}=cc(s,o,i),u=V(n);let h=u[0],p=u[1],y=u[2],d=u[3],g=0;for(;g+4<=c.length;)h^=c[g+0],p^=c[g+1],y^=c[g+2],d^=c[g+3],{s0:h,s1:p,s2:y,s3:d}=Ar(a,h,p,y,d),l[g++]=h,l[g++]=p,l[g++]=y,l[g++]=d;if(o){const w=uc(s.subarray(g*4));h^=w[0],p^=w[1],y^=w[2],d^=w[3],{s0:h,s1:p,s2:y,s3:d}=Ar(a,h,p,y,d),l[g++]=h,l[g++]=p,l[g++]=y,l[g++]=d}return a.fill(0),f},decrypt:(s,i)=>{ac(s);const a=sc(e),c=V(n),l=vo(s.length,i),f=V(s),u=V(l);let h=c[0],p=c[1],y=c[2],d=c[3];for(let g=0;g+4<=f.length;){const w=h,E=p,v=y,A=d;h=f[g+0],p=f[g+1],y=f[g+2],d=f[g+3];const{s0:R,s1:C,s2:T,s3:N}=ic(a,h,p,y,d);u[g++]=R^w,u[g++]=C^E,u[g++]=T^v,u[g++]=N^A}return a.fill(0),lc(l,o)}}}),Z=(t,e)=>t[e++]&255|(t[e++]&255)<<8;class fc{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Fe(e),de(e,32);const n=Z(e,0),r=Z(e,2),o=Z(e,4),s=Z(e,6),i=Z(e,8),a=Z(e,10),c=Z(e,12),l=Z(e,14);this.r[0]=n&8191,this.r[1]=(n>>>13|r<<3)&8191,this.r[2]=(r>>>10|o<<6)&7939,this.r[3]=(o>>>7|s<<9)&8191,this.r[4]=(s>>>4|i<<12)&255,this.r[5]=i>>>1&8190,this.r[6]=(i>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let f=0;f<8;f++)this.pad[f]=Z(e,16+2*f)}process(e,n,r=!1){const o=r?0:2048,{h:s,r:i}=this,a=i[0],c=i[1],l=i[2],f=i[3],u=i[4],h=i[5],p=i[6],y=i[7],d=i[8],g=i[9],w=Z(e,n+0),E=Z(e,n+2),v=Z(e,n+4),A=Z(e,n+6),R=Z(e,n+8),C=Z(e,n+10),T=Z(e,n+12),N=Z(e,n+14);let L=s[0]+(w&8191),O=s[1]+((w>>>13|E<<3)&8191),I=s[2]+((E>>>10|v<<6)&8191),B=s[3]+((v>>>7|A<<9)&8191),P=s[4]+((A>>>4|R<<12)&8191),F=s[5]+(R>>>1&8191),m=s[6]+((R>>>14|C<<2)&8191),x=s[7]+((C>>>11|T<<5)&8191),_=s[8]+((T>>>8|N<<8)&8191),$=s[9]+(N>>>5|o),S=0,k=S+L*a+O*(5*g)+I*(5*d)+B*(5*y)+P*(5*p);S=k>>>13,k&=8191,k+=F*(5*h)+m*(5*u)+x*(5*f)+_*(5*l)+$*(5*c),S+=k>>>13,k&=8191;let D=S+L*c+O*a+I*(5*g)+B*(5*d)+P*(5*y);S=D>>>13,D&=8191,D+=F*(5*p)+m*(5*h)+x*(5*u)+_*(5*f)+$*(5*l),S+=D>>>13,D&=8191;let U=S+L*l+O*c+I*a+B*(5*g)+P*(5*d);S=U>>>13,U&=8191,U+=F*(5*y)+m*(5*p)+x*(5*h)+_*(5*u)+$*(5*f),S+=U>>>13,U&=8191;let G=S+L*f+O*l+I*c+B*a+P*(5*g);S=G>>>13,G&=8191,G+=F*(5*d)+m*(5*y)+x*(5*p)+_*(5*h)+$*(5*u),S+=G>>>13,G&=8191;let ee=S+L*u+O*f+I*l+B*c+P*a;S=ee>>>13,ee&=8191,ee+=F*(5*g)+m*(5*d)+x*(5*y)+_*(5*p)+$*(5*h),S+=ee>>>13,ee&=8191;let ae=S+L*h+O*u+I*f+B*l+P*c;S=ae>>>13,ae&=8191,ae+=F*a+m*(5*g)+x*(5*d)+_*(5*y)+$*(5*p),S+=ae>>>13,ae&=8191;let ce=S+L*p+O*h+I*u+B*f+P*l;S=ce>>>13,ce&=8191,ce+=F*c+m*a+x*(5*g)+_*(5*d)+$*(5*y),S+=ce>>>13,ce&=8191;let te=S+L*y+O*p+I*h+B*u+P*f;S=te>>>13,te&=8191,te+=F*l+m*c+x*a+_*(5*g)+$*(5*d),S+=te>>>13,te&=8191;let ye=S+L*d+O*y+I*p+B*h+P*u;S=ye>>>13,ye&=8191,ye+=F*f+m*l+x*c+_*a+$*(5*g),S+=ye>>>13,ye&=8191;let oe=S+L*g+O*d+I*y+B*p+P*h;S=oe>>>13,oe&=8191,oe+=F*u+m*f+x*l+_*c+$*a,S+=oe>>>13,oe&=8191,S=(S<<2)+S|0,S=S+k|0,k=S&8191,S=S>>>13,D+=S,s[0]=k,s[1]=D,s[2]=U,s[3]=G,s[4]=ee,s[5]=ae,s[6]=ce,s[7]=te,s[8]=ye,s[9]=oe}finalize(){const{h:e,pad:n}=this,r=new Uint16Array(10);let o=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=o,o=e[a]>>>13,e[a]&=8191;e[0]+=o*5,o=e[0]>>>13,e[0]&=8191,e[1]+=o,o=e[1]>>>13,e[1]&=8191,e[2]+=o,r[0]=e[0]+5,o=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+o,o=r[a]>>>13,r[a]&=8191;r[9]-=8192;let s=(o^1)-1;for(let a=0;a<10;a++)r[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let i=e[0]+n[0];e[0]=i&65535;for(let a=1;a<8;a++)i=(e[a]+n[a]|0)+(i>>>16)|0,e[a]=i&65535}update(e){st(this);const{buffer:n,blockLen:r}=this;e=Fe(e);const o=e.length;for(let s=0;s<o;){const i=Math.min(r-this.pos,o-s);if(i===r){for(;r<=o-s;s+=r)this.process(e,s);continue}n.set(e.subarray(s,s+i),this.pos),this.pos+=i,s+=i,this.pos===r&&(this.process(n,0,!1),this.pos=0)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){st(this),kn(e,this),this.finished=!0;const{buffer:n,h:r}=this;let{pos:o}=this;if(o){for(n[o++]=1;o<16;o++)n[o]=0;this.process(n,0,!0)}this.finalize();let s=0;for(let i=0;i<8;i++)e[s++]=r[i]>>>0,e[s++]=r[i]>>>8;return e}digest(){const{buffer:e,outputLen:n}=this;this.digestInto(e);const r=e.slice(0,n);return this.destroy(),r}}function dc(t){const e=(r,o)=>t(o).update(Fe(r)).digest(),n=t(new Uint8Array(32));return e.outputLen=n.outputLen,e.blockLen=n.blockLen,e.create=r=>t(r),e}dc(t=>new fc(t));const hc=Ln("expand 16-byte k"),gc=Ln("expand 32-byte k"),pc=V(hc),yc=V(gc);function H(t,e){return t<<e|t>>>32-e}function xn(t){return t.byteOffset%4===0}const vt=64,wc=16,So=2**32-1,Rr=new Uint32Array;function mc(t,e,n,r,o,s,i,a){const c=o.length,l=new Uint8Array(vt),f=V(l),u=xn(o)&&xn(s),h=u?V(o):Rr,p=u?V(s):Rr;for(let y=0;y<c;i++){if(t(e,n,r,f,i,a),i>=So)throw new Error("arx: counter overflow");const d=Math.min(vt,c-y);if(u&&d===vt){const g=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let w=0,E;w<wc;w++)E=g+w,p[E]=h[E]^f[w];y+=vt;continue}for(let g=0,w;g<d;g++)w=y+g,s[w]=o[w]^l[g];y+=d}}function bc(t,e){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=Va({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return rn(o),rn(i),_r(s),_r(n),(a,c,l,f,u=0)=>{de(a),de(c),de(l);const h=l.length;if(f||(f=new Uint8Array(h)),de(f),rn(u),u<0||u>=So)throw new Error("arx: counter overflow");if(f.length<h)throw new Error(`arx: output (${f.length}) is shorter than data (${h})`);const p=[];let y=a.length,d,g;if(y===32)d=a.slice(),p.push(d),g=yc;else if(y===16&&n)d=new Uint8Array(32),d.set(a),d.set(a,16),g=pc,p.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);xn(c)||(c=c.slice(),p.push(c));const w=V(d);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(g,w,V(c.subarray(0,16)),w),c=c.subarray(16)}const E=16-o;if(E!==c.length)throw new Error(`arx: nonce must be ${E} or 16 bytes`);if(E!==12){const A=new Uint8Array(12);A.set(c,s?0:12-c.length),c=A,p.push(c)}const v=V(c);for(mc(t,g,w,v,l,f,u,i);p.length>0;)p.pop().fill(0);return f}}function Ec(t,e,n,r,o,s=20){let i=t[0],a=t[1],c=t[2],l=t[3],f=e[0],u=e[1],h=e[2],p=e[3],y=e[4],d=e[5],g=e[6],w=e[7],E=o,v=n[0],A=n[1],R=n[2],C=i,T=a,N=c,L=l,O=f,I=u,B=h,P=p,F=y,m=d,x=g,_=w,$=E,S=v,k=A,D=R;for(let G=0;G<s;G+=2)C=C+O|0,$=H($^C,16),F=F+$|0,O=H(O^F,12),C=C+O|0,$=H($^C,8),F=F+$|0,O=H(O^F,7),T=T+I|0,S=H(S^T,16),m=m+S|0,I=H(I^m,12),T=T+I|0,S=H(S^T,8),m=m+S|0,I=H(I^m,7),N=N+B|0,k=H(k^N,16),x=x+k|0,B=H(B^x,12),N=N+B|0,k=H(k^N,8),x=x+k|0,B=H(B^x,7),L=L+P|0,D=H(D^L,16),_=_+D|0,P=H(P^_,12),L=L+P|0,D=H(D^L,8),_=_+D|0,P=H(P^_,7),C=C+I|0,D=H(D^C,16),x=x+D|0,I=H(I^x,12),C=C+I|0,D=H(D^C,8),x=x+D|0,I=H(I^x,7),T=T+B|0,$=H($^T,16),_=_+$|0,B=H(B^_,12),T=T+B|0,$=H($^T,8),_=_+$|0,B=H(B^_,7),N=N+P|0,S=H(S^N,16),F=F+S|0,P=H(P^F,12),N=N+P|0,S=H(S^N,8),F=F+S|0,P=H(P^F,7),L=L+O|0,k=H(k^L,16),m=m+k|0,O=H(O^m,12),L=L+O|0,k=H(k^L,8),m=m+k|0,O=H(O^m,7);let U=0;r[U++]=i+C|0,r[U++]=a+T|0,r[U++]=c+N|0,r[U++]=l+L|0,r[U++]=f+O|0,r[U++]=u+I|0,r[U++]=h+B|0,r[U++]=p+P|0,r[U++]=y+F|0,r[U++]=d+m|0,r[U++]=g+x|0,r[U++]=w+_|0,r[U++]=E+$|0,r[U++]=v+S|0,r[U++]=A+k|0,r[U++]=R+D|0}const Co=bc(Ec,{counterRight:!1,counterLength:4,allowShortKeys:!1});class No extends io{constructor(e,n){super(),this.finished=!1,this.destroyed=!1,ve.hash(e);const r=wt(n);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?e.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(e){return ve.exists(this),this.iHash.update(e),this}digestInto(e){ve.exists(this),ve.bytes(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:a}=this;return e=e,e.finished=o,e.destroyed=s,e.blockLen=i,e.outputLen=a,e.oHash=n._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Dt=(t,e,n)=>new No(t,e).update(n).digest();Dt.create=(t,e)=>new No(t,e);function vc(t,e,n){return ve.hash(t),Dt(t,wt(n),wt(e))}const sn=new Uint8Array([0]),Ir=new Uint8Array;function xc(t,e,n,r=32){if(ve.hash(t),ve.number(r),r>255*t.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/t.outputLen);n===void 0&&(n=Ir);const s=new Uint8Array(o*t.outputLen),i=Dt.create(t,e),a=i._cloneInto(),c=new Uint8Array(i.outputLen);for(let l=0;l<o;l++)sn[0]=l+1,a.update(l===0?Ir:c).update(n).update(sn).digestInto(c),s.set(c,t.outputLen*l),i._cloneInto(a);return i.destroy(),a.destroy(),c.fill(0),sn.fill(0),s.slice(0,r)}var Sc=Object.defineProperty,W=(t,e)=>{for(var n in e)Sc(t,n,{get:e[n],enumerable:!0})},qe=Symbol("verified"),Cc=t=>t instanceof Object;function Un(t){if(!Cc(t)||typeof t.kind!="number"||typeof t.content!="string"||typeof t.created_at!="number"||typeof t.pubkey!="string"||!t.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(t.tags))return!1;for(let e=0;e<t.tags.length;e++){let n=t.tags[e];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]=="object")return!1}return!0}var Nc={};W(Nc,{Queue:()=>_o,QueueNode:()=>To,binarySearch:()=>Dn,insertEventIntoAscendingList:()=>_c,insertEventIntoDescendingList:()=>Tc,normalizeURL:()=>Ke,utf8Decoder:()=>Te,utf8Encoder:()=>ge});var Te=new TextDecoder("utf-8"),ge=new TextEncoder;function Ke(t){t.indexOf("://")===-1&&(t="wss://"+t);let e=new URL(t);return e.pathname=e.pathname.replace(/\/+/g,"/"),e.pathname.endsWith("/")&&(e.pathname=e.pathname.slice(0,-1)),(e.port==="80"&&e.protocol==="ws:"||e.port==="443"&&e.protocol==="wss:")&&(e.port=""),e.searchParams.sort(),e.hash="",e.toString()}function Tc(t,e){const[n,r]=Dn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:o.created_at-e.created_at);return r||t.splice(n,0,e),t}function _c(t,e){const[n,r]=Dn(t,o=>e.id===o.id?0:e.created_at===o.created_at?-1:e.created_at-o.created_at);return r||t.splice(n,0,e),t}function Dn(t,e){let n=0,r=t.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),s=e(t[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}var To=class{constructor(t){b(this,"value");b(this,"next",null);b(this,"prev",null);this.value=t}},_o=class{constructor(){b(this,"first");b(this,"last");this.first=null,this.last=null}enqueue(t){const e=new To(t);return this.last?this.last===this.first?(this.last=e,this.last.prev=this.first,this.first.next=e):(e.prev=this.last,this.last.next=e,this.last=e):(this.first=e,this.last=e),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const e=this.first;return this.first=null,this.last=null,e.value}const t=this.first;return this.first=t.next,t.value}},Ac=class{generateSecretKey(){return lt.utils.randomPrivateKey()}getPublicKey(t){return ne(lt.getPublicKey(t))}finalizeEvent(t,e){const n=t;return n.pubkey=ne(lt.getPublicKey(e)),n.id=St(n),n.sig=ne(lt.sign(St(n),e)),n[qe]=!0,n}verifyEvent(t){if(typeof t[qe]=="boolean")return t[qe];const e=St(t);if(e!==t.id)return t[qe]=!1,!1;try{const n=lt.verify(t.sig,e,t.pubkey);return t[qe]=n,n}catch{return t[qe]=!1,!1}}};function Rc(t){if(!Un(t))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content])}function St(t){let e=at(ge.encode(Rc(t)));return ne(e)}var Ft=new Ac,Ic=Ft.generateSecretKey,Fn=Ft.getPublicKey,pe=Ft.finalizeEvent,Ht=Ft.verifyEvent,$c={};W($c,{Application:()=>$l,BadgeAward:()=>Fc,BadgeDefinition:()=>Cl,BlockedRelaysList:()=>cl,BookmarkList:()=>sl,Bookmarksets:()=>vl,Calendar:()=>Ul,CalendarEventRSVP:()=>Dl,ChannelCreation:()=>ko,ChannelHideMessage:()=>Bo,ChannelMessage:()=>Mo,ChannelMetadata:()=>Lo,ChannelMuteUser:()=>Po,ClassifiedListing:()=>Ll,ClientAuth:()=>Do,CommunitiesList:()=>il,CommunityDefinition:()=>jl,CommunityPostApproval:()=>Gc,Contacts:()=>Pc,CreateOrUpdateProduct:()=>_l,CreateOrUpdateStall:()=>Tl,Curationsets:()=>xl,Date:()=>Bl,DirectMessageRelaysList:()=>dl,DraftClassifiedListing:()=>Ml,DraftLong:()=>Rl,Emojisets:()=>Il,EncryptedDirectMessage:()=>Uc,EventDeletion:()=>Dc,FileMetadata:()=>jc,FileServerPreference:()=>hl,Followsets:()=>ml,GenericRepost:()=>Wn,Genericlists:()=>bl,GiftWrap:()=>Uo,HTTPAuth:()=>Kn,Handlerinformation:()=>Hl,Handlerrecommendation:()=>Fl,Highlights:()=>tl,InterestsList:()=>ul,Interestsets:()=>Nl,JobFeedback:()=>Yc,JobRequest:()=>Jc,JobResult:()=>Zc,Label:()=>Vc,LightningPubRPC:()=>pl,LiveChatMessage:()=>qc,LiveEvent:()=>Ol,LongFormArticle:()=>Al,Metadata:()=>Mc,Mutelist:()=>nl,NWCWalletInfo:()=>gl,NWCWalletRequest:()=>Fo,NWCWalletResponse:()=>yl,NostrConnect:()=>wl,OpenTimestamps:()=>Hc,Pinlist:()=>rl,PrivateDirectMessage:()=>Oo,ProblemTracker:()=>Wc,ProfileBadges:()=>Sl,PublicChatsList:()=>al,Reaction:()=>qn,RecommendRelay:()=>Bc,RelayList:()=>ol,Relaysets:()=>El,Report:()=>Kc,Reporting:()=>zc,Repost:()=>jn,Seal:()=>$o,SearchRelaysList:()=>ll,ShortTextNote:()=>Io,Time:()=>Pl,UserEmojiList:()=>fl,UserStatuses:()=>kl,Zap:()=>el,ZapGoal:()=>Qc,ZapRequest:()=>Xc,classifyKind:()=>kc,isAddressableKind:()=>jt,isEphemeralKind:()=>Ro,isKind:()=>Lc,isParameterizedReplaceableKind:()=>Oc,isRegularKind:()=>Ao,isReplaceableKind:()=>Hn});function Ao(t){return 1e3<=t&&t<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(t)}function Hn(t){return[0,3].includes(t)||1e4<=t&&t<2e4}function Ro(t){return 2e4<=t&&t<3e4}function jt(t){return 3e4<=t&&t<4e4}var Oc=jt;function kc(t){return Ao(t)?"regular":Hn(t)?"replaceable":Ro(t)?"ephemeral":jt(t)?"parameterized":"unknown"}function Lc(t,e){const n=e instanceof Array?e:[e];return Un(t)&&n.includes(t.kind)||!1}var Mc=0,Io=1,Bc=2,Pc=3,Uc=4,Dc=5,jn=6,qn=7,Fc=8,$o=13,Oo=14,Wn=16,ko=40,Lo=41,Mo=42,Bo=43,Po=44,Hc=1040,Uo=1059,jc=1063,qc=1311,Wc=1971,Kc=1984,zc=1984,Vc=1985,Gc=4550,Jc=5999,Zc=6999,Yc=7e3,Qc=9041,Xc=9734,el=9735,tl=9802,nl=1e4,rl=10001,ol=10002,sl=10003,il=10004,al=10005,cl=10006,ll=10007,ul=10015,fl=10030,dl=10050,hl=10096,gl=13194,pl=21e3,Do=22242,Fo=23194,yl=23195,wl=24133,Kn=27235,ml=3e4,bl=30001,El=30002,vl=30003,xl=30004,Sl=30008,Cl=30009,Nl=30015,Tl=30017,_l=30018,Al=30023,Rl=30024,Il=30030,$l=30078,Ol=30311,kl=30315,Ll=30402,Ml=30403,Bl=31922,Pl=31923,Ul=31924,Dl=31925,Fl=31989,Hl=31990,jl=34550;function ql(t,e){if(t.ids&&t.ids.indexOf(e.id)===-1||t.kinds&&t.kinds.indexOf(e.kind)===-1||t.authors&&t.authors.indexOf(e.pubkey)===-1)return!1;for(let n in t)if(n[0]==="#"){let r=n.slice(1),o=t[`#${r}`];if(o&&!e.tags.find(([s,i])=>s===n.slice(1)&&o.indexOf(i)!==-1))return!1}return!(t.since&&e.created_at<t.since||t.until&&e.created_at>t.until)}function Wl(t,e){for(let n=0;n<t.length;n++)if(ql(t[n],e))return!0;return!1}var Kl={};W(Kl,{getHex64:()=>qt,getInt:()=>Ho,getSubscriptionId:()=>jo,matchEventId:()=>zl,matchEventKind:()=>Gl,matchEventPubkey:()=>Vl});function qt(t,e){let n=e.length+3,r=t.indexOf(`"${e}":`)+n,o=t.slice(r).indexOf('"')+r+1;return t.slice(o,o+64)}function Ho(t,e){let n=e.length,r=t.indexOf(`"${e}":`)+n+3,o=t.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function jo(t){let e=t.slice(0,22).indexOf('"EVENT"');if(e===-1)return null;let n=t.slice(e+7+1).indexOf('"');if(n===-1)return null;let r=e+7+1+n,o=t.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return t.slice(r+1,s)}function zl(t,e){return e===qt(t,"id")}function Vl(t,e){return e===qt(t,"pubkey")}function Gl(t,e){return e===Ho(t,"kind")}var Jl={};W(Jl,{makeAuthEvent:()=>qo});function qo(t,e){return{kind:Do,created_at:Math.floor(Date.now()/1e3),tags:[["relay",t],["challenge",e]],content:""}}async function Zl(){return new Promise(t=>{const e=new MessageChannel,n=()=>{e.port1.removeEventListener("message",n),t()};e.port1.addEventListener("message",n),e.port2.postMessage(0),e.port1.start()})}var Yl=t=>(t[qe]=!0,!0),Wo=class{constructor(t,e){b(this,"url");b(this,"_connected",!1);b(this,"onclose",null);b(this,"onnotice",t=>console.debug(`NOTICE from ${this.url}: ${t}`));b(this,"_onauth",null);b(this,"baseEoseTimeout",4400);b(this,"connectionTimeout",4400);b(this,"publishTimeout",4400);b(this,"openSubs",new Map);b(this,"connectionTimeoutHandle");b(this,"connectionPromise");b(this,"openCountRequests",new Map);b(this,"openEventPublishes",new Map);b(this,"ws");b(this,"incomingMessageQueue",new _o);b(this,"queueRunning",!1);b(this,"challenge");b(this,"authPromise");b(this,"serial",0);b(this,"verifyEvent");b(this,"_WebSocket");this.url=Ke(t),this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation||WebSocket}static async connect(t,e){const n=new Wo(t,e);return await n.connect(),n}closeAllSubscriptions(t){for(let[e,n]of this.openSubs)n.close(t);this.openSubs.clear();for(let[e,n]of this.openEventPublishes)n.reject(new Error(t));this.openEventPublishes.clear();for(let[e,n]of this.openCountRequests)n.reject(new Error(t));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((t,e)=>{this.connectionTimeoutHandle=setTimeout(()=>{var n;e("connection timed out"),this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){e(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,t()},this.ws.onerror=n=>{var r;e(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,(r=this.onclose)==null||r.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var n;this._connected&&(this._connected=!1,this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Zl();this.queueRunning=!1}handleNext(){var n,r,o;const t=this.incomingMessageQueue.dequeue();if(!t)return!1;const e=jo(t);if(e){const s=this.openSubs.get(e);if(!s)return;const i=qt(t,"id"),a=(n=s.alreadyHaveEvent)==null?void 0:n.call(s,i);if((r=s.receivedEvent)==null||r.call(s,this,i),a)return}try{let s=JSON.parse(t);switch(s[0]){case"EVENT":{const i=this.openSubs.get(s[1]),a=s[2];this.verifyEvent(a)&&Wl(i.filters,a)&&i.onevent(a);return}case"COUNT":{const i=s[1],a=s[2],c=this.openCountRequests.get(i);c&&(c.resolve(a.count),this.openCountRequests.delete(i));return}case"EOSE":{const i=this.openSubs.get(s[1]);if(!i)return;i.receivedEose();return}case"OK":{const i=s[1],a=s[2],c=s[3],l=this.openEventPublishes.get(i);l&&(clearTimeout(l.timeout),a?l.resolve(c):l.reject(new Error(c)),this.openEventPublishes.delete(i));return}case"CLOSED":{const i=s[1],a=this.openSubs.get(i);if(!a)return;a.closed=!0,a.close(s[2]);return}case"NOTICE":this.onnotice(s[1]);return;case"AUTH":{this.challenge=s[1],this.authPromise=void 0,(o=this._onauth)==null||o.call(this,s[1]);return}}}catch{return}}async send(t){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{var e;(e=this.ws)==null||e.send(t)})}async auth(t){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");if(this.authPromise)return this.authPromise;const e=await t(qo(this.url,this.challenge));return this.authPromise=new Promise((n,r)=>{const o=setTimeout(()=>{const s=this.openEventPublishes.get(e.id);s&&(s.reject(new Error("auth timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:n,reject:r,timeout:o})}),this.send('["AUTH",'+JSON.stringify(e)+"]"),this.authPromise}async publish(t){const e=new Promise((n,r)=>{const o=setTimeout(()=>{const s=this.openEventPublishes.get(t.id);s&&(s.reject(new Error("publish timed out")),this.openEventPublishes.delete(t.id))},this.publishTimeout);this.openEventPublishes.set(t.id,{resolve:n,reject:r,timeout:o})});return this.send('["EVENT",'+JSON.stringify(t)+"]"),e}async count(t,e){this.serial++;const n=(e==null?void 0:e.id)||"count:"+this.serial,r=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(t).substring(1)),r}subscribe(t,e){const n=this.prepareSubscription(t,e);return n.fire(),n}prepareSubscription(t,e){this.serial++;const n=e.id||(e.label?e.label+":":"sub:")+this.serial,r=new Ql(this,n,t,e);return this.openSubs.set(n,r),r}close(){var t;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,(t=this.ws)==null||t.close()}_onmessage(t){this.incomingMessageQueue.enqueue(t.data),this.queueRunning||this.runQueue()}},Ql=class{constructor(t,e,n,r){b(this,"relay");b(this,"id");b(this,"closed",!1);b(this,"eosed",!1);b(this,"filters");b(this,"alreadyHaveEvent");b(this,"receivedEvent");b(this,"onevent");b(this,"oneose");b(this,"onclose");b(this,"eoseTimeout");b(this,"eoseTimeoutHandle");this.relay=t,this.filters=n,this.id=e,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||t.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var t;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,(t=this.oneose)==null||t.call(this))}close(t="closed by caller"){var e;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),(e=this.onclose)==null||e.call(this,t)}},Xl;try{Xl=WebSocket}catch{}var eu=class{constructor(t){b(this,"relays",new Map);b(this,"seenOn",new Map);b(this,"trackRelays",!1);b(this,"verifyEvent");b(this,"trustedRelayURLs",new Set);b(this,"_WebSocket");this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation}async ensureRelay(t,e){t=Ke(t);let n=this.relays.get(t);return n||(n=new Wo(t,{verifyEvent:this.trustedRelayURLs.has(t)?Yl:this.verifyEvent,websocketImplementation:this._WebSocket}),e!=null&&e.connectionTimeout&&(n.connectionTimeout=e.connectionTimeout),this.relays.set(t,n)),await n.connect(),n}close(t){t.map(Ke).forEach(e=>{var n;(n=this.relays.get(e))==null||n.close()})}subscribe(t,e,n){return this.subscribeMap(t.map(r=>({url:r,filter:e})),n)}subscribeMany(t,e,n){return this.subscribeMap(t.flatMap(r=>e.map(o=>({url:r,filter:o}))),n)}subscribeMap(t,e){this.trackRelays&&(e.receivedEvent=(f,u)=>{let h=this.seenOn.get(u);h||(h=new Set,this.seenOn.set(u,h)),h.add(f)});const n=new Set,r=[],o=[];let s=f=>{var u;o[f]||(o[f]=!0,o.filter(h=>h).length===t.length&&((u=e.oneose)==null||u.call(e),s=()=>{}))};const i=[];let a=(f,u)=>{var h;i[f]||(s(f),i[f]=u,i.filter(p=>p).length===t.length&&((h=e.onclose)==null||h.call(e,i),a=()=>{}))};const c=f=>{var h;if((h=e.alreadyHaveEvent)!=null&&h.call(e,f))return!0;const u=n.has(f);return n.add(f),u},l=Promise.all(t.map(async({url:f,filter:u},h)=>{f=Ke(f);let p;try{p=await this.ensureRelay(f,{connectionTimeout:e.maxWait?Math.max(e.maxWait*.8,e.maxWait-1e3):void 0})}catch(d){a(h,(d==null?void 0:d.message)||String(d));return}let y=p.subscribe([u],{...e,oneose:()=>s(h),onclose:d=>{d.startsWith("auth-required:")&&e.doauth?p.auth(e.doauth).then(()=>{p.subscribe([u],{...e,oneose:()=>s(h),onclose:g=>{a(h,g)},alreadyHaveEvent:c,eoseTimeout:e.maxWait})}).catch(g=>{a(h,`auth was required and attempted, but failed with: ${g}`)}):a(h,d)},alreadyHaveEvent:c,eoseTimeout:e.maxWait});r.push(y)}));return{async close(){await l,r.forEach(f=>{f.close()})}}}subscribeManyMap(t,e){this.trackRelays&&(e.receivedEvent=(u,h)=>{let p=this.seenOn.get(h);p||(p=new Set,this.seenOn.set(h,p)),p.add(u)});const n=new Set,r=[],o=Object.keys(t).length,s=[];let i=u=>{var h;s[u]||(s[u]=!0,s.filter(p=>p).length===o&&((h=e.oneose)==null||h.call(e),i=()=>{}))};const a=[];let c=(u,h)=>{var p;a[u]||(i(u),a[u]=h,a.filter(y=>y).length===o&&((p=e.onclose)==null||p.call(e,a),c=()=>{}))};const l=u=>{var p;if((p=e.alreadyHaveEvent)!=null&&p.call(e,u))return!0;const h=n.has(u);return n.add(u),h},f=Promise.all(Object.entries(t).map(async(u,h,p)=>{if(p.indexOf(u)!==h){c(h,"duplicate url");return}let[y,d]=u;y=Ke(y);let g;try{g=await this.ensureRelay(y,{connectionTimeout:e.maxWait?Math.max(e.maxWait*.8,e.maxWait-1e3):void 0})}catch(E){c(h,(E==null?void 0:E.message)||String(E));return}let w=g.subscribe(d,{...e,oneose:()=>i(h),onclose:E=>{E.startsWith("auth-required:")&&e.doauth?g.auth(e.doauth).then(()=>{g.subscribe(d,{...e,oneose:()=>i(h),onclose:v=>{c(h,v)},alreadyHaveEvent:l,eoseTimeout:e.maxWait})}).catch(v=>{c(h,`auth was required and attempted, but failed with: ${v}`)}):c(h,E)},alreadyHaveEvent:l,eoseTimeout:e.maxWait});r.push(w)}));return{async close(){await f,r.forEach(u=>{u.close()})}}}subscribeEose(t,e,n){const r=this.subscribe(t,e,{...n,oneose(){r.close()}});return r}subscribeManyEose(t,e,n){const r=this.subscribeMany(t,e,{...n,oneose(){r.close()}});return r}async querySync(t,e,n){return new Promise(async r=>{const o=[];this.subscribeEose(t,e,{...n,onevent(s){o.push(s)},onclose(s){r(o)}})})}async get(t,e,n){e.limit=1;const r=await this.querySync(t,e,n);return r.sort((o,s)=>s.created_at-o.created_at),r[0]||null}publish(t,e){return t.map(Ke).map(async(n,r,o)=>{if(o.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(e).then(i=>{if(this.trackRelays){let a=this.seenOn.get(e.id);a||(a=new Set,this.seenOn.set(e.id,a)),a.add(s)}return i})})}listConnectionStatus(){const t=new Map;return this.relays.forEach((e,n)=>t.set(n,e.connected)),t}destroy(){this.relays.forEach(t=>t.close()),this.relays=new Map}},Ko;try{Ko=WebSocket}catch{}var zo=class extends eu{constructor(){super({verifyEvent:Ht,websocketImplementation:Ko})}},se={};W(se,{BECH32_REGEX:()=>Vo,Bech32MaxSize:()=>zn,NostrTypeGuard:()=>tu,decode:()=>Wt,decodeNostrURI:()=>ru,encodeBytes:()=>zt,naddrEncode:()=>lu,neventEncode:()=>cu,noteEncode:()=>iu,nprofileEncode:()=>au,npubEncode:()=>su,nsecEncode:()=>ou});var tu={isNProfile:t=>/^nprofile1[a-z\d]+$/.test(t||""),isNEvent:t=>/^nevent1[a-z\d]+$/.test(t||""),isNAddr:t=>/^naddr1[a-z\d]+$/.test(t||""),isNSec:t=>/^nsec1[a-z\d]{58}$/.test(t||""),isNPub:t=>/^npub1[a-z\d]{58}$/.test(t||""),isNote:t=>/^note1[a-z\d]+$/.test(t||""),isNcryptsec:t=>/^ncryptsec1[a-z\d]+$/.test(t||"")},zn=5e3,Vo=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function nu(t){const e=new Uint8Array(4);return e[0]=t>>24&255,e[1]=t>>16&255,e[2]=t>>8&255,e[3]=t&255,e}function ru(t){try{return t.startsWith("nostr:")&&(t=t.substring(6)),Wt(t)}catch{return{type:"invalid",data:null}}}function Wt(t){var o,s,i,a,c,l,f;let{prefix:e,words:n}=ot.decode(t,zn),r=new Uint8Array(ot.fromWords(n));switch(e){case"nprofile":{let u=an(r);if(!((o=u[0])!=null&&o[0]))throw new Error("missing TLV 0 for nprofile");if(u[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:ne(u[0][0]),relays:u[1]?u[1].map(h=>Te.decode(h)):[]}}}case"nevent":{let u=an(r);if(!((s=u[0])!=null&&s[0]))throw new Error("missing TLV 0 for nevent");if(u[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(u[2]&&u[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(u[3]&&u[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:ne(u[0][0]),relays:u[1]?u[1].map(h=>Te.decode(h)):[],author:(i=u[2])!=null&&i[0]?ne(u[2][0]):void 0,kind:(a=u[3])!=null&&a[0]?parseInt(ne(u[3][0]),16):void 0}}}case"naddr":{let u=an(r);if(!((c=u[0])!=null&&c[0]))throw new Error("missing TLV 0 for naddr");if(!((l=u[2])!=null&&l[0]))throw new Error("missing TLV 2 for naddr");if(u[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((f=u[3])!=null&&f[0]))throw new Error("missing TLV 3 for naddr");if(u[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:Te.decode(u[0][0]),pubkey:ne(u[2][0]),kind:parseInt(ne(u[3][0]),16),relays:u[1]?u[1].map(h=>Te.decode(h)):[]}}}case"nsec":return{type:e,data:r};case"npub":case"note":return{type:e,data:ne(r)};default:throw new Error(`unknown prefix ${e}`)}}function an(t){let e={},n=t;for(;n.length>0;){let r=n[0],o=n[1],s=n.slice(2,2+o);if(n=n.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${r}`);e[r]=e[r]||[],e[r].push(s)}return e}function ou(t){return zt("nsec",t)}function su(t){return zt("npub",rt(t))}function iu(t){return zt("note",rt(t))}function Kt(t,e){let n=ot.toWords(e);return ot.encode(t,n,zn)}function zt(t,e){return Kt(t,e)}function au(t){let e=Vn({0:[rt(t.pubkey)],1:(t.relays||[]).map(n=>ge.encode(n))});return Kt("nprofile",e)}function cu(t){let e;t.kind!==void 0&&(e=nu(t.kind));let n=Vn({0:[rt(t.id)],1:(t.relays||[]).map(r=>ge.encode(r)),2:t.author?[rt(t.author)]:[],3:e?[new Uint8Array(e)]:[]});return Kt("nevent",n)}function lu(t){let e=new ArrayBuffer(4);new DataView(e).setUint32(0,t.kind,!1);let n=Vn({0:[ge.encode(t.identifier)],1:(t.relays||[]).map(r=>ge.encode(r)),2:[rt(t.pubkey)],3:[new Uint8Array(e)]});return Kt("naddr",n)}function Vn(t){let e=[];return Object.entries(t).reverse().forEach(([n,r])=>{r.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(n)],0),s.set([o.length],1),s.set(o,2),e.push(s)})}),Pt(...e)}var uu={};W(uu,{decrypt:()=>fu,encrypt:()=>Go});function Go(t,e,n){const r=t instanceof Uint8Array?ne(t):t,o=it.getSharedSecret(r,"02"+e),s=Jo(o);let i=Uint8Array.from(co(16)),a=ge.encode(n),c=xo(s,i).encrypt(a),l=Ae.encode(new Uint8Array(c)),f=Ae.encode(new Uint8Array(i.buffer));return`${l}?iv=${f}`}function fu(t,e,n){const r=t instanceof Uint8Array?ne(t):t;let[o,s]=n.split("?iv="),i=it.getSharedSecret(r,"02"+e),a=Jo(i),c=Ae.decode(s),l=Ae.decode(o),f=xo(a,c).decrypt(l);return Te.decode(f)}function Jo(t){return t.slice(1,33)}var du={};W(du,{NIP05_REGEX:()=>Gn,isNip05:()=>hu,isValid:()=>yu,queryProfile:()=>Zo,searchDomain:()=>pu,useFetchImplementation:()=>gu});var Gn=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,hu=t=>Gn.test(t||""),Vt;try{Vt=fetch}catch{}function gu(t){Vt=t}async function pu(t,e=""){try{const n=`https://${t}/.well-known/nostr.json?name=${e}`,r=await Vt(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function Zo(t){var o;const e=t.match(Gn);if(!e)return null;const[,n="_",r]=e;try{const s=`https://${r}/.well-known/nostr.json?name=${n}`,i=await Vt(s,{redirect:"manual"});if(i.status!==200)throw Error("Wrong response code");const a=await i.json(),c=a.names[n];return c?{pubkey:c,relays:(o=a.relays)==null?void 0:o[c]}:null}catch{return null}}async function yu(t,e){const n=await Zo(e);return n?n.pubkey===t:!1}var wu={};W(wu,{parse:()=>mu});function mu(t){const e={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let o=t.tags.length-1;o>=0;o--){const s=t.tags[o];if(s[0]==="e"&&s[1]){const[i,a,c,l,f]=s,u={id:a,relays:c?[c]:[],author:f};if(l==="root"){e.root=u;continue}if(l==="reply"){e.reply=u;continue}if(l==="mention"){e.mentions.push(u);continue}n?r=u:n=u,e.mentions.push(u);continue}if(s[0]==="q"&&s[1]){const[i,a,c]=s;e.quotes.push({id:a,relays:c?[c]:[]})}if(s[0]==="p"&&s[1]){e.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return e.root||(e.root=r||n||e.reply),e.reply||(e.reply=n||e.root),[e.reply,e.root].forEach(o=>{if(!o)return;let s=e.mentions.indexOf(o);if(s!==-1&&e.mentions.splice(s,1),o.author){let i=e.profiles.find(a=>a.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(a=>{var c;((c=o.relays)==null?void 0:c.indexOf(a))===-1&&o.relays.push(a)}),i.relays=o.relays)}}),e.mentions.forEach(o=>{if(o.author){let s=e.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),e}var bu={};W(bu,{fetchRelayInformation:()=>vu,useFetchImplementation:()=>Eu});var Yo;try{Yo=fetch}catch{}function Eu(t){Yo=t}async function vu(t){return await(await fetch(t.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var xu={};W(xu,{fastEventHash:()=>Xo,getPow:()=>Qo,minePow:()=>Su});function Qo(t){let e=0;for(let n=0;n<64;n+=8){const r=parseInt(t.substring(n,n+8),16);if(r===0)e+=32;else{e+=Math.clz32(r);break}}return e}function Su(t,e){let n=0;const r=t,o=["nonce",n.toString(),e.toString()];for(r.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),o[1]=(++n).toString(),r.id=Xo(r),Qo(r.id)>=e)break}return r}function Xo(t){return ne(at(ge.encode(JSON.stringify([0,t.pubkey,t.created_at,t.kind,t.tags,t.content]))))}var Cu={};W(Cu,{unwrapEvent:()=>Bu,unwrapManyEvents:()=>Pu,wrapEvent:()=>ds,wrapManyEvents:()=>Mu});var Nu={};W(Nu,{createRumor:()=>cs,createSeal:()=>ls,createWrap:()=>us,unwrapEvent:()=>Xn,unwrapManyEvents:()=>fs,wrapEvent:()=>It,wrapManyEvents:()=>ku});var Tu={};W(Tu,{decrypt:()=>Qn,encrypt:()=>Yn,getConversationKey:()=>Jn,v2:()=>$u});var es=1,ts=65535;function Jn(t,e){const n=it.getSharedSecret(t,"02"+e).subarray(1,33);return vc(at,n,"nip44-v2")}function ns(t,e){const n=xc(at,t,e,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function Zn(t){if(!Number.isSafeInteger(t)||t<1)throw new Error("expected positive integer");if(t<=32)return 32;const e=1<<Math.floor(Math.log2(t-1))+1,n=e<=256?32:e/8;return n*(Math.floor((t-1)/n)+1)}function _u(t){if(!Number.isSafeInteger(t)||t<es||t>ts)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const e=new Uint8Array(2);return new DataView(e.buffer).setUint16(0,t,!1),e}function Au(t){const e=ge.encode(t),n=e.length,r=_u(n),o=new Uint8Array(Zn(n)-n);return Pt(r,e,o)}function Ru(t){const e=new DataView(t.buffer).getUint16(0),n=t.subarray(2,2+e);if(e<es||e>ts||n.length!==e||t.length!==2+Zn(e))throw new Error("invalid padding");return Te.decode(n)}function rs(t,e,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=Pt(n,e);return Dt(at,t,r)}function Iu(t){if(typeof t!="string")throw new Error("payload must be a valid string");const e=t.length;if(e<132||e>87472)throw new Error("invalid payload length: "+e);if(t[0]==="#")throw new Error("unknown encryption version");let n;try{n=Ae.decode(t)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function Yn(t,e,n=co(32)){const{chacha_key:r,chacha_nonce:o,hmac_key:s}=ns(e,n),i=Au(t),a=Co(r,o,i),c=rs(s,a,n);return Ae.encode(Pt(new Uint8Array([2]),n,a,c))}function Qn(t,e){const{nonce:n,ciphertext:r,mac:o}=Iu(t),{chacha_key:s,chacha_nonce:i,hmac_key:a}=ns(e,n),c=rs(a,r,n);if(!Ga(c,o))throw new Error("invalid MAC");const l=Co(s,i,r);return Ru(l)}var $u={utils:{getConversationKey:Jn,calcPaddedLen:Zn},encrypt:Yn,decrypt:Qn},Ou=2*24*60*60,os=()=>Math.round(Date.now()/1e3),ss=()=>Math.round(os()-Math.random()*Ou),is=(t,e)=>Jn(t,e),as=(t,e,n)=>Yn(JSON.stringify(t),is(e,n)),$r=(t,e)=>JSON.parse(Qn(t.content,is(e,t.pubkey)));function cs(t,e){const n={created_at:os(),content:"",tags:[],...t,pubkey:Fn(e)};return n.id=St(n),n}function ls(t,e,n){return pe({kind:$o,content:as(t,e,n),created_at:ss(),tags:[]},e)}function us(t,e){const n=Ic();return pe({kind:Uo,content:as(t,n,e),created_at:ss(),tags:[["p",e]]},n)}function It(t,e,n){const r=cs(t,e),o=ls(r,e,n);return us(o,n)}function ku(t,e,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Fn(e),o=[It(t,e,r)];return n.forEach(s=>{o.push(It(t,e,s))}),o}function Xn(t,e){const n=$r(t,e);return $r(n,e)}function fs(t,e){let n=[];return t.forEach(r=>{n.push(Xn(r,e))}),n.sort((r,o)=>r.created_at-o.created_at),n}function Lu(t,e,n,r){const o={created_at:Math.ceil(Date.now()/1e3),kind:Oo,tags:[],content:e};return(Array.isArray(t)?t:[t]).forEach(({publicKey:i,relayUrl:a})=>{o.tags.push(a?["p",i,a]:["p",i])}),r&&o.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function ds(t,e,n,r,o){const s=Lu(e,n,r,o);return It(s,t,e.publicKey)}function Mu(t,e,n,r,o){if(!e||e.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Fn(t)},...e].map(i=>ds(t,i,n,r,o))}var Bu=Xn,Pu=fs,Uu={};W(Uu,{finishRepostEvent:()=>Du,getRepostedEvent:()=>Fu,getRepostedEventPointer:()=>hs});function Du(t,e,n,r){var i;let o;const s=[...t.tags??[],["e",e.id,n],["p",e.pubkey]];return e.kind===Io?o=jn:(o=Wn,s.push(["k",String(e.kind)])),pe({kind:o,tags:s,content:t.content===""||(i=e.tags)!=null&&i.find(a=>a[0]==="-")?"":JSON.stringify(e),created_at:t.created_at},r)}function hs(t){if(![jn,Wn].includes(t.kind))return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(e!==void 0)return{id:e[1],relays:[e[2],n==null?void 0:n[2]].filter(r=>typeof r=="string"),author:n==null?void 0:n[1]}}function Fu(t,{skipVerification:e}={}){const n=hs(t);if(n===void 0||t.content==="")return;let r;try{r=JSON.parse(t.content)}catch{return}if(r.id===n.id&&!(!e&&!Ht(r)))return r}var Hu={};W(Hu,{NOSTR_URI_REGEX:()=>er,parse:()=>qu,test:()=>ju});var er=new RegExp(`nostr:(${Vo.source})`);function ju(t){return typeof t=="string"&&new RegExp(`^${er.source}$`).test(t)}function qu(t){const e=t.match(new RegExp(`^${er.source}$`));if(!e)throw new Error(`Invalid Nostr URI: ${t}`);return{uri:e[0],value:e[1],decoded:Wt(e[1])}}var Wu={};W(Wu,{finishReactionEvent:()=>Ku,getReactedEventPointer:()=>zu});function Ku(t,e,n){const r=e.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return pe({...t,kind:qn,tags:[...t.tags??[],...r,["e",e.id],["p",e.pubkey]],content:t.content??"+"},n)}function zu(t){if(t.kind!==qn)return;let e,n;for(let r=t.tags.length-1;r>=0&&(e===void 0||n===void 0);r--){const o=t.tags[r];o.length>=2&&(o[0]==="e"&&e===void 0?e=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(e===void 0||n===void 0))return{id:e[1],relays:[e[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Vu={};W(Vu,{parse:()=>Ju});var Gu=/\W/m,Or=/\W |\W$|$|,| /m;function*Ju(t){const e=t.length;let n=0,r=0;for(;r<e;){let o=t.indexOf(":",r);if(o===-1)break;if(t.substring(o-5,o)==="nostr"){const s=t.substring(o+60).match(Gu),i=s?o+60+s.index:e;try{let a,{data:c,type:l}=Wt(t.substring(o+1,i));switch(l){case"npub":a={pubkey:c};break;case"nsec":case"note":r=i+1;continue;default:a=c}n!==o-5&&(yield{type:"text",text:t.substring(n,o-5)}),yield{type:"reference",pointer:a},r=i,n=r;continue}catch{r=o+1;continue}}else if(t.substring(o-5,o)==="https"||t.substring(o-4,o)==="http"){const s=t.substring(o+4).match(Or),i=s?o+4+s.index:e,a=t[o-1]==="s"?5:4;try{let c=new URL(t.substring(o-a,i));if(c.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==o-a&&(yield{type:"text",text:t.substring(n,o-a)}),c.pathname.endsWith(".png")||c.pathname.endsWith(".jpg")||c.pathname.endsWith(".jpeg")||c.pathname.endsWith(".gif")||c.pathname.endsWith(".webp")){yield{type:"image",url:c.toString()},r=i,n=r;continue}if(c.pathname.endsWith(".mp4")||c.pathname.endsWith(".avi")||c.pathname.endsWith(".webm")||c.pathname.endsWith(".mkv")){yield{type:"video",url:c.toString()},r=i,n=r;continue}if(c.pathname.endsWith(".mp3")||c.pathname.endsWith(".aac")||c.pathname.endsWith(".ogg")||c.pathname.endsWith(".opus")){yield{type:"audio",url:c.toString()},r=i,n=r;continue}yield{type:"url",url:c.toString()},r=i,n=r;continue}catch{r=i+1;continue}}else if(t.substring(o-3,o)==="wss"||t.substring(o-2,o)==="ws"){const s=t.substring(o+4).match(Or),i=s?o+4+s.index:e,a=t[o-1]==="s"?3:2;try{let c=new URL(t.substring(o-a,i));if(c.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==o-a&&(yield{type:"text",text:t.substring(n,o-a)}),yield{type:"relay",url:c.toString()},r=i,n=r;continue}catch{r=i+1;continue}}else{r=o+1;continue}}n!==e&&(yield{type:"text",text:t.substring(n)})}var Zu={};W(Zu,{channelCreateEvent:()=>Yu,channelHideMessageEvent:()=>ef,channelMessageEvent:()=>Xu,channelMetadataEvent:()=>Qu,channelMuteUserEvent:()=>tf});var Yu=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return pe({kind:ko,tags:[...t.tags??[]],content:n,created_at:t.created_at},e)},Qu=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return pe({kind:Lo,tags:[["e",t.channel_create_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},Xu=(t,e)=>{const n=[["e",t.channel_create_event_id,t.relay_url,"root"]];return t.reply_to_channel_message_event_id&&n.push(["e",t.reply_to_channel_message_event_id,t.relay_url,"reply"]),pe({kind:Mo,tags:[...n,...t.tags??[]],content:t.content,created_at:t.created_at},e)},ef=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return pe({kind:Bo,tags:[["e",t.channel_message_event_id],...t.tags??[]],content:n,created_at:t.created_at},e)},tf=(t,e)=>{let n;if(typeof t.content=="object")n=JSON.stringify(t.content);else if(typeof t.content=="string")n=t.content;else return;return pe({kind:Po,tags:[["p",t.pubkey_to_mute],...t.tags??[]],content:n,created_at:t.created_at},e)},nf={};W(nf,{EMOJI_SHORTCODE_REGEX:()=>gs,matchAll:()=>rf,regex:()=>tr,replaceAll:()=>of});var gs=/:(\w+):/,tr=()=>new RegExp(`\\B${gs.source}\\B`,"g");function*rf(t){const e=t.matchAll(tr());for(const n of e)try{const[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function of(t,e){return t.replaceAll(tr(),(n,r)=>e({shortcode:n,name:r}))}var sf={};W(sf,{useFetchImplementation:()=>af,validateGithub:()=>cf});var nr;try{nr=fetch}catch{}function af(t){nr=t}async function cf(t,e,n){try{return await(await nr(`https://gist.github.com/${e}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${t}`}catch{return!1}}var lf={};W(lf,{makeNwcRequestEvent:()=>ff,parseConnectionString:()=>uf});function uf(t){const{pathname:e,searchParams:n}=new URL(t),r=e,o=n.get("relay"),s=n.get("secret");if(!r||!o||!s)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:s}}async function ff(t,e,n){const o=await Go(e,t,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:Fo,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t]]};return pe(s,e)}var df={};W(df,{normalizeIdentifier:()=>hf});function hf(t){return t=t.trim().toLowerCase(),t=t.normalize("NFKC"),Array.from(t).map(e=>new RegExp("\\p{Letter}","u").test(e)||new RegExp("\\p{Number}","u").test(e)?e:"-").join("")}var gf={};W(gf,{getZapEndpoint:()=>yf,makeZapReceipt:()=>bf,makeZapRequest:()=>wf,useFetchImplementation:()=>pf,validateZapRequest:()=>mf});var rr;try{rr=fetch}catch{}function pf(t){rr=t}async function yf(t){try{let e="",{lud06:n,lud16:r}=JSON.parse(t.content);if(n){let{words:i}=ot.decode(n,1e3),a=ot.fromWords(i);e=Te.decode(a)}else if(r){let[i,a]=r.split("@");e=new URL(`/.well-known/lnurlp/${i}`,`https://${a}`).toString()}else return null;let s=await(await rr(e)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function wf({profile:t,event:e,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!t)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",t],["amount",n.toString()],["relays",...r]]};if(e&&typeof e=="string"&&s.tags.push(["e",e]),e&&typeof e=="object"){if(Hn(e.kind)){const i=["a",`${e.kind}:${e.pubkey}:`];s.tags.push(i)}else if(jt(e.kind)){let i=e.tags.find(([c,l])=>c==="d"&&l);if(!i)throw new Error("d tag not found or is empty");const a=["a",`${e.kind}:${e.pubkey}:${i[1]}`];s.tags.push(a)}}return s}function mf(t){let e;try{e=JSON.parse(t)}catch{return"Invalid zap request JSON."}if(!Un(e))return"Zap request is not a valid Nostr event.";if(!Ht(e))return"Invalid signature on zap request.";let n=e.tags.find(([s,i])=>s==="p"&&i);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=e.tags.find(([s,i])=>s==="e"&&i);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":e.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function bf({zapRequest:t,preimage:e,bolt11:n,paidAt:r}){let o=JSON.parse(t),s=o.tags.filter(([a])=>a==="e"||a==="p"||a==="a"),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",t]]};return e&&i.tags.push(["preimage",e]),i}var Ef={};W(Ef,{getToken:()=>vf,hashPayload:()=>or,unpackEventFromToken:()=>ys,validateEvent:()=>xs,validateEventKind:()=>ms,validateEventMethodTag:()=>Es,validateEventPayloadTag:()=>vs,validateEventTimestamp:()=>ws,validateEventUrlTag:()=>bs,validateToken:()=>xf});var ps="Nostr ";async function vf(t,e,n,r=!1,o){const s={kind:Kn,tags:[["u",t],["method",e]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",or(o)]);const i=await n(s);return(r?ps:"")+Ae.encode(ge.encode(JSON.stringify(i)))}async function xf(t,e,n){const r=await ys(t).catch(s=>{throw s});return await xs(r,e,n).catch(s=>{throw s})}async function ys(t){if(!t)throw new Error("Missing token");t=t.replace(ps,"");const e=Te.decode(Ae.decode(t));if(!e||e.length===0||!e.startsWith("{"))throw new Error("Invalid token");return JSON.parse(e)}function ws(t){return t.created_at?Math.round(new Date().getTime()/1e3)-t.created_at<60:!1}function ms(t){return t.kind===Kn}function bs(t,e){const n=t.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===e:!1}function Es(t,e){const n=t.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===e.toLowerCase():!1}function or(t){const e=at(ge.encode(JSON.stringify(t)));return ne(e)}function vs(t,e){const n=t.tags.find(o=>o[0]==="payload");if(!n)return!1;const r=or(e);return n.length>0&&n[1]===r}async function xs(t,e,n,r){if(!Ht(t))throw new Error("Invalid nostr event, signature invalid");if(!ms(t))throw new Error("Invalid nostr event, kind invalid");if(!ws(t))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!bs(t,e))throw new Error("Invalid nostr event, url tag invalid");if(!Es(t,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!vs(t,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const Q={METADATA:0,TEXT_NOTE:1,RECOMMEND_RELAY:2,CONTACT_LIST:3,DM:4,ENCRYPTED_DM:4,DELETE:5,REPOST:6,REACTION:7,BADGE_AWARD:8,PUBLIC_CHAT_MESSAGE:9,POLL:6001,ARTICLE:30023,PROFILE_BADGES:30008,COMMUNITY_DEFINITION:34550,COMMUNITY_POST:1},$t=["wss://relay.damus.io","wss://nos.lol","wss://relay.nostr.band","wss://offchain.pub","wss://nostr.wine","wss://relay.primal.net","wss://relay.blocknostr.com"],Sf={MAX_RETRIES:3,INITIAL_RETRY_DELAY:1e3,MAX_RETRY_DELAY:3e4,BACKOFF_MULTIPLIER:2,CONNECTION_TIMEOUT:8e3,CIRCUIT_BREAKER_FAILURES:5,CIRCUIT_BREAKER_TIMEOUT:3e5,MIN_SUCCESSFUL_RELAYS:2},ft=Object.freeze(Object.defineProperty({__proto__:null,CONNECTION_CONFIG:Sf,DEFAULT_RELAYS:$t,EVENT_KINDS:Q},Symbol.toStringTag,{value:"Module"})),Cf="modulepreload",Nf=function(t){return"/"+t},kr={},dt=function(e,n,r){let o=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),a=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=Promise.allSettled(n.map(c=>{if(c=Nf(c),c in kr)return;kr[c]=!0;const l=c.endsWith(".css"),f=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const u=document.createElement("link");if(u.rel=l?"stylesheet":Cf,l||(u.as="script"),u.crossOrigin="",u.href=c,a&&u.setAttribute("nonce",a),document.head.appendChild(u),l)return new Promise((h,p)=>{u.addEventListener("load",h),u.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(i){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=i,window.dispatchEvent(a),!a.defaultPrevented)throw i}return o.then(i=>{for(const a of i||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},gt={PROFILE_UPDATED:"profile:updated",POST_CREATED:"post:created",POST_DELETED:"post:deleted",RELAY_CONNECTED:"relay:connected",RELAY_DISCONNECTED:"relay:disconnected",AUTH_CHANGED:"auth:changed"};class Tf{constructor(){b(this,"events");this.events=new Map}on(e,n){var r;this.events.has(e)||this.events.set(e,[]),(r=this.events.get(e))==null||r.push(n)}off(e,n){const r=this.events.get(e);r&&this.events.set(e,r.filter(o=>o!==n))}emit(e,...n){const r=this.events.get(e);r&&r.forEach(o=>{try{o(...n)}catch(s){console.error(`Error in event handler for ${e}:`,s)}})}}const pt=new Tf;class _f{constructor(){b(this,"pool");b(this,"connectedRelays",new Set);b(this,"publicKey",null);b(this,"privateKey",null);b(this,"circuitBreakers",new Map);b(this,"connectionAttempts",new Map);b(this,"lastConnectionTime",new Map);b(this,"isConnecting",!1);b(this,"connectionPromise",null);b(this,"connectionPromiseResolver",null);b(this,"lastConnectionCheck",0);b(this,"CONNECTION_RECHECK_INTERVAL",1e4);b(this,"activeSubscriptions",new Map);b(this,"subscriptionQueue",[]);b(this,"MAX_CONCURRENT_SUBSCRIPTIONS",1);b(this,"ADAPTIVE_MAX_LIMIT",3);b(this,"subscriptionCounts",new Map);b(this,"subscriptionDeduplication",new Map);b(this,"subscriptionBatchTimeout",null);b(this,"pendingBatchedSubscriptions",[]);b(this,"BATCH_TIMEOUT",200);b(this,"batchedSubscriptionHandlers",new Map);b(this,"lastSubscriptionTime",0);b(this,"MIN_SUBSCRIPTION_INTERVAL",100);b(this,"subscriptionRateLimitQueue",[]);b(this,"isProcessingRateLimit",!1);b(this,"relayLimits",new Map);b(this,"relayPerformance",new Map);b(this,"PERFORMANCE_WINDOW",3e5);b(this,"SUCCESS_THRESHOLD",10);b(this,"REJECTION_PENALTY_TIME",12e4);b(this,"relayNoticeCount",new Map);b(this,"lastNoticeTime",new Map);b(this,"MAX_NOTICES_BEFORE_LIMIT_DECREASE",2);b(this,"NOTICE_RESET_TIME",18e4);try{if(this.pool=new zo,this.loadKeys(),typeof window<"u"){window.addEventListener("unhandledrejection",n=>{var o,s;const r=((o=n.reason)==null?void 0:o.message)||((s=n.reason)==null?void 0:s.toString())||"";if(r.includes("unexpected size for fixed-size tag")){console.warn("[CoreNostrService] Caught relay protocol error:",r),n.preventDefault();return}if(r.includes("restricted")||r.includes("not an active paid member")||r.includes("pay")||r.includes("membership required")||r.includes("subscription required")){console.warn("[CoreNostrService] Caught paid relay restriction:",r),n.preventDefault();return}if(r.includes("WebSocket")||r.includes("connection")||r.includes("relay")){console.warn("[CoreNostrService] Caught relay connection error:",r),n.preventDefault();return}}),window.addEventListener("message",n=>{if(n.data&&Array.isArray(n.data)&&n.data[0]==="NOTICE"){const r=n.data[1];r&&r.toLowerCase().includes("too many concurrent req")&&(console.log("[CoreNostrService] ðŸš« Detected relay rejection:",r),this.handleGenericRelayRejection(r))}}),this.pool&&typeof this.pool.on=="function"&&this.pool.on("notice",(n,r)=>{r.toLowerCase().includes("too many concurrent req")&&(console.log(`[CoreNostrService] ðŸš« NOTICE from ${n}: ${r}`),this.handleSpecificRelayRejection(n,r))});const e=console.log;console.log=(...n)=>{const r=n.join(" ");if(r.includes("NOTICE from")&&r.includes("too many concurrent REQ")){const o=r.match(/NOTICE from (wss:\/\/[^\/]+[^:]*)/);if(o){const s=o[1].replace(/\/$/,"");console.warn(`[CoreNostrService] ðŸš« Detected relay rejection via console: ${s}`),this.handleSpecificRelayRejection(s,r)}}e.apply(console,n)}}this.connectToDefaultRelays().catch(e=>{console.warn("[CoreNostrService] Initial relay connection failed:",e)}),console.log("[CoreNostrService] Initialized with circuit breaker protection")}catch(e){console.error("[CoreNostrService] Failed to initialize service:",e),this.publicKey=null,this.privateKey=null}}loadKeys(){try{this.publicKey=localStorage.getItem("nostr-publicKey"),this.privateKey=localStorage.getItem("nostr-privateKey")}catch(e){console.error("[CoreNostrService] Failed to load keys:",e)}}getPublicKey(){return this.publicKey}async login(){try{return window.nostr?(this.publicKey=await window.nostr.getPublicKey(),localStorage.setItem("nostr-publicKey",this.publicKey),pt.emit(gt.AUTH_CHANGED,{isLoggedIn:!0,publicKey:this.publicKey}),!0):!1}catch(e){return console.error("[CoreNostrService] Login failed:",e),!1}}signOut(){this.publicKey=null,this.privateKey=null,localStorage.removeItem("nostr-publicKey"),localStorage.removeItem("nostr-privateKey"),pt.emit(gt.AUTH_CHANGED,{isLoggedIn:!1,publicKey:null})}getCircuitBreakerState(e){return this.circuitBreakers.has(e)||this.circuitBreakers.set(e,{failures:0,lastFailureTime:0,state:"closed"}),this.circuitBreakers.get(e)}canAttemptConnection(e){const n=this.getCircuitBreakerState(e),r=Date.now();return dt(async()=>{const{CONNECTION_CONFIG:o}=await Promise.resolve().then(()=>ft);return{CONNECTION_CONFIG:o}},void 0).then(({CONNECTION_CONFIG:o})=>{if(n.state==="open")return r-n.lastFailureTime>o.CIRCUIT_BREAKER_TIMEOUT?(n.state="half-open",n.failures=0,console.log(`[CoreNostrService] Circuit breaker half-open for ${e}`),!0):!1}),n.state!=="open"}recordConnectionSuccess(e){const n=this.getCircuitBreakerState(e);n.failures=0,n.state="closed",this.connectionAttempts.delete(e)}recordConnectionFailure(e){const n=this.getCircuitBreakerState(e);n.failures++,n.lastFailureTime=Date.now(),dt(async()=>{const{CONNECTION_CONFIG:r}=await Promise.resolve().then(()=>ft);return{CONNECTION_CONFIG:r}},void 0).then(({CONNECTION_CONFIG:r})=>{n.failures>=r.CIRCUIT_BREAKER_FAILURES&&(n.state="open",console.warn(`[CoreNostrService] Circuit breaker OPEN for ${e} after ${n.failures} failures`))})}calculateBackoffDelay(e){const n=this.connectionAttempts.get(e)||0;return Math.min(1e3*Math.pow(2,n),3e4)}async connectToDefaultRelays(){const e=Date.now();if(this.connectedRelays.size>0&&e-this.lastConnectionCheck<this.CONNECTION_RECHECK_INTERVAL)return console.log(`[CoreNostrService] Using existing ${this.connectedRelays.size} connections (checked ${Math.round((e-this.lastConnectionCheck)/1e3)}s ago)`),this.getConnectedRelays();if(this.connectionPromise)return console.log("[CoreNostrService] Connection already in progress, waiting for existing promise..."),this.connectionPromise;this.connectionPromise=this.performConnection(),this.lastConnectionCheck=e;try{return await this.connectionPromise}finally{this.connectionPromise=null,this.connectionPromiseResolver=null}}async performConnection(){this.isConnecting=!0;try{const{DEFAULT_RELAYS:e}=await dt(async()=>{const{DEFAULT_RELAYS:r}=await Promise.resolve().then(()=>ft);return{DEFAULT_RELAYS:r}},void 0);return console.log(`[CoreNostrService] Connecting to ${e.length} default relays with circuit breaker protection`),await this.connectToRelays(e)}finally{this.isConnecting=!1}}async connectToRelays(e){const n=[],{CONNECTION_CONFIG:r}=await dt(async()=>{const{CONNECTION_CONFIG:i}=await Promise.resolve().then(()=>ft);return{CONNECTION_CONFIG:i}},void 0),o=e.filter(i=>this.canAttemptConnection(i));if(o.length===0)return console.warn("[CoreNostrService] No relays available due to circuit breaker protection"),n;console.log(`[CoreNostrService] Attempting to connect to ${o.length}/${e.length} relays`);const s=o.map(async i=>{const a=this.connectionAttempts.get(i)||0;if(a>=r.MAX_RETRIES)return console.warn(`[CoreNostrService] Max retries exceeded for ${i}`),null;this.connectionAttempts.set(i,a+1);const c=this.calculateBackoffDelay(i),l=this.lastConnectionTime.get(i)||0,f=Date.now()-l;if(f<c){const u=c-f;console.log(`[CoreNostrService] Waiting ${u}ms before retry for ${i}`),await new Promise(h=>setTimeout(h,u))}return this.lastConnectionTime.set(i,Date.now()),this.attemptSingleConnection(i)});try{(await Promise.allSettled(s)).forEach((a,c)=>{const l=o[c];a.status==="fulfilled"&&a.value?(this.connectedRelays.add(l),n.push(l),this.recordConnectionSuccess(l),pt.emit(gt.RELAY_CONNECTED,{relay:l}),console.log(`[CoreNostrService] âœ… Connected to ${l}`)):(this.recordConnectionFailure(l),console.warn(`[CoreNostrService] âŒ Failed to connect to ${l}`))})}catch(i){console.error("[CoreNostrService] Error in bulk connection:",i)}return console.log(`[CoreNostrService] Successfully connected to ${n.length}/${e.length} relays`),n.length<r.MIN_SUCCESSFUL_RELAYS&&console.warn(`[CoreNostrService] Warning: Only ${n.length} relays connected, minimum recommended is ${r.MIN_SUCCESSFUL_RELAYS}`),n}async attemptSingleConnection(e){const{CONNECTION_CONFIG:n}=await dt(async()=>{const{CONNECTION_CONFIG:r}=await Promise.resolve().then(()=>ft);return{CONNECTION_CONFIG:r}},void 0);return new Promise(r=>{const o=setTimeout(()=>{console.warn(`[CoreNostrService] Connection timeout for ${e}`),r(null)},n.CONNECTION_TIMEOUT);try{const s={kinds:[1],limit:1,since:Math.floor(Date.now()/1e3)-300};let i=!1;const a=this.pool.subscribeManyEose([e],[s],{onevent:c=>{i||(i=!0,clearTimeout(o),setTimeout(()=>a.close(),100),r(e))},oneose:()=>{i||(i=!0,clearTimeout(o),setTimeout(()=>a.close(),100),r(e))},onclose:c=>{i||(clearTimeout(o),c&&c.length>0?r(null):r(e))}});setTimeout(()=>{i||(i=!0,clearTimeout(o),a.close(),r(e))},n.CONNECTION_TIMEOUT-500)}catch(s){clearTimeout(o),console.error(`[CoreNostrService] Error testing connection to ${e}:`,s),r(null)}})}getConnectedRelays(){return Array.from(this.connectedRelays)}generateSubscriptionHash(e,n){const r=JSON.stringify(e.sort()),o=n.sort().join(",");return`${r}_${o}`}canCreateSubscription(e){for(const r of e){const o=this.subscriptionCounts.get(r)||0,s=this.getRelayLimit(r);if(s===0){console.log(`[CoreNostrService] ðŸ›‘ Relay ${r.split("/").pop()} is temporarily paused`);continue}if(o>=s)return console.log(`[CoreNostrService] ðŸš¦ Relay ${r.split("/").pop()} at capacity: ${o}/${s}`),!1}return e.filter(r=>this.getRelayLimit(r)>0).length===0?(console.warn("[CoreNostrService] ðŸš« All relays are paused, cannot create subscription"),!1):!0}incrementSubscriptionCount(e){e.forEach(n=>{const r=this.subscriptionCounts.get(n)||0;this.subscriptionCounts.set(n,r+1)})}decrementSubscriptionCount(e){e.forEach(n=>{const r=this.subscriptionCounts.get(n)||0;this.subscriptionCounts.set(n,Math.max(0,r-1))})}async processSubscriptionQueue(){for(;this.subscriptionQueue.length>0;){const e=this.subscriptionQueue[0];if(!this.canCreateSubscription(e.relays))break;this.subscriptionQueue.shift();try{const n=await this.createSubscriptionInternal(e.relays,e.filters,e.onEvent);e.resolve(n)}catch(n){console.error("[CoreNostrService] Error processing queued subscription:",n),e.reject(n)}}}async publishEvent(e){var n,r,o,s;if(!this.publicKey)throw new Error("User not logged in");try{if(e.id&&e.sig)return console.log("[CoreNostrService] Event already signed, publishing directly"),this.publishSignedEvent(e);const i={kind:e.kind||1,created_at:Math.floor(Date.now()/1e3),tags:e.tags||[],content:e.content||"",pubkey:this.publicKey,id:"",sig:""};if(!((n=window.nostr)!=null&&n.signEvent))throw new Error("No signing method available - please install a Nostr extension");const a=await window.nostr.signEvent(i);return this.publishSignedEvent(a)}catch(i){throw console.error("[CoreNostrService] Publish failed:",i),(r=i.message)!=null&&r.includes("User rejected")?new Error("Event signing was cancelled by user"):(o=i.message)!=null&&o.includes("timeout")?new Error("Publish timed out - please check your connection and try again"):(s=i.message)!=null&&s.includes("no active subscription")?new Error("Relay connection issue - please refresh and try again"):i}}async publishSignedEvent(e){try{let n=this.getConnectedRelays();if(n.length===0&&(await this.connectToDefaultRelays(),n=this.getConnectedRelays(),n.length===0))throw new Error("No relays available - please check your connection");const r=n.map(async c=>{try{console.log(`[CoreNostrService] Publishing to ${c}`);const l=this.pool.publish([c],e),f=new Promise((u,h)=>{setTimeout(()=>h(new Error("timeout")),8e3)});return await Promise.race([l,f]),console.log(`[CoreNostrService] Successfully published to ${c}`),{relay:c,success:!0}}catch(l){const f=l.message||l.toString();return f.includes("restricted")||f.includes("not an active paid member")||f.includes("pay")||f.includes("membership required")||f.includes("subscription required")?(console.warn(`[CoreNostrService] Skipping paid relay ${c}: ${f}`),{relay:c,success:!1,error:"paid_relay_restriction",skipped:!0}):(console.warn(`[CoreNostrService] Failed to publish to ${c}:`,f),{relay:c,success:!1,error:f})}}),o=await Promise.race([Promise.all(r),new Promise((c,l)=>{setTimeout(()=>l(new Error("Global publish timeout")),15e3)})]),s=o.filter(c=>c.success),i=o.filter(c=>!c.success&&!c.skipped),a=o.filter(c=>c.skipped);if(console.log(`[CoreNostrService] Publish results: ${s.length}/${n.length} successful, ${a.length} paid relays skipped`),s.length===0){if(a.length===n.length)throw console.warn("[CoreNostrService] All connected relays require payment, but event was not published"),console.info("[CoreNostrService] ðŸ’¡ Tip: Consider connecting to free relays like relay.damus.io, nos.lol, or relay.nostr.band for publishing"),new Error("All connected relays require paid membership. Your event was not published. Please connect to free relays or upgrade your membership.");if(a.length>0&&i.length>0){const c=[...new Set(i.map(l=>l.error))];throw new Error(`Failed to publish: ${c.join(", ")}. ${a.length} paid relays were skipped.`)}else{const c=[...new Set(i.map(f=>f.error))],l=c.includes("timeout")?"All relays timed out - please check your connection and try again":`Failed to publish to any relay: ${c.join(", ")}`;throw new Error(l)}}if(i.length>0||a.length>0){const c=i.map(u=>`${u.relay}(${u.error})`).join(", "),l=a.map(u=>u.relay).join(", ");let f="";i.length>0&&a.length>0?f=`Some relays failed: ${c}. Paid relays skipped: ${l}`:i.length>0?f=`Some relays failed: ${c}`:(f=`Paid relays skipped: ${l}`,console.info(`[CoreNostrService] â„¹ï¸ ${a.length} paid relays were skipped but event was successfully published to ${s.length} free relays`)),console.warn(`[CoreNostrService] ${f}`)}return e.id}catch(n){throw console.error("[CoreNostrService] Failed to publish signed event:",n),n}}subscribe(e,n,r,o="normal"){const s=r||this.getConnectedRelays();if(s.length===0){console.warn("[CoreNostrService] No relays available for subscription, attempting to connect to defaults"),this.connectToDefaultRelays().catch(a=>{console.error("[CoreNostrService] Failed to connect to default relays for subscription:",a)});const i=["wss://relay.damus.io","wss://nos.lol","wss://relay.snort.social","wss://relay.nostr.band","wss://offchain.pub","wss://nostr.wine"];return this.createSubscriptionWithBatching(i,e,n,o)}return this.createSubscriptionWithBatching(s,e,n,o)}createSubscriptionWithBatching(e,n,r,o="normal"){const s=`sub_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i=this.generateSubscriptionHash(n,e),a=this.subscriptionDeduplication.get(i);return a&&this.activeSubscriptions.has(a)?(console.log(`[CoreNostrService] ðŸ“‹ Reusing existing subscription ${a} for duplicate request`),a):o==="high"?this.canCreateSubscription(e)?(this.createSubscriptionInternal(e,n,r).then(c=>{this.activeSubscriptions.set(c,{relays:e,filters:n,onEvent:r}),this.subscriptionDeduplication.set(i,c),this.incrementSubscriptionCount(e),console.log(`[CoreNostrService] âš¡ Created high-priority subscription ${c} (${this.getSubscriptionStats()})`)}).catch(c=>{console.error("[CoreNostrService] Failed to create high-priority subscription:",c)}),s):(console.log("[CoreNostrService] âš¡ High-priority subscription queued - no capacity"),this.queueSubscriptionSynchronously(s,e,n,r),s):(this.pendingBatchedSubscriptions.push({id:s,filters:n,onEvent:r,relays:e,resolve:()=>{},reject:()=>{},priority:o}),this.pendingBatchedSubscriptions.sort((c,l)=>{const f={high:0,normal:1,low:2};return f[c.priority]-f[l.priority]}),this.subscriptionBatchTimeout||(this.subscriptionBatchTimeout=setTimeout(()=>{this.subscriptionBatchTimeout=null,this.processBatchedSubscriptions()},this.BATCH_TIMEOUT)),console.log(`[CoreNostrService] ðŸ“¦ Added ${o} priority subscription to batch (${this.pendingBatchedSubscriptions.length} pending)`),s)}queueSubscriptionSynchronously(e,n,r,o){this.subscriptionQueue.push({id:e,filters:r,onEvent:o,relays:n,resolve:()=>{},reject:()=>{}}),setTimeout(()=>this.processSubscriptionQueue(),100)}async createSubscriptionInternal(e,n,r){return this.enforceRateLimit(async()=>{try{console.log(`[CoreNostrService] ðŸš€ Creating rate-limited subscription for ${e.length} relays`);const o=this.pool.subscribeManyEose(e,n,{onevent:i=>{try{if(!i||typeof i!="object"){console.warn("[CoreNostrService] Received invalid event:",i);return}if(!i.id||!i.pubkey||!i.created_at||!i.kind){console.warn("[CoreNostrService] Received incomplete event:",i);return}if(i.tags&&!Array.isArray(i.tags)){console.warn("[CoreNostrService] Received event with invalid tags:",i);return}r(i)}catch(a){console.error("[CoreNostrService] Error processing event:",a,i)}},onclose:i=>{const a=o.toString();console.log(`[CoreNostrService] ðŸ”Œ Subscription ${a} closed:`,i||"normal close"),this.cleanupSubscription(a,e),this.processSubscriptionQueue()},oneose:()=>{console.log("[CoreNostrService] ðŸ“š End of stored events received")}}),s=o.toString();return console.log(`[CoreNostrService] âœ… Rate-limited subscription created: ${s}`),this.recordSubscriptionSuccess(e),s}catch(o){throw console.error("[CoreNostrService] Failed to create subscription:",o),o}})}cleanupSubscription(e,n){this.activeSubscriptions.delete(e),this.decrementSubscriptionCount(n);for(const[r,o]of this.subscriptionDeduplication.entries())if(o===e){this.subscriptionDeduplication.delete(r);break}}getSubscriptionStats(){const e=this.activeSubscriptions.size,n=this.subscriptionQueue.length;return`${e} active, ${n} queued | Relays: ${this.getRelayStats()}`}unsubscribe(e){try{if(e&&(typeof e=="object"&&typeof e.then=="function"||e.constructor&&e.constructor.name==="Promise"||e instanceof Promise||Object.prototype.toString.call(e)==="[object Promise]")){console.log("[CoreNostrService] ðŸ”„ Resolving Promise subscription ID for unsubscribe"),Promise.resolve(e).then(o=>{o&&typeof o=="string"?this.unsubscribe(o):console.log("[CoreNostrService] Promise resolved to invalid subscription ID:",o)}).catch(o=>{console.warn("[CoreNostrService] Failed to resolve subscription ID for unsubscribe:",o)});return}if(!e||typeof e!="string"||e.length===0){console.log("[CoreNostrService] Skipping unsubscribe for invalid subscription ID:",e);return}const n=e.includes&&typeof e.includes=="function"&&e.includes("failed_sub_");if(!(e===`failed_sub_${Date.now()}`)&&!n){console.log(`[CoreNostrService] ðŸ”Œ Unsubscribing: ${e}`);const o=this.activeSubscriptions.get(e);o&&this.cleanupSubscription(e,o.relays),this.processSubscriptionQueue(),console.log(`[CoreNostrService] ðŸ“Š Post-unsubscribe stats: ${this.getSubscriptionStats()}`)}else console.log(`[CoreNostrService] Skipping unsubscribe for invalid/failed subscription: ${e}`)}catch(n){console.warn(`[CoreNostrService] Error during unsubscribe for ${e}:`,n)}}async queryEvents(e){let n=this.getConnectedRelays();n.length===0&&(console.log("[CoreNostrService] No connected relays, attempting to connect to defaults"),await this.connectToDefaultRelays(),n=this.getConnectedRelays(),n.length===0&&(n=["wss://relay.damus.io","wss://nos.lol","wss://relay.snort.social","wss://relay.nostr.band","wss://offchain.pub","wss://nostr.wine"],console.log("[CoreNostrService] Using default relays for query")));const r=[];return new Promise(o=>{let s=!1,i=null;const a=setTimeout(()=>{if(!s){if(s=!0,i)try{i.close()}catch(c){console.warn("[CoreNostrService] Error closing subscription on timeout:",c)}console.log(`[CoreNostrService] Query timeout, returning ${r.length} events`),o(r)}},8e3);try{i=this.pool.subscribeManyEose(n,e,{onevent:c=>{if(!s)try{if(!c||typeof c!="object"){console.warn("[CoreNostrService] Query received invalid event:",c);return}if(!c.id||!c.pubkey||!c.created_at||typeof c.kind!="number"){console.warn("[CoreNostrService] Query received incomplete event:",c);return}if(c.tags&&!Array.isArray(c.tags)){console.warn("[CoreNostrService] Query received event with invalid tags:",c);return}r.push(c)}catch(l){console.error("[CoreNostrService] Error processing query event:",l,c)}},oneose:()=>{s||(s=!0,clearTimeout(a),console.log(`[CoreNostrService] Query completed, returning ${r.length} events`),setTimeout(()=>{if(i)try{i.close()}catch(c){console.warn("[CoreNostrService] Error closing subscription after EOSE:",c)}},100),o(r))},onclose:c=>{s||(s=!0,clearTimeout(a),console.log(`[CoreNostrService] Query subscription closed: ${c||"normal"}, returning ${r.length} events`),o(r))}})}catch(c){s||(s=!0,clearTimeout(a),console.error("[CoreNostrService] Failed to create query subscription:",c),o(r))}})}async getEventById(e){return(await this.queryEvents([{ids:[e]}]))[0]||null}async getEvents(e){return this.queryEvents([{ids:e}])}async getProfile(e){try{console.log(`[CoreNostrService] Fetching profile for pubkey: ${e.slice(0,8)}...`);const n=await this.queryEvents([{kinds:[0],authors:[e],limit:1}]);if(n.length===0)return console.log(`[CoreNostrService] No profile found for pubkey: ${e.slice(0,8)}`),null;const r=n[0];try{const o=JSON.parse(r.content);return console.log(`[CoreNostrService] Profile found for ${e.slice(0,8)}:`,Object.keys(o)),{...o,pubkey:e,_meta:{event_id:r.id,created_at:r.created_at,cached_at:Date.now()}}}catch(o){return console.error(`[CoreNostrService] Failed to parse profile metadata for ${e.slice(0,8)}:`,o),null}}catch(n){return console.error(`[CoreNostrService] Error fetching profile for ${e.slice(0,8)}:`,n),null}}async getArticlesByAuthor(e){return this.queryEvents([{kinds:[30023],authors:[e],limit:20}])}async searchArticles(e={}){const{limit:n=20,since:r}=e,o={kinds:[30023],limit:n};return r&&(o.since=r),this.queryEvents([o])}cleanup(){this.subscriptionQueue.length=0,this.activeSubscriptions.clear(),this.subscriptionCounts.clear(),this.subscriptionDeduplication.clear(),this.pendingBatchedSubscriptions.length=0,this.batchedSubscriptionHandlers.clear(),this.subscriptionRateLimitQueue.length=0,this.isProcessingRateLimit=!1,this.lastSubscriptionTime=0,this.relayLimits.clear(),this.relayPerformance.clear(),this.relayNoticeCount.clear(),this.lastNoticeTime.clear(),this.subscriptionBatchTimeout&&(clearTimeout(this.subscriptionBatchTimeout),this.subscriptionBatchTimeout=null),this.pool.close(),this.connectedRelays.clear(),this.connectionPromise=null,this.connectionPromiseResolver=null,this.isConnecting=!1,console.log("[CoreNostrService] ðŸ§¹ Service cleanup completed")}async connectToUserRelays(){const e=Date.now(),n=this.getConnectedRelays();return n.length>0&&e-this.lastConnectionCheck<this.CONNECTION_RECHECK_INTERVAL?(console.log(`[CoreNostrService] Already connected to ${n.length} relays (${Math.round((e-this.lastConnectionCheck)/1e3)}s ago), skipping connection attempt`),n):this.connectToDefaultRelays()}async connectRelay(e,n="both"){return this.relays.has(e)?!0:new Promise(r=>{try{console.log(`[CoreNostrService] Connecting to relay: ${e}`);const o=new WebSocket(e),s=setTimeout(()=>{console.warn(`[CoreNostrService] Connection timeout for relay: ${e}`),o.close(),r(!1)},CONNECTION_CONFIG.CONNECTION_TIMEOUT);o.onopen=()=>{clearTimeout(s),console.log(`[CoreNostrService] Connected to relay: ${e}`),this.relays.set(e,{ws:o,url:e,connected:!0,category:n,lastError:null,retryCount:0,circuitBreakerOpen:!1,lastSuccessfulConnect:Date.now()}),r(!0)},o.onerror=i=>{clearTimeout(s),console.warn(`[CoreNostrService] Error connecting to relay: ${e}`,i),r(!1)},o.onclose=i=>{var a,c,l;clearTimeout(s),console.warn(`[CoreNostrService] Connection closed for relay: ${e}`,i.code,i.reason),((a=i.reason)!=null&&a.includes("restricted")||(c=i.reason)!=null&&c.includes("paid")||(l=i.reason)!=null&&l.includes("membership"))&&console.info(`[CoreNostrService] Skipping paid relay: ${e} (${i.reason})`),this.relays.delete(e),r(!1)},o.onmessage=i=>{try{const a=JSON.parse(i.data);this.handleRelayMessage(e,a)}catch(a){console.warn(`[CoreNostrService] Failed to parse message from ${e}:`,a)}}}catch(o){console.warn(`[CoreNostrService] Failed to create WebSocket for ${e}:`,o),r(!1)}})}batchFilters(e){const n=e.map(r=>{const{kinds:o,authors:s,limit:i,...a}=r;return{kinds:o==null?void 0:o.sort(),authors:s==null?void 0:s.slice(0,3),limit:Math.min(i||20,50),...Object.keys(a).sort().reduce((c,l)=>(c[l]=a[l],c),{})}}).sort((r,o)=>JSON.stringify(r).localeCompare(JSON.stringify(o)));return JSON.stringify(n)}canBatchSubscriptions(e,n){var r,o;if(e.length!==n.length)return!1;for(let s=0;s<e.length;s++){const i=e[s],a=n[s];if(JSON.stringify((r=i.kinds)==null?void 0:r.sort())!==JSON.stringify((o=a.kinds)==null?void 0:o.sort()))return!1;const c=Object.keys(i).sort(),l=Object.keys(a).sort();if(JSON.stringify(c)!==JSON.stringify(l))return!1}return!0}processBatchedSubscriptions(){if(this.pendingBatchedSubscriptions.length===0)return;console.log(`[CoreNostrService] ðŸ“¦ Processing ${this.pendingBatchedSubscriptions.length} batched subscriptions`);const e=new Map;for(const n of this.pendingBatchedSubscriptions){const r=n.relays.sort().join(","),o=this.batchFilters(n.filters),s=`${r}:${o}`;e.has(s)||e.set(s,[]),e.get(s).push(n)}for(const[n,r]of e.entries())this.processBatchGroup(n,r);this.pendingBatchedSubscriptions.length=0}processBatchGroup(e,n){if(n.length===0)return;const o=n[0].relays,s=this.combineFilters(n.map(i=>i.filters));if(!this.canCreateSubscription(o)){for(const i of n)this.subscriptionQueue.push(i);console.log(`[CoreNostrService] â³ Batched group queued (${n.length} subscriptions)`);return}this.createBatchedSubscriptionInternal(e,o,s,n)}combineFilters(e){var r;const n=new Map;for(const o of e)for(const s of o){const i=JSON.stringify(((r=s.kinds)==null?void 0:r.sort())||[]);if(!n.has(i))n.set(i,{...s});else{const a=n.get(i);if(s.authors){const c=a.authors||[];a.authors=[...new Set([...c,...s.authors])]}if(s.ids){const c=a.ids||[];a.ids=[...new Set([...c,...s.ids])]}s.limit&&(a.limit=Math.max(a.limit||20,s.limit));for(const[c,l]of Object.entries(s))if(c.startsWith("#")&&Array.isArray(l)){const f=a[c]||[];a[c]=[...new Set([...f,...l])]}}}return Array.from(n.values())}async createBatchedSubscriptionInternal(e,n,r,o){return this.enforceRateLimit(async()=>{try{console.log(`[CoreNostrService] ðŸš€ Creating rate-limited batched subscription for ${o.length} requests`);const s=this.pool.subscribeManyEose(n,r,{onevent:a=>{try{if(!a||typeof a!="object"||!a.id||!a.pubkey)return;for(const c of o)if(this.eventMatchesFilters(a,c.filters))try{c.onEvent(a)}catch(f){console.error("[CoreNostrService] Error in batched subscription handler:",f)}}catch(c){console.error("[CoreNostrService] Error processing batched event:",c)}},onclose:a=>{const c=s.toString();console.log(`[CoreNostrService] ðŸ“¦ Batched subscription ${c} closed:`,a||"normal close"),this.cleanupSubscription(c,n),this.batchedSubscriptionHandlers.delete(e),this.processSubscriptionQueue()},oneose:()=>{console.log("[CoreNostrService] ðŸ“¦ Batched subscription EOSE")}}),i=s.toString();this.activeSubscriptions.set(i,{relays:n,filters:r,onEvent:()=>{}}),this.incrementSubscriptionCount(n);for(const a of o){this.activeSubscriptions.set(a.id,{relays:n,filters:a.filters,onEvent:a.onEvent,masterSubId:i});const c=this.generateSubscriptionHash(a.filters,n);this.subscriptionDeduplication.set(c,a.id)}console.log(`[CoreNostrService] âœ… Created rate-limited batched subscription ${i} for ${o.length} requests on ${n.length} relays (${this.getRelayStats()})`),this.recordSubscriptionSuccess(n)}catch(s){console.error("[CoreNostrService] Failed to create batched subscription:",s),console.warn(`[CoreNostrService] ${o.length} subscriptions failed to batch`)}})}eventMatchesFilters(e,n){return n.some(r=>{if(r.kinds&&!r.kinds.includes(e.kind)||r.authors&&!r.authors.includes(e.pubkey)||r.ids&&!r.ids.includes(e.id))return!1;for(const[o,s]of Object.entries(r))if(o.startsWith("#")&&Array.isArray(s)){const i=o.slice(1),a=e.tags.filter(c=>c[0]===i).map(c=>c[1]);if(!s.some(c=>a.includes(c)))return!1}return!0})}async enforceRateLimit(e){return new Promise((n,r)=>{const o=()=>{const s=Date.now(),i=s-this.lastSubscriptionTime;if(i<this.MIN_SUBSCRIPTION_INTERVAL){const a=this.MIN_SUBSCRIPTION_INTERVAL-i;console.log(`[CoreNostrService] â±ï¸ Rate limiting: waiting ${a}ms`),setTimeout(o,a);return}this.lastSubscriptionTime=s,e().then(n).catch(r)};this.subscriptionRateLimitQueue.push(o),this.processRateLimitQueue()})}processRateLimitQueue(){if(this.isProcessingRateLimit||this.subscriptionRateLimitQueue.length===0)return;this.isProcessingRateLimit=!0;const e=()=>{if(this.subscriptionRateLimitQueue.length===0){this.isProcessingRateLimit=!1;return}const n=this.subscriptionRateLimitQueue.shift();n?(n(),setTimeout(e,this.MIN_SUBSCRIPTION_INTERVAL)):this.isProcessingRateLimit=!1};e()}getRelayLimit(e){return this.relayLimits.has(e)||(this.relayLimits.set(e,this.MAX_CONCURRENT_SUBSCRIPTIONS),this.initializeRelayPerformance(e)),this.relayLimits.get(e)}initializeRelayPerformance(e){this.relayPerformance.set(e,{successfulSubscriptions:0,rejectedSubscriptions:0,lastRejectionTime:0,currentLimit:this.MAX_CONCURRENT_SUBSCRIPTIONS,lastLimitIncrease:0,consecutiveSuccesses:0})}recordSubscriptionSuccess(e){const n=Date.now();for(const r of e){const o=this.relayPerformance.get(r);o&&(o.successfulSubscriptions++,o.consecutiveSuccesses++,this.considerLimitIncrease(r,o,n))}}recordSubscriptionRejection(e,n){const r=Date.now(),o=this.relayPerformance.get(e);o&&(o.rejectedSubscriptions++,o.lastRejectionTime=r,o.consecutiveSuccesses=0,this.handleRelayRejection(e,o,n)),console.warn(`[CoreNostrService] ðŸš« Relay ${e.split("/").pop()} rejected subscription: ${n}`)}considerLimitIncrease(e,n,r){const o=this.relayLimits.get(e)||this.MAX_CONCURRENT_SUBSCRIPTIONS;if(!(o>=this.ADAPTIVE_MAX_LIMIT||r-n.lastRejectionTime<this.REJECTION_PENALTY_TIME)&&!(r-n.lastLimitIncrease<this.PERFORMANCE_WINDOW/2)&&n.consecutiveSuccesses>=this.SUCCESS_THRESHOLD){const s=Math.min(o+1,this.ADAPTIVE_MAX_LIMIT);this.relayLimits.set(e,s),n.currentLimit=s,n.lastLimitIncrease=r,n.consecutiveSuccesses=0,console.log(`[CoreNostrService] ðŸ“ˆ Increased limit for ${e.split("/").pop()}: ${o} â†’ ${s} (${n.successfulSubscriptions} successful)`)}}handleRelayRejection(e,n,r){const o=this.relayLimits.get(e)||this.MAX_CONCURRENT_SUBSCRIPTIONS;if(r.toLowerCase().includes("concurrent")||r.toLowerCase().includes("req")){const s=Math.max(1,o-1);this.relayLimits.set(e,s),n.currentLimit=s,console.log(`[CoreNostrService] ðŸ“‰ Decreased limit for ${e.split("/").pop()}: ${o} â†’ ${s} due to: ${r}`)}}getRelayStats(){return Array.from(this.relayLimits.entries()).map(([n,r])=>{const o=this.subscriptionCounts.get(n)||0,s=this.relayPerformance.get(n),i=(s==null?void 0:s.consecutiveSuccesses)||0;return`${n.split("/").pop()}:${o}/${r}(+${i})`}).join(", ")}getDetailedRelayStatus(){const e=Array.from(this.connectedRelays),n=Array.from(this.relayLimits.keys()),r=new Set([...$t,...e,...n]);return Array.from(r).map(o=>{const s=this.connectedRelays.has(o),i=this.getRelayLimit(o),a=this.subscriptionCounts.get(o)||0,c=this.relayPerformance.get(o)||{successfulSubscriptions:0,rejectedSubscriptions:0,consecutiveSuccesses:0,lastRejectionTime:0},l=this.relayNoticeCount.get(o)||0,f=this.lastNoticeTime.get(o)||0;let u="healthy";const h=Date.now();return s?i===0?u="paused":l>0&&h-f<this.NOTICE_RESET_TIME?u="degraded":c.rejectedSubscriptions>0&&h-c.lastRejectionTime<this.REJECTION_PENALTY_TIME&&(u="recovering"):u="recovering",{url:o,connected:s,currentLimit:i,activeSubscriptions:a,maxLimit:this.ADAPTIVE_MAX_LIMIT,performance:c,notices:{count:l,lastNoticeTime:f},status:u}}).sort((o,s)=>{if(o.connected!==s.connected)return s.connected?1:-1;if(o.status!==s.status){const i={healthy:0,degraded:1,recovering:2,paused:3};return i[o.status]-i[s.status]}return o.url.localeCompare(s.url)})}handleSpecificRelayRejection(e,n){const r=Date.now(),o=this.relayNoticeCount.get(e)||0,s=this.lastNoticeTime.get(e)||0;r-s>this.NOTICE_RESET_TIME?this.relayNoticeCount.set(e,1):this.relayNoticeCount.set(e,o+1),this.lastNoticeTime.set(e,r);const i=this.getRelayLimit(e),a=Math.max(1,i-1);this.relayLimits.set(e,a),this.recordSubscriptionRejection(e,n),console.warn(`[CoreNostrService] ðŸš« ${e.split("/").pop()}: Limit decreased ${i} â†’ ${a} (notice #${this.relayNoticeCount.get(e)})`),this.relayNoticeCount.get(e)>=this.MAX_NOTICES_BEFORE_LIMIT_DECREASE*2&&(console.warn(`[CoreNostrService] ðŸ›‘ ${e.split("/").pop()}: Too many rejections, pausing for 5 minutes`),this.relayLimits.set(e,0),setTimeout(()=>{this.relayLimits.set(e,1),this.relayNoticeCount.set(e,0),console.log(`[CoreNostrService] ðŸ”„ ${e.split("/").pop()}: Resuming with limit 1`)},3e5))}handleGenericRelayRejection(e){console.warn("[CoreNostrService] ðŸš« Generic relay rejection detected, reducing all relay limits by 1");for(const[n,r]of this.relayLimits.entries())if(r>1){const o=r-1;this.relayLimits.set(n,o),console.log(`[CoreNostrService] ðŸ“‰ ${n.split("/").pop()}: ${r} â†’ ${o} (generic rejection)`)}}}const M=new _f;function Sn(t){if(!t)return"";const e=t.substring(0,6),n=t.substring(t.length-4);return`${e}...${n}`}function Ss(t){if(!t.startsWith("nostr:"))return null;const e=t.split(":");if(e.length<2)return null;const n=e[1];try{if(n.startsWith("npub1")){const{type:r,data:o}=se.decode(n);return r!=="npub"?null:o}else if(n.startsWith("note1")){const{type:r,data:o}=se.decode(n);return r!=="note"?null:o}else if(n.startsWith("nevent1")){const{type:r,data:o}=se.decode(n);return r!=="nevent"?null:o.id}}catch(r){return console.error("Error converting nostr URL to hex:",r),null}return null}function Cs(t){return t.startsWith("npub1")?`/profile/${t}`:`/profile/${t}`}function Ns(t){return`/post/${t}`}const Ts={formatContent:(t,e)=>{if(!t||typeof t!="string")return j.jsx(j.Fragment,{});try{const r=t.split(/(\s+)/).map((o,s)=>{if(!o)return null;try{if(o.startsWith("nostr:")){const i=o.substring(6);if(i.startsWith("npub")||i.startsWith("nprofile"))return j.jsxs("a",{href:Cs(i),className:"text-primary font-medium hover:underline",children:["@",Sn(i)]},s);if(i.startsWith("note")||i.startsWith("nevent"))return j.jsxs("a",{href:Ns(i),className:"text-primary font-medium hover:underline",children:["#",Sn(i)]},s)}if(o.startsWith("@")&&o.length>1)return j.jsx("span",{className:"text-primary font-medium cursor-pointer hover:underline",children:o},s);if(o.startsWith("#")&&o.length>1)return j.jsx("span",{className:"text-primary cursor-pointer hover:underline",children:o},s);if(o.match(/^https?:\/\//i))return j.jsx("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:o},s)}catch(i){return console.error("Error processing content part:",o,i),o}return o});return j.jsx(j.Fragment,{children:r})}catch(n){return console.error("Error formatting content:",n),j.jsx(j.Fragment,{children:t})}},formatEventContent:(t,e)=>{try{return Ts.formatContent(t)}catch(n){return console.error("Error formatting event content:",n),j.jsx(j.Fragment,{children:t})}},processContent:t=>{if(!t||typeof t!="string")return"";try{return t}catch(e){return console.error("Error processing content:",e),t}},parseContent:(t,e)=>{if(!t||typeof t!="string")return[];try{const n=[],r=/(@\w+|nostr:(npub|note|nevent|nprofile)1[a-z0-9]+)/gi;let o,s=0;for(;(o=r.exec(t))!==null;){o.index>s&&n.push({type:"text",content:t.substring(s,o.index)});const i=o[0];i.startsWith("@")?n.push({type:"mention",content:i,data:i.substring(1)}):i.startsWith("nostr:")&&n.push({type:"mention",content:i,data:i}),s=o.index+o[0].length}return s<t.length&&n.push({type:"text",content:t.substring(s)}),n.length>0?n:[{type:"text",content:t}]}catch(n){return console.error("Error parsing content:",n),[{type:"text",content:t}]}},extractMentionedPubkeys:(t,e)=>{const n=[];try{if(e&&Array.isArray(e)&&e.forEach(r=>{Array.isArray(r)&&r[0]==="p"&&r[1]&&n.push(r[1])}),t&&typeof t=="string"){const r=/nostr:npub1[a-z0-9]+/gi,o=t.match(r);o&&o.forEach(s=>{try{const i=Ss(s);i&&!n.includes(i)&&n.push(i)}catch(i){console.error("Error extracting pubkey from nostr URL:",s,i)}})}}catch(r){console.error("Error extracting mentioned pubkeys:",r)}return n}},et=new Map,cn=new Map,sr=t=>!t||typeof t!="string"?!1:t.length===64&&/^[0-9a-f]{64}$/i.test(t),ir=t=>!t||typeof t!="string"?!1:t.startsWith("npub1")&&t.length>=60,_s=t=>{if(!t||typeof t!="string")return"unknown";if(ir(t))return t;if(et.has(t))return et.get(t)||"unknown";try{if(!sr(t))return t.substring(0,6)+"..."+t.substring(t.length-6);const e=se.npubEncode(t);return et.set(t,e),e}catch(e){return console.error("Error formatting pubkey:",e),t.substring(0,6)+"..."+t.substring(t.length-6)}},As=t=>{if(!t||typeof t!="string")return"npub1unknown";if(ir(t))return t;if(et.has(t))return et.get(t)||"npub1unknown";try{if(!sr(t))return console.warn("Invalid hex pubkey format:",t),"npub1invalid";const e=se.npubEncode(t);return et.set(t,e),e}catch(e){return console.error("Error encoding npub:",e,"input:",t),"npub1error"}},Rs=t=>{if(!t||typeof t!="string")return"";if(!t.startsWith("npub1"))return sr(t)?t:"";if(cn.has(t))return cn.get(t)||"";if(!ir(t))return console.warn("Invalid npub format:",t),"";try{const{type:e,data:n}=se.decode(t);if(e!=="npub")return console.warn("Decoded type is not a pubkey:",e),"";const r=n;return cn.set(t,r),r}catch(e){return console.error("Error decoding npub:",e,"input:",t),""}};async function Af(t,e,n,r){return new Promise(o=>{let s=0,i=0,a=0,c=0,l=0,f=!1,u=!1,h=!1;const p=[],y=[],d=[],g={kinds:[Q.REACTION],"#e":[e],limit:100},w=t.subscribe(n,g,{onevent:A=>{const R=A.content.trim();["+","ðŸ‘","â¤ï¸","ðŸ§¡","ðŸ’›","ðŸ’š","ðŸ’™","ðŸ’œ","ðŸ¤Ž","ðŸ–¤","ðŸ¤","â™¥ï¸"].includes(R)&&(s++,p.push(A.pubkey),r&&A.pubkey===r&&(f=!0))}}),E={kinds:[Q.REPOST],"#e":[e],limit:50},v=t.subscribe(n,E,{onevent:A=>{i++,y.push(A.pubkey),r&&A.pubkey===r&&(u=!0)}});setTimeout(()=>{w.close(),v.close(),o({likes:s,reposts:i,zaps:a,zapAmount:c,replies:l,userHasLiked:f,userHasReposted:u,userHasZapped:h,likers:p,reposters:y,zappers:d})},2e3)})}class Rf{constructor(e,n={}){b(this,"pool");b(this,"eventManager");b(this,"userManager");this.pool=e,this.eventManager=n.eventManager,this.userManager=n.userManager}async reactToEvent(e,n,r,o,s,i,a){if(!o||!this.eventManager)return null;try{const c={kind:Q.REACTION,content:r,tags:[["e",n]]};return a&&c.tags.push(["p",a]),this.eventManager.publishEvent(e,o,s,c,i)}catch(c){return console.error("Error reacting to event:",c),null}}async repostEvent(e,n,r,o,s,i,a){if(!s||!this.eventManager)return null;try{const c=[["e",n,o||""],["p",r]],l={kind:Q.REPOST,content:JSON.stringify({event_id:n,relay:o,pubkey:r,event:{id:n,pubkey:r}}),tags:c};return this.eventManager.publishEvent(e,s,i,l,a)}catch(c){return console.error("Error reposting event:",c),null}}async getReactionCounts(e,n,r){var s;const o=((s=this.userManager)==null?void 0:s.publicKey)||null;return Af(e,n,r,o)}}class Lr{constructor(e,n){b(this,"eventManager");b(this,"userManager");this.eventManager=e,this.userManager=n,console.log("ContactsManager initialized")}async followUser(e,n,r,o){console.log(`ContactsManager.followUser called for: ${n}`);const s=this.userManager.publicKey;if(!s)return console.error("No public key available, cannot follow user"),!1;try{const i=await this.getContactList(e,s,o);if(i.following.includes(n))return console.log(`Already following ${n}`),!0;this.userManager.addFollowing(n);const a=[...i.tags||[],["p",n]],c={kind:Q.CONTACTS,content:i.content||"",tags:a};console.log(`Publishing CONTACTS event (kind ${Q.CONTACTS}) to ${o.length} relays`);const l=await this.eventManager.publishEvent(e,s,r,c,o);return l?console.log(`Successfully published follow event with ID: ${l}`):console.error("Failed to publish follow event"),!!l}catch(i){return console.error("Error following user:",i),!1}}async unfollowUser(e,n,r,o){console.log(`ContactsManager.unfollowUser called for: ${n}`);const s=this.userManager.publicKey;if(!s)return console.error("No public key available, cannot unfollow user"),!1;try{const i=await this.getContactList(e,s,o);if(!i.following.includes(n))return console.log(`Not following ${n}, nothing to unfollow`),!0;this.userManager.removeFollowing(n);const a=(i.tags||[]).filter(f=>!(f[0]==="p"&&f[1]===n)),c={kind:Q.CONTACTS,content:i.content||"",tags:a};console.log(`Publishing CONTACTS event (kind ${Q.CONTACTS}) to ${o.length} relays`);const l=await this.eventManager.publishEvent(e,s,r,c,o);return l?console.log(`Successfully published unfollow event with ID: ${l}`):console.error("Failed to publish unfollow event"),!!l}catch(i){return console.error("Error unfollowing user:",i),!1}}async getContactList(e,n,r){return console.log(`Getting contact list for ${n} from ${r.length} relays`),new Promise(o=>{const s={following:[],followers:[],muted:[],blocked:[],pubkeys:[],tags:[],content:""};if(r.length===0){console.warn("No relay URLs provided for getContactList"),o(s);return}const i={kinds:[Q.CONTACTS],authors:[n],limit:1};console.log(`Subscribing to CONTACTS events (kind ${Q.CONTACTS}) for ${n}`);const a=e.subscribe(r,i,{onevent:c=>{console.log(`Received contact list event for ${n}:`,c);const f=c.tags.filter(u=>u.length>=2&&u[0]==="p").map(u=>u[1]);console.log(`Found ${f.length} contacts for ${n}`),o({following:f,followers:[],muted:[],blocked:[],pubkeys:f,tags:c.tags,content:c.content})}});setTimeout(()=>{a.close(),console.log(`Timeout reached while getting contact list for ${n}`),o(s)},5e3)})}}class Is{async publishEvent(e,n,r,o){var s,i;try{const a=typeof window<"u"&&window.nostr&&typeof window.nostr.signEvent=="function";if(!o&&!a)return{success:!1,error:"Private key or Nostr wallet extension is required for publishing. Please install a Nostr extension like Alby, nos2x, or Flamingo."};if(!n.pubkey)return{success:!1,error:"Public key is required in event"};if(!r||r.length===0)return{success:!1,error:"At least one relay is required for publishing"};n.created_at||(n.created_at=Math.floor(Date.now()/1e3)),console.log("[EventManager] Publishing event to relays:",r),console.log("[EventManager] Event details:",{kind:n.kind,content:(s=n.content)==null?void 0:s.slice(0,100),tags:n.tags,pubkey:((i=n.pubkey)==null?void 0:i.slice(0,8))+"..."});let c;if(o)console.log("[EventManager] Using private key signing"),c=pe(n,o);else{console.log("[EventManager] Using wallet extension signing");try{c=await window.nostr.signEvent(n),console.log("[EventManager] Event signed by wallet extension")}catch(h){return console.error("[EventManager] Wallet signing failed:",h),{success:!1,error:`Wallet signing failed: ${h.message||"User rejected or wallet error"}`}}}if(!c||!c.sig)return{success:!1,error:"Failed to sign event"};console.log("[EventManager] Event signed successfully, publishing to",r.length,"relays");const l=await Promise.allSettled(r.map(async h=>{try{return console.log(`[EventManager] Publishing to relay: ${h}`),await e.publish([h],c),console.log(`[EventManager] Successfully published to: ${h}`),{relay:h,success:!0}}catch(p){return console.error(`[EventManager] Failed to publish to ${h}:`,p),{relay:h,success:!1,error:p}}})),f=l.filter(h=>h.status==="fulfilled"&&h.value.success).length,u=l.length-f;return console.log(`[EventManager] Publish results: ${f}/${r.length} relays successful`),f===0?{success:!1,error:`Failed to publish to any relays (${u}/${r.length} failed)`}:(u>0&&console.warn(`[EventManager] Published to ${f}/${r.length} relays (${u} failed)`),{success:!0,event:c,publishStats:{successful:f,failed:u,total:r.length}})}catch(a){return console.error("[EventManager] Error publishing event:",a),{success:!1,error:a instanceof Error?a.message:"Unknown error occurred while publishing"}}}async queryEvents(e,n,r,o=5e3){return new Promise(s=>{const i=[];try{const a=e.subscribeMany(r,n,{onevent:c=>{i.push(c)},onclose:()=>{s(i)}});setTimeout(()=>{a.close(),s(i)},o)}catch(a){console.error("Error querying events:",a),s([])}})}async getEventById(e,n,r){try{const o={ids:[n]},s=await this.queryEvents(e,[o],r);return s.length>0?s[0]:null}catch(o){return console.error(`Error getting event ${n}:`,o),null}}async getEventsByAuthor(e,n,r,o=[1],s=50){try{const i={authors:[n],kinds:o,limit:s};return await this.queryEvents(e,[i],r)}catch(i){return console.error(`Error getting events for author ${n}:`,i),[]}}async getEventsByHashtag(e,n,r,o=50){try{const s={kinds:[1],"#t":[n],limit:o};return await this.queryEvents(e,[s],r)}catch(s){return console.error(`Error getting events for hashtag ${n}:`,s),[]}}async getContactList(e,n,r){try{const o={authors:[n],kinds:[Q.CONTACT_LIST],limit:1},s=await this.queryEvents(e,[o],r);return s.length===0?[]:s[0].tags.filter(a=>a[0]==="p").map(a=>a[1])}catch(o){return console.error(`Error getting contact list for ${n}:`,o),[]}}async publishContactList(e,n,r,o){try{const s=n.map(a=>["p",a]),i={kind:Q.CONTACT_LIST,tags:s,content:"",created_at:Math.floor(Date.now()/1e3),pubkey:se.decode(o).data};return await this.publishEvent(e,i,r,o)}catch(s){return console.error("Error publishing contact list:",s),{success:!1,error:s.message}}}async reactToEvent(e,n,r,o,s,i){try{const a={kind:Q.REACTION,tags:[["e",n],["p",r]],content:o,created_at:Math.floor(Date.now()/1e3),pubkey:se.decode(i).data};return await this.publishEvent(e,a,s,i)}catch(a){return console.error("Error reacting to event:",a),{success:!1,error:a.message}}}async repostEvent(e,n,r,o,s,i){try{const a={kind:Q.REPOST,tags:[["e",n],["p",r]],content:o,created_at:Math.floor(Date.now()/1e3),pubkey:se.decode(i).data};return await this.publishEvent(e,a,s,i)}catch(a){return console.error("Error reposting event:",a),{success:!1,error:a.message}}}async publishProfileMetadata(e,n,r,o,s){try{if(!n)return console.error("[EventManager] Cannot publish profile metadata: No public key"),!1;if(!s||s.length===0)return console.error("[EventManager] Cannot publish profile metadata: No relays provided"),!1;console.log("[EventManager] Publishing profile metadata:",o);const i={kind:Q.METADATA,content:JSON.stringify(o),tags:[],created_at:Math.floor(Date.now()/1e3),pubkey:n};console.log("[EventManager] Profile metadata event created:",{kind:i.kind,contentLength:i.content.length,pubkey:i.pubkey.slice(0,8)+"...",relayCount:s.length});const a=await this.publishEvent(e,i,s,r);return a.success?(console.log("[EventManager] Profile metadata published successfully"),!0):(console.error("[EventManager] Failed to publish profile metadata:",a.error),!1)}catch(i){return console.error("[EventManager] Error publishing profile metadata:",i),!1}}async getFollowers(e){try{const n=await this.pool.querySync(this.relayUrls,{kinds:[3],"#p":[e],limit:1e3}),r=new Set;return n.forEach(o=>{r.add(o.pubkey)}),Array.from(r)}catch(n){return console.error("Error getting followers:",n),[]}}async getFollowing(e){try{const n=await this.pool.querySync(this.relayUrls,{kinds:[3],authors:[e],limit:1});if(n.length===0)return[];const r=n.sort((s,i)=>i.created_at-s.created_at)[0],o=[];return r.tags.forEach(s=>{s[0]==="p"&&s[1]&&o.push(s[1])}),o}catch(n){return console.error("Error getting following:",n),[]}}}class $s{constructor(){b(this,"_publicKey",null);b(this,"_privateKey",null);b(this,"_following",new Set);b(this,"_extensionDetected",!1)}get publicKey(){return this._publicKey}get following(){return Array.from(this._following)}get hasExtension(){return this._extensionDetected}loadUserKeys(){const e=localStorage.getItem("nostr_pubkey");e&&(this._publicKey=e);const n=localStorage.getItem("nostr_privkey");n&&(this._privateKey=n),this._extensionDetected=!!window.nostr}loadFollowing(){const e=localStorage.getItem("nostr_following");if(e)try{const n=JSON.parse(e);this._following=new Set(n)}catch(n){console.error("Error loading following list:",n)}}saveFollowing(){this._publicKey&&localStorage.setItem("nostr_following",JSON.stringify(Array.from(this._following)))}isFollowing(e){return this._following.has(e)}async login(){try{if(window.nostr)try{const e=await window.nostr.getPublicKey();if(e){this._publicKey=e,localStorage.setItem("nostr_pubkey",e);try{if("getRelays"in window.nostr&&typeof window.nostr.getRelays=="function"){const n=await window.nostr.getRelays();n&&localStorage.setItem("nostr_extension_relays",JSON.stringify(n))}}catch(n){console.warn("Could not get relays from extension:",n)}return Jt.success("Successfully connected with extension"),!0}}catch(e){console.error("Failed to get public key from extension:",e),Jt.error("Failed to connect with Nostr extension")}else Jt.error("No Nostr extension found. Please install one (like nos2x or Alby)");return!1}catch(e){return console.error("Login error:",e),!1}}signOut(){this._publicKey=null,this._privateKey=null,localStorage.removeItem("nostr_pubkey"),localStorage.removeItem("nostr_privkey")}formatPubkey(e,n="npub"){if(!e)return"";try{if(n==="npub"&&e.length===64)return se.npubEncode(e);if(n==="hex"&&e.startsWith("npub1")){const{data:r}=se.decode(e);return r}}catch(r){console.error("Error formatting pubkey:",r)}return e}getNpubFromHex(e){try{return se.npubEncode(e)}catch(n){return console.error("Error encoding pubkey:",n),e}}getHexFromNpub(e){try{const{data:n}=se.decode(e);return n}catch(n){return console.error("Error decoding npub:",n),e}}setPublicKey(e){this._publicKey=e,e&&localStorage.setItem("nostr_pubkey",e)}addFollowing(e){this._following.add(e),this.saveFollowing()}removeFollowing(e){this._following.delete(e),this.saveFollowing()}setFollowing(e){this._following=new Set(e),this.saveFollowing()}}class Os{constructor(e,n={}){b(this,"pool");b(this,"options");b(this,"interactionsManager");b(this,"contactsManager",null);b(this,"eventManager",null);b(this,"userManager",null);this.pool=e,this.options={cacheExpiration:5*60*1e3,maxCacheSize:1e3,enableMetrics:!1,...n},this.interactionsManager=new Rf(e,{}),n.eventManager instanceof Is&&(this.eventManager=n.eventManager),n.userManager instanceof $s&&(this.userManager=n.userManager),this.eventManager&&this.userManager&&(this.contactsManager=new Lr(this.eventManager,this.userManager),console.log("ContactsManager initialized in SocialManager"))}initializeManagers(e,n){this.eventManager||(this.eventManager=e),this.userManager||(this.userManager=n),!this.contactsManager&&this.eventManager&&this.userManager&&(this.contactsManager=new Lr(this.eventManager,this.userManager),console.log("ContactsManager initialized after construction in SocialManager"))}async followUser(e,n,r,o){return console.log(`SocialManager.followUser called for pubkey: ${n}`),this.contactsManager?(console.log(`Delegating to ContactsManager.followUser for pubkey: ${n}`),this.contactsManager.followUser(e,n,r,o)):(console.warn(`ContactsManager not available, cannot follow user: ${n}`),!1)}async unfollowUser(e,n,r,o){return console.log(`SocialManager.unfollowUser called for pubkey: ${n}`),this.contactsManager?(console.log(`Delegating to ContactsManager.unfollowUser for pubkey: ${n}`),this.contactsManager.unfollowUser(e,n,r,o)):(console.warn(`ContactsManager not available, cannot unfollow user: ${n}`),!1)}async reactToEvent(e,n,r,o,s,i){return console.log(`Reacting to event ${n} with ${r}`),"reaction-id"}async repostEvent(e,n,r,o,s,i,a){if(!s)return null;try{const c={kind:EVENT_KINDS.REPOST,content:"",tags:[["e",n,o||""],["p",r]]};return this.eventManager.publishEvent(e,s,i,c,a)}catch(c){return console.error("Error reposting event:",c),null}}async getReactionCounts(e,n){return{likes:0,reposts:0,replies:0,zaps:0,zapAmount:0}}}const If=(t,e)=>{if(!t.tags||!Array.isArray(t.tags))return;const n=t.tags.find(r=>Array.isArray(r)&&r.length>=2&&r[0]===e);return n?n[1]:void 0},$f=t=>{if(!t)return"";if(t=t.trim(),!/^https?:\/\//i.test(t))try{return new URL(`https://${t}`),`https://${t}`}catch{return t}return t},Gt=t=>{if(!t||typeof t!="string")return!1;try{const e=$f(t);if(new URL(e),!e.startsWith("http://")&&!e.startsWith("https://"))return!1;const n=["bit.ly","tinyurl.com","t.co","goo.gl"];for(const o of n)if(e.includes(o))return!0;const r=["i.imgur.com","media.nostr.band","void.cat","nostr.build","primal.net","mako.co.il","v.nostr.build"];for(const o of r)if(e.includes(o))return!0;return!0}catch(e){return console.log("Invalid URL:",t,e),!1}},Gf=t=>Gt(t)?!!t.match(/\.(jpg|jpeg|png|gif|webp|svg)(\?.*)?$/i):!1,Jf=t=>Gt(t)?!!t.match(/\.(mp4|webm|mov|m4v|ogv)(\?.*)?$/i):!1,Zf=t=>Gt(t)?!!t.match(/\.(mp3|wav|ogg|flac|aac)(\?.*)?$/i):!1,ar=t=>{if(t.kind!==1063)return null;try{const e=JSON.parse(t.content);return!e.url||!e.mime?(console.warn("Invalid NIP-94 event, missing required fields"),null):Gt(e.url)?{url:e.url,mimeType:e.mime,hash:e.hash,size:e.size,dimensions:e.dim?{width:e.dim.w,height:e.dim.h}:void 0,alt:e.alt,blurhash:e.blurhash,description:e.description}:(console.warn("Invalid media URL in NIP-94 event:",e.url),null)}catch(e){return console.error("Error parsing NIP-94 file metadata:",e),null}},Of=t=>{const e=ar(t);return(e==null?void 0:e.url)||null},kf=t=>{const e=ar(t);return(e==null?void 0:e.alt)||null},ks=new zo,Lf=new Is(ks,[]),Mf=new $s;new Os(ks,{eventManager:Lf,userManager:Mf});const Bf={...M,queryEvents:async t=>M.queryEvents(t),subscribe:(t,e,n)=>M.subscribe(t,e,n),subscribePriority:(t,e,n,r="normal")=>M.subscribe(t,e,n,r),unsubscribe:t=>M.unsubscribe(t),publishEvent:async t=>M.publishEvent(t),getEventById:async t=>M.getEventById(t),login:async()=>M.login(),signOut:()=>{M.signOut()},clearProfileFailureCache:t=>{console.log("[Compat] clearProfileFailureCache called for:",t==null?void 0:t.slice(0,8))},getRelayUrls:()=>M.getConnectedRelays(),connectToUserRelays:async()=>M.connectToDefaultRelays(),connectToDefaultRelays:async()=>{const t=Pf(),e=[...new Set([...$t,...t])];return console.log(`[Compat] Connecting to ${e.length} relays (${$t.length} default + ${t.length} user)`),M.connectToRelays(e)},getConnectedRelays:()=>M.getConnectedRelays(),addMultipleRelays:async t=>{try{return console.log("[Compat] Adding multiple relays:",t),await M.connectToRelays(t)}catch(e){throw console.error("[Compat] Error adding multiple relays:",e),e}},addRelay:async(t,e=!0)=>{try{console.log(`[Compat] Adding relay: ${t}`);try{new URL(t)}catch{return console.error(`[Compat] Invalid relay URL: ${t}`),!1}return M.getConnectedRelays().includes(t)?(console.log(`[Compat] Relay ${t} already connected`),Mr(t,e),!0):(Mr(t,e),(await M.connectToRelays([t])).length>0?(console.log(`[Compat] Successfully added and connected to relay: ${t}`),pt.emit(gt.RELAY_CONNECTED,t),!0):(console.error(`[Compat] Failed to connect to relay: ${t}`),Br(t),!1))}catch(n){return console.error(`[Compat] Error adding relay ${t}:`,n),!1}},removeRelay:t=>{try{console.log(`[Compat] Removing relay: ${t}`),Br(t),pt.emit(gt.RELAY_DISCONNECTED,t),console.log(`[Compat] Successfully removed relay: ${t}`)}catch(e){console.error(`[Compat] Error removing relay ${t}:`,e)}},getRelayStatus:()=>M.getConnectedRelays().map(e=>({url:e,status:"connected",read:!0,write:!0})),getDetailedRelayStatus:()=>M.getDetailedRelayStatus(),getUserProfile:async t=>{try{const e=await M.queryEvents([{kinds:[0],authors:[t],limit:1}]);return e.length>0?JSON.parse(e[0].content):null}catch(e){return console.error("[Compat] Error getting user profile:",e),null}},getAccountCreationDate:async t=>{try{const e=await M.queryEvents([{kinds:[0],authors:[t],limit:1,since:0}]);return e.length>0?e[0].created_at*1e3:null}catch(e){return console.error("[Compat] Error getting account creation date:",e),null}},isFollowing:async t=>(console.log("[Compat] isFollowing called for:",t==null?void 0:t.slice(0,8)),!1),followUser:async t=>{var e,n,r,o,s;try{const i=M.getPublicKey(),a=M.getConnectedRelays();if(!i)throw new Error("User not authenticated - please login first");if(a.length===0&&await M.connectToDefaultRelays(),!window.nostr)throw new Error("Nostr extension not found - please install a Nostr browser extension");console.log("[Compat] Following user:",t==null?void 0:t.slice(0,8));try{await window.nostr.getPublicKey()}catch{throw console.warn("[Compat] Extension permission denied, requesting permission first"),new Error("Browser extension permission denied - please enable website access in your Nostr extension")}const c=await M.queryEvents([{kinds:[3],authors:[i],limit:1}]);let l=[],f="";if(c.length>0&&(l=c[0].tags||[],f=c[0].content||""),l.some(d=>d[0]==="p"&&d[1]===t))return console.log("Already following this user"),!0;const h=[...l,["p",t]],p={kind:3,created_at:Math.floor(Date.now()/1e3),tags:h,content:f,pubkey:i};console.log("[Compat] Signing contact event:",{kind:p.kind,tags:p.tags.length,pubkey:(e=p.pubkey)==null?void 0:e.slice(0,8)});let y;try{y=await window.nostr.signEvent(p),console.log("[Compat] Event signed successfully:",(n=y.id)==null?void 0:n.slice(0,8))}catch(d){throw console.error("[Compat] Signing failed:",d),(r=d.message)!=null&&r.includes("User rejected")||(o=d.message)!=null&&o.includes("denied")?new Error("Signing cancelled by user - please approve the request to follow"):(s=d.message)!=null&&s.includes("Unsolicited")?new Error("Extension permission issue - please check your Nostr extension settings and try again"):new Error(`Event signing failed: ${d.message||"Unknown error"}`)}try{console.log("[Compat] Publishing signed event to relays...");const d=await M.publishEvent(y);if(d)return console.log("[Compat] Follow event published successfully:",d==null?void 0:d.slice(0,8)),!0;throw new Error("Failed to publish to relays")}catch(d){console.error("[Compat] Publishing failed:",d);const g=M.getConnectedRelays();let w=!1;for(const E of g)try{const v=new WebSocket(E);if(await new Promise((A,R)=>{const C=setTimeout(()=>{v.close(),R(new Error("Timeout"))},5e3);v.onopen=()=>{v.send(JSON.stringify(["EVENT",y]))},v.onmessage=T=>{clearTimeout(C);const N=JSON.parse(T.data);N[0]==="OK"&&N[1]===y.id?(v.close(),w=!0,A(!0)):N[0]==="NOTICE"?(console.warn("[Compat] Relay notice:",N[1]),v.close(),R(new Error("Relay rejected event"))):(v.close(),R(new Error("Unexpected relay response")))},v.onerror=()=>{clearTimeout(C),v.close(),R(new Error("WebSocket error"))}}),w)break}catch(v){console.warn(`[Compat] Failed to publish to relay ${E}:`,v);continue}if(!w)throw new Error("Failed to publish to any relay")}return!0}catch(i){throw console.error("[Compat] Error following user:",i),i}},unfollowUser:async t=>{var e,n,r,o,s;try{const i=M.getPublicKey(),a=M.getConnectedRelays();if(!i)throw new Error("User not authenticated - please login first");if(a.length===0&&await M.connectToDefaultRelays(),!window.nostr)throw new Error("Nostr extension not found - please install a Nostr browser extension");console.log("[Compat] Unfollowing user:",t==null?void 0:t.slice(0,8));try{await window.nostr.getPublicKey()}catch{throw console.warn("[Compat] Extension permission denied, requesting permission first"),new Error("Browser extension permission denied - please enable website access in your Nostr extension")}const c=await M.queryEvents([{kinds:[3],authors:[i],limit:1}]);if(c.length===0)return console.log("No contact list found, nothing to unfollow"),!0;const l=c[0],f=l.tags||[],u=l.content||"",h=f.filter(d=>!(d[0]==="p"&&d[1]===t));if(h.length===f.length)return console.log("Was not following this user"),!0;const p={kind:3,created_at:Math.floor(Date.now()/1e3),tags:h,content:u,pubkey:i};console.log("[Compat] Signing unfollow contact event:",{kind:p.kind,tags:p.tags.length,pubkey:(e=p.pubkey)==null?void 0:e.slice(0,8)});let y;try{y=await window.nostr.signEvent(p),console.log("[Compat] Unfollow event signed successfully:",(n=y.id)==null?void 0:n.slice(0,8))}catch(d){throw console.error("[Compat] Signing failed:",d),(r=d.message)!=null&&r.includes("User rejected")||(o=d.message)!=null&&o.includes("denied")?new Error("Signing cancelled by user - please approve the request to unfollow"):(s=d.message)!=null&&s.includes("Unsolicited")?new Error("Extension permission issue - please check your Nostr extension settings and try again"):new Error(`Event signing failed: ${d.message||"Unknown error"}`)}try{console.log("[Compat] Publishing unfollow event to relays...");const d=await M.publishEvent(y);if(d)return console.log("[Compat] Unfollow event published successfully:",d==null?void 0:d.slice(0,8)),!0;throw new Error("Failed to publish to relays")}catch(d){console.error("[Compat] Publishing failed:",d);const g=M.getConnectedRelays();let w=!1;for(const E of g)try{const v=new WebSocket(E);if(await new Promise((A,R)=>{const C=setTimeout(()=>{v.close(),R(new Error("Timeout"))},5e3);v.onopen=()=>{v.send(JSON.stringify(["EVENT",y]))},v.onmessage=T=>{clearTimeout(C);const N=JSON.parse(T.data);N[0]==="OK"&&N[1]===y.id?(v.close(),w=!0,A(!0)):N[0]==="NOTICE"?(console.warn("[Compat] Relay notice:",N[1]),v.close(),R(new Error("Relay rejected event"))):(v.close(),R(new Error("Unexpected relay response")))},v.onerror=()=>{clearTimeout(C),v.close(),R(new Error("WebSocket error"))}}),w)break}catch(v){console.warn(`[Compat] Failed to publish to relay ${E}:`,v);continue}if(!w)throw new Error("Failed to publish to any relay")}return!0}catch(i){throw console.error("[Compat] Error unfollowing user:",i),i}},getNpubFromHex:t=>As(t),getHexFromNpub:t=>Rs(t),formatPubkey:t=>_s(t),publishProfileMetadata:async t=>{try{return!!await M.publishEvent({kind:0,content:JSON.stringify(t),tags:[]})}catch(e){return console.error("[Compat] Error publishing profile metadata:",e),!1}},updateProfile:async t=>{var e,n,r,o,s,i;try{const a=M.getPublicKey(),c=M.getConnectedRelays();if(!a)throw new Error("User not authenticated - please login first");if(c.length===0&&await M.connectToDefaultRelays(),!window.nostr)throw new Error("Nostr extension not found - please install a Nostr browser extension");console.log("[NostrService] Updating profile metadata:",Object.keys(t));const l={};for(const[d,g]of Object.entries(t))if(g!=null&&g!==""){let w=String(g).trim();w=w.replace(/[^\w\s\-_.@#$%&*+=<>!?()[\]{}'",:;/\\|~`]/g,""),w=w.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,""),w=w.replace(/\s+/g," ").trim(),w.length>0&&(l[d]=w,console.log(`[NostrService] Field "${d}": "${w.slice(0,50)}${w.length>50?"...":""}" (${w.length} chars)`))}console.log("[NostrService] Sanitized metadata:",l);const f={},u={name:"name",displayName:"display_name",about:"about",picture:"picture",banner:"banner",website:"website",lud16:"lud16",nip05:"nip05"};for(const[d,g]of Object.entries(l)){const w=u[d]||d;f[w]=g}if(Object.keys(f).length===0)throw new Error("No valid metadata provided - please fill in at least one field");console.log("[NostrService] Profile metadata to publish:",f);const h={kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify(f)};if(h.content.length>8192)throw new Error("Profile data is too large. Please reduce the length of your bio and other fields.");console.log("[NostrService] Event structure:",{kind:h.kind,contentLength:h.content.length,hasRequiredFields:!0}),console.log("[NostrService] âš¡ DETAILED EVENT ANALYSIS âš¡"),console.log("[NostrService] Event kind:",h.kind,typeof h.kind),console.log("[NostrService] Event created_at:",h.created_at,typeof h.created_at),console.log("[NostrService] Event tags:",h.tags,Array.isArray(h.tags)),console.log("[NostrService] Event content type:",typeof h.content),console.log("[NostrService] Event content length:",h.content.length),console.log("[NostrService] Event content preview:",h.content.slice(0,200)),console.log("[NostrService] Event content char codes (first 20):",Array.from(h.content.slice(0,20)).map(d=>d.charCodeAt(0)));try{const d=JSON.parse(h.content);console.log("[NostrService] âœ… Content is valid JSON:",Object.keys(d))}catch(d){throw console.error("[NostrService] âŒ Content JSON parse failed:",d),new Error("Profile content is not valid JSON")}const p=/[^\x20-\x7E\u00A0-\uFFFF]/.test(h.content);if(console.log("[NostrService] Has problematic unicode chars:",p),p){console.log("[NostrService] Problematic characters found in content");const d=Array.from(h.content).filter(g=>!/[\x20-\x7E\u00A0-\uFFFF]/.test(g));console.log("[NostrService] Problematic chars:",d.map(g=>({char:g,code:g.charCodeAt(0)})))}console.log("[NostrService] âš¡ END DETAILED ANALYSIS âš¡");let y;try{console.log("[NostrService] Requesting signature from browser extension...");const d=[()=>window.nostr.signEvent(h),()=>window.nostr.signEvent({...h,kind:"0"}),()=>window.nostr.signEvent({kind:0,created_at:h.created_at,content:h.content}),()=>window.nostr.signEvent({...h,pubkey:a})];let g=null;for(let w=0;w<d.length;w++)try{console.log(`[NostrService] Signing attempt ${w+1}/${d.length}`),y=await d[w](),console.log(`[NostrService] âœ… Profile event signed successfully on attempt ${w+1}`);break}catch(E){console.log(`[NostrService] âŒ Attempt ${w+1} failed:`,E.message),g=E;continue}if(!y)throw g||new Error("All signing attempts failed");if(!y.id||!y.pubkey||!y.sig)throw new Error("Signed event is missing required fields")}catch(d){throw console.error("[NostrService] Signing failed:",d),((e=d.message)!=null&&e.includes("serialize")||(n=d.message)!=null&&n.includes("properties"))&&console.log("[NostrService] Event that failed to sign:",{event:h,contentPreview:h.content.slice(0,100),contentByteLength:new Blob([h.content]).size,hasInvalidChars:/[^\x20-\x7E\u00A0-\uFFFF]/.test(h.content)}),(r=d.message)!=null&&r.includes("User rejected")||(o=d.message)!=null&&o.includes("denied")?new Error("Profile update cancelled by user - please approve the request in your Nostr extension"):(s=d.message)!=null&&s.includes("serialize")||(i=d.message)!=null&&i.includes("properties")?new Error("Event format error - the profile data contains invalid characters. Please try removing special characters and try again."):new Error(`Event signing failed: ${d.message||"Unknown error"}`)}try{if(console.log("[NostrService] Publishing profile update to relays..."),await M.publishEvent(y))return console.log("[NostrService] Profile update published successfully"),!0;throw new Error("Failed to publish to relays")}catch(d){throw console.error("[NostrService] Publishing failed:",d),new Error(`Failed to publish profile update: ${d.message||"Unknown error"}`)}}catch(a){throw console.error("[NostrService] Error updating profile:",a),a}},getRateLimiterStats:()=>({requests:0,remaining:100,resetTime:Date.now()+6e4}),getRelaysForUser:async t=>(console.log("[Compat] getRelaysForUser called for:",t==null?void 0:t.slice(0,8)),[]),get publicKey(){return M.getPublicKey()},getSubscriptionStats:()=>({active:0,total:0})};function Pf(){try{const t=localStorage.getItem("nostr_user_relays");if(t){const e=JSON.parse(t);return Object.keys(e)}return[]}catch(t){return console.error("[Compat] Error loading relays from localStorage:",t),[]}}function Mr(t,e=!0){try{const n=localStorage.getItem("nostr_user_relays");let r={};n&&(r=JSON.parse(n)),r[t]=e,localStorage.setItem("nostr_user_relays",JSON.stringify(r)),console.log(`[Compat] Saved relay to localStorage: ${t}`)}catch(n){console.error("[Compat] Error saving relay to localStorage:",n)}}function Br(t){try{const e=localStorage.getItem("nostr_user_relays");if(e){const n=JSON.parse(e);delete n[t],localStorage.setItem("nostr_user_relays",JSON.stringify(n)),console.log(`[Compat] Removed relay from localStorage: ${t}`)}}catch(e){console.error("[Compat] Error removing relay from localStorage:",e)}}const Uf=Bf,Yf=Object.freeze(Object.defineProperty({__proto__:null,EVENT_KINDS:Q,SocialManager:Os,contentFormatter:Ts,coreNostrService:M,extractFileMetadata:ar,formatPubkey:_s,getAltTextFromNip94:kf,getEventUrl:Ns,getHexFromNostrUrl:Ss,getHexFromNpub:Rs,getMediaUrlFromNip94:Of,getNpubFromHex:As,getProfileUrl:Cs,getTagValue:If,nostrService:Uf,shortenIdentifier:Sn},Symbol.toStringTag,{value:"Module"}));export{gt as E,jf as O,zo as S,dt as _,Jt as a,Ts as b,M as c,Q as d,pt as e,_s as f,If as g,As as h,Af as i,Gf as j,Jf as k,Zf as l,kf as m,Uf as n,Of as o,Gt as p,Yf as q};
