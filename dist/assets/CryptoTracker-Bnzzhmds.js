import{j as e,a8 as G,aT as P,B as o,ad as $,a9 as H,aa as F,ab as O,L as U,H as z,al as B}from"./ui-components-7vdcyMHN.js";import{r as i}from"./react-vendor-D8JZSk8j.js";import{u as M,a as _,S as w}from"./index-DJZJQAqd.js";import{n as Q}from"./chat-components-CdZBMBul.js";import{a as c}from"./nostr-core-DJLvyRnE.js";const b="blocknoster_watched_coins",K=["bitcoin","alephium","ergo"],X=()=>{const[x,u]=i.useState([]),[g,f]=i.useState(null),[C,k]=i.useState(null),[m,j]=i.useState(""),[r,h]=i.useState(K),[L,v]=i.useState(!1),{data:l,isLoading:R,error:d,refetch:A}=M({coinIds:r},{pollingInterval:3e5,skip:r.length===0}),{data:n,isLoading:W}=_({tokenIds:["ALPH"]},{pollingInterval:3e5,skip:!r.includes("alephium")||!d}),p=R;i.useEffect(()=>{const s=localStorage.getItem(b);if(s)try{const a=JSON.parse(s);Array.isArray(a)&&a.length>0&&h(a)}catch(a){console.error("Error parsing stored coins:",a)}},[]),i.useEffect(()=>{r.length>0&&localStorage.setItem(b,JSON.stringify(r))},[r]),i.useEffect(()=>{var s;if(l)console.log("[CryptoTracker] âœ… Received CoinGecko data from RTK Query:",l),u(l),k(new Date),f(null);else if(d){console.error("[CryptoTracker] RTK Query CoinGecko error:",d),f("Failed to fetch live price data from CoinGecko");const a=[];for(const t of r)if(t==="alephium"&&((s=n==null?void 0:n.ALPH)!=null&&s.price))a.push({id:"alephium",name:"Alephium",symbol:"ALPH",price:n.ALPH.price,priceChange24h:0,marketCapRank:566}),console.log(`[CryptoTracker] ðŸ“Š Using Redux fallback for ALPH: $${n.ALPH.price}`);else{const y={bitcoin:{id:"bitcoin",name:"Bitcoin",symbol:"BTC",price:11e4,priceChange24h:2.5,marketCapRank:1},ethereum:{id:"ethereum",name:"Ethereum",symbol:"ETH",price:2600,priceChange24h:1.8,marketCapRank:2},ergo:{id:"ergo",name:"Ergo",symbol:"ERG",price:1.42,priceChange24h:-1.2,marketCapRank:302},cardano:{id:"cardano",name:"Cardano",symbol:"ADA",price:.77,priceChange24h:.8,marketCapRank:8}};y[t]?a.push(y[t]):a.push({id:t,name:t.charAt(0).toUpperCase()+t.slice(1),symbol:t.toUpperCase().substring(0,4),price:0,priceChange24h:0,marketCapRank:999})}u(a),k(new Date)}},[l,d,n,r]);const N=async()=>{console.log("[CryptoTracker] ðŸ”„ Manual refresh triggered"),await A()},D=s=>s>=1e3?`$${s.toLocaleString(void 0,{maximumFractionDigits:0})}`:s>=1?`$${s.toLocaleString(void 0,{maximumFractionDigits:2})}`:`$${s.toLocaleString(void 0,{maximumFractionDigits:4})}`,T=s=>{const a=s>=0;return e.jsxs("span",{className:`${a?"text-green-500":"text-red-500"} text-sm`,children:[a?"+":"",s.toFixed(2),"%"]})},S=()=>{if(!m.trim()){c.error("Please enter a valid coin ID");return}const s=m.trim().toLowerCase();if(r.includes(s)){c.error("This coin is already being tracked");return}h(a=>[...a,s]),j(""),v(!1),c.success(`Added ${s} to tracked coins`)},E=s=>{if(r.length<=1){c.error("You must track at least one coin");return}h(a=>a.filter(t=>t!==s)),c.success(`Removed ${s} from tracked coins`)},I=s=>e.jsxs("div",{className:"flex items-center justify-between py-1 hover:bg-accent/30 group px-1 rounded",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("div",{className:"text-sm bg-muted px-1 rounded",children:["#",s.marketCapRank]}),e.jsx("div",{className:"text-sm font-medium",children:s.name}),e.jsx("div",{className:"text-sm text-muted-foreground uppercase",children:s.symbol})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-sm font-medium",children:D(s.price)}),T(s.priceChange24h),e.jsxs(o,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>E(s.id),title:"Remove from tracking",children:[e.jsx("span",{className:"sr-only",children:"Remove"}),"Ã—"]})]})]},s.id);return e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsxs("svg",{className:"h-3.5 w-3.5 text-primary",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M15 9.354C14.3802 8.7343 13.5233 8.39405 12.6361 8.4156C11.7489 8.43715 10.9075 8.8178 10.3179 9.46729C9.72833 10.1168 9.44338 10.9797 9.53398 11.8509C9.62457 12.722 10.08 13.5164 10.784 14.046L13.2 16L15.616 18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("h3",{className:"font-medium text-sm",children:"Market Prices"})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(G,{open:L,onOpenChange:v,children:[e.jsx(P,{asChild:!0,children:e.jsxs(o,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0",title:"Add coin",children:[e.jsx($,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Add coin"})]})}),e.jsxs(H,{className:"sm:max-w-[425px]",children:[e.jsx(F,{children:e.jsx(O,{children:"Add cryptocurrency"})}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{htmlFor:"coinId",className:"text-sm",children:"Coin ID (from CoinGecko)"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{id:"coinId",value:m,onChange:s=>j(s.target.value),placeholder:"e.g. bitcoin, ethereum",className:"flex-1"}),e.jsx(o,{onClick:S,children:"Add"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Enter the CoinGecko ID of the cryptocurrency you want to track"})]})})]})]}),e.jsxs(o,{variant:"ghost",size:"sm",className:"h-5 w-5 p-0",disabled:p,onClick:N,title:"Refresh prices",children:[p?e.jsx(U,{className:"h-3 w-3 animate-spin"}):e.jsx(z,{className:"h-3 w-3"}),e.jsx("span",{className:"sr-only",children:"Refresh prices"})]})]})]}),g?e.jsxs("div",{className:"p-2 text-center text-sm text-muted-foreground bg-accent/20 rounded",children:[g,". ",e.jsx(o,{variant:"link",size:"sm",className:"p-0 h-auto text-sm",onClick:N,children:"Try again"})]}):p&&x.length===0?e.jsx("div",{className:"space-y-1",children:[1,2,3].map(s=>e.jsx("div",{className:"py-1 px-1",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(w,{className:"h-4 w-16"}),e.jsx(w,{className:"h-4 w-12"})]})},s))}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-0",children:x.map(I)}),C&&e.jsx("div",{className:"mt-1 text-sm text-center text-muted-foreground",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("span",{children:["Updated ",C.toLocaleTimeString()]}),e.jsxs("a",{href:"https://www.coingecko.com/",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center ml-1 text-primary hover:underline",children:["CoinGecko",e.jsx(B,{className:"h-3 w-3 ml-0.5"})]})]})})]})]})};export{X as default};
